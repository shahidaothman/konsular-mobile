/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { FivBottomSheetContent } from './bottom-sheet-content/bottom-sheet-content.component';
import { Component, Input, Output, EventEmitter, ElementRef, Renderer2, ContentChild } from '@angular/core';
import { DomController, Platform } from '@ionic/angular';
import { DrawerState } from './drawer-state';
import { merge, Subject, fromEvent, from } from 'rxjs';
import { takeUntil, map, tap, flatMap, repeat, withLatestFrom, filter, first, take, repeatWhen } from 'rxjs/operators';
/**
 * @record
 */
export function PanEvent() { }
if (false) {
    /** @type {?} */
    PanEvent.prototype.currentOffset;
    /** @type {?} */
    PanEvent.prototype.startOffset;
    /** @type {?} */
    PanEvent.prototype.currentTop;
    /** @type {?} */
    PanEvent.prototype.startTop;
    /** @type {?} */
    PanEvent.prototype.distance;
    /** @type {?} */
    PanEvent.prototype.touch;
}
var FivBottomSheet = /** @class */ (function () {
    function FivBottomSheet(_element, _renderer, _domCtrl, _platform) {
        this._element = _element;
        this._renderer = _renderer;
        this._domCtrl = _domCtrl;
        this._platform = _platform;
        this.dockedHeight = 80;
        this.shouldBounce = true;
        this.distanceTop = 56;
        this.transition = '0.25s';
        this.state = DrawerState.Bottom;
        this.bounceThreshold = 40;
        this.panThreshold = 20;
        this.panEnabled = true;
        this.stateChange = new EventEmitter();
        this.fivOpen = new EventEmitter();
        this.fivDocked = new EventEmitter();
        this.fivClose = new EventEmitter();
        this.scrollTop = 0;
        this.$onDestroy = new Subject();
    }
    /**
     * @return {?}
     */
    FivBottomSheet.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.$onDestroy.next();
    };
    /**
     * @return {?}
     */
    FivBottomSheet.prototype.ngAfterViewInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this._setDrawerState(this.state);
        this.content.shouldBounce = this.shouldBounce;
        /** @type {?} */
        var touchmove = fromEvent(this._element.nativeElement, 'touchmove', {
            passive: true
        });
        /** @type {?} */
        var touchend = merge(fromEvent(this._element.nativeElement, 'touchend', {
            passive: true
        }), fromEvent(this._element.nativeElement, 'touchcancel', {
            passive: true
        }));
        /** @type {?} */
        var getScrollContent = from(this.content.content.getScrollElement());
        /** @type {?} */
        var scroll = this.content.content.ionScroll.pipe(tap((/**
         * @param {?} el
         * @return {?}
         */
        function (el) { return (_this.scrollTop = el.detail.scrollTop); })), takeUntil(this.$onDestroy));
        scroll.subscribe();
        this.content.content.ionScrollEnd
            .pipe(filter((/**
         * @param {?} el
         * @return {?}
         */
        function (el) { return _this.scrollTop === 0 && _this.state === DrawerState.Top; })), tap((/**
         * @return {?}
         */
        function () { return _this.content.content.scrollByPoint(0, 1, 0); })), takeUntil(this.$onDestroy))
            .subscribe();
        /** @type {?} */
        var canStart = touchmove.pipe(filter((/**
         * @return {?}
         */
        function () { return _this.scrollTop === 0; })));
        /** @type {?} */
        var start = canStart.pipe(take(1), tap((/**
         * @param {?} s
         * @return {?}
         */
        function (s) { return _this._handlePanStart(s); })));
        /** @type {?} */
        var pan = start.pipe(filter((/**
         * @return {?}
         */
        function () { return _this.panEnabled; })), flatMap((/**
         * @return {?}
         */
        function () { return touchmove; })), map((/**
         * @param {?} tm
         * @return {?}
         */
        function (tm) { return _this.calculatePanEvent(tm); })));
        /** @type {?} */
        var handlePan = pan.pipe(filter((/**
         * @param {?} p
         * @return {?}
         */
        function (p) { return Math.abs(p.distance) > _this.panThreshold; })), map((/**
         * @param {?} tm
         * @return {?}
         */
        function (tm) { return _this._handlePan(tm); })), takeUntil(touchend), repeat(), takeUntil(this.$onDestroy));
        /** @type {?} */
        var handleBackPan = pan
            .pipe(filter((/**
         * @param {?} p
         * @return {?}
         */
        function (p) { return Math.abs(p.distance) <= _this.panThreshold && _this.content.panning; })), map((/**
         * @param {?} tm
         * @return {?}
         */
        function (tm) { return _this._handlePan(tm); })), takeUntil(touchend), repeat(), takeUntil(this.$onDestroy))
            .subscribe();
        handlePan
            .pipe(first(), tap((/**
         * @return {?}
         */
        function () { return (_this.content.panning = true); })), repeatWhen((/**
         * @return {?}
         */
        function () { return touchend; })), takeUntil(this.$onDestroy))
            .subscribe();
        handlePan
            .pipe(flatMap((/**
         * @return {?}
         */
        function () { return touchend; })), first(), withLatestFrom(pan), tap((/**
         * @return {?}
         */
        function () { return _this.content.content.scrollByPoint(0, 1, 0); })), tap((/**
         * @return {?}
         */
        function () { return (_this.content.panning = false); })), map((/**
         * @param {?} ev
         * @return {?}
         */
        function (ev) { return ev[1]; })), repeat(), takeUntil(this.$onDestroy))
            .subscribe((/**
         * @param {?} ev
         * @return {?}
         */
        function (ev) { return _this._handlePanEnd(ev); }));
    };
    /**
     * @param {?} changes
     * @return {?}
     */
    FivBottomSheet.prototype.ngOnChanges = /**
     * @param {?} changes
     * @return {?}
     */
    function (changes) {
        if (!changes.state) {
            return;
        }
        this._setDrawerState(changes.state.currentValue);
        this.updateContent(changes.state.currentValue);
    };
    /**
     * @param {?} state
     * @return {?}
     */
    FivBottomSheet.prototype.updateContent = /**
     * @param {?} state
     * @return {?}
     */
    function (state) {
        if (this.content) {
            this.content.updateState(state);
        }
    };
    /**
     * @private
     * @param {?} state
     * @return {?}
     */
    FivBottomSheet.prototype._setDrawerState = /**
     * @private
     * @param {?} state
     * @return {?}
     */
    function (state) {
        this._renderer.setStyle(this._element.nativeElement, 'transition', this.transition);
        switch (state) {
            case DrawerState.Bottom:
                this.content.content.scrollToTop(0);
                this._setTranslateY('100vh');
                break;
            case DrawerState.Docked:
                this.content.content.scrollToTop(0);
                this._setTranslateY(this._platform.height() - this.dockedHeight + 'px');
                break;
            default:
                this._setTranslateY(this.distanceTop + 'px');
        }
    };
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    FivBottomSheet.prototype._handlePanStart = /**
     * @private
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this._startPositionTop = this.getCurrentTop();
        this._startPositionOffset = event.touches[0].pageY;
    };
    /**
     * @return {?}
     */
    FivBottomSheet.prototype.getCurrentTop = /**
     * @return {?}
     */
    function () {
        return this._element.nativeElement.getBoundingClientRect().top;
    };
    /**
     * @private
     * @param {?} ev
     * @return {?}
     */
    FivBottomSheet.prototype._handlePanEnd = /**
     * @private
     * @param {?} ev
     * @return {?}
     */
    function (ev) {
        if (this.shouldBounce) {
            this._renderer.setStyle(this._element.nativeElement, 'transition', this.transition);
            switch (this.state) {
                case DrawerState.Docked:
                    this._handleDockedPanEnd(ev);
                    break;
                case DrawerState.Top:
                    this._handleTopPanEnd(ev);
                    break;
                default:
                    this._handleBottomPanEnd(ev);
            }
        }
        this.stateChange.emit(this.state);
    };
    /**
     * @private
     * @param {?} ev
     * @return {?}
     */
    FivBottomSheet.prototype._handleTopPanEnd = /**
     * @private
     * @param {?} ev
     * @return {?}
     */
    function (ev) {
        if (ev.distance > this.bounceThreshold) {
            if (this.state !== DrawerState.Docked) {
                this.state = DrawerState.Docked;
                this.fivDocked.emit(this);
            }
        }
        else {
            this._setTranslateY(this.distanceTop + 'px');
        }
    };
    /**
     * @private
     * @param {?} ev
     * @return {?}
     */
    FivBottomSheet.prototype._handleDockedPanEnd = /**
     * @private
     * @param {?} ev
     * @return {?}
     */
    function (ev) {
        /** @type {?} */
        var absDeltaY = Math.abs(ev.distance);
        if (absDeltaY > this.bounceThreshold && ev.distance < 0) {
            if (this.state !== DrawerState.Top) {
                this.state = DrawerState.Top;
                this.fivOpen.emit();
            }
        }
        else if (absDeltaY > this.bounceThreshold && ev.distance > 0) {
            if (this.state !== DrawerState.Bottom) {
                this.state = DrawerState.Bottom;
                this.fivClose.emit();
            }
        }
        else {
            this._setTranslateY(this._platform.height() - this.dockedHeight + 'px');
        }
    };
    /**
     * @private
     * @param {?} ev
     * @return {?}
     */
    FivBottomSheet.prototype._handleBottomPanEnd = /**
     * @private
     * @param {?} ev
     * @return {?}
     */
    function (ev) {
        if (-ev.distance > this.bounceThreshold) {
            if (this.state !== DrawerState.Docked) {
                this.state = DrawerState.Docked;
                this.fivDocked.emit();
            }
        }
        else {
            this._setTranslateY('100vh');
        }
    };
    /**
     * @param {?} ev
     * @return {?}
     */
    FivBottomSheet.prototype.calculatePanEvent = /**
     * @param {?} ev
     * @return {?}
     */
    function (ev) {
        return {
            currentOffset: ev.touches[0].pageY,
            startOffset: this._startPositionOffset,
            startTop: this._startPositionTop,
            currentTop: this.getCurrentTop(),
            distance: ev.touches[0].pageY - this._startPositionOffset,
            touch: ev
        };
    };
    /**
     * @private
     * @param {?} event
     * @return {?}
     */
    FivBottomSheet.prototype._handlePan = /**
     * @private
     * @param {?} event
     * @return {?}
     */
    function (event) {
        this._renderer.setStyle(this._element.nativeElement, 'transition', 'none');
        if (event.currentTop >= 0 && event.currentTop <= this._platform.height()) {
            /** @type {?} */
            var newTop = this._startPositionTop + event.distance;
            if (newTop >= this.distanceTop) {
                this._setTranslateY(newTop + 'px');
            }
            else if (newTop <= this.distanceTop && this.content.panning) {
                this._setTranslateY(this.distanceTop + 'px');
                this.content.content.scrollToPoint(0, 0 - newTop, 0);
            }
            return event;
        }
    };
    /**
     * @private
     * @param {?} value
     * @return {?}
     */
    FivBottomSheet.prototype._setTranslateY = /**
     * @private
     * @param {?} value
     * @return {?}
     */
    function (value) {
        var _this = this;
        this._domCtrl.write((/**
         * @return {?}
         */
        function () {
            _this._renderer.setStyle(_this._element.nativeElement, 'transform', 'translateY(' + value + ')');
        }));
    };
    /**
     * @return {?}
     */
    FivBottomSheet.prototype.open = /**
     * @return {?}
     */
    function () {
        this.state = DrawerState.Top;
        this._setDrawerState(this.state);
        this.updateContent(this.state);
    };
    /**
     * @return {?}
     */
    FivBottomSheet.prototype.close = /**
     * @return {?}
     */
    function () {
        this.state = DrawerState.Bottom;
        this._setDrawerState(this.state);
        this.updateContent(this.state);
    };
    /**
     * @return {?}
     */
    FivBottomSheet.prototype.dock = /**
     * @return {?}
     */
    function () {
        this.state = DrawerState.Docked;
        this._setDrawerState(this.state);
        this.updateContent(this.state);
    };
    FivBottomSheet.decorators = [
        { type: Component, args: [{
                    selector: 'fiv-bottom-sheet',
                    template: "<div class=\"fiv-bottom-drawer-scrollable-content\" no-bounce>\n  <ng-content></ng-content>\n</div>",
                    styles: [":host{width:100%;height:100%;position:absolute;left:0;z-index:11!important;background-color:#fff;-webkit-transform:translateY(100vh);transform:translateY(100vh)}.fiv-bottom-drawer-scrollable-content{width:100%;height:100%}"]
                }] }
    ];
    /** @nocollapse */
    FivBottomSheet.ctorParameters = function () { return [
        { type: ElementRef },
        { type: Renderer2 },
        { type: DomController },
        { type: Platform }
    ]; };
    FivBottomSheet.propDecorators = {
        dockedHeight: [{ type: Input }],
        shouldBounce: [{ type: Input }],
        distanceTop: [{ type: Input }],
        transition: [{ type: Input }],
        state: [{ type: Input }],
        bounceThreshold: [{ type: Input }],
        panThreshold: [{ type: Input }],
        panEnabled: [{ type: Input }],
        stateChange: [{ type: Output }],
        fivOpen: [{ type: Output }],
        fivDocked: [{ type: Output }],
        fivClose: [{ type: Output }],
        content: [{ type: ContentChild, args: [FivBottomSheetContent,] }]
    };
    return FivBottomSheet;
}());
export { FivBottomSheet };
if (false) {
    /** @type {?} */
    FivBottomSheet.prototype.dockedHeight;
    /** @type {?} */
    FivBottomSheet.prototype.shouldBounce;
    /** @type {?} */
    FivBottomSheet.prototype.distanceTop;
    /** @type {?} */
    FivBottomSheet.prototype.transition;
    /** @type {?} */
    FivBottomSheet.prototype.state;
    /** @type {?} */
    FivBottomSheet.prototype.bounceThreshold;
    /** @type {?} */
    FivBottomSheet.prototype.panThreshold;
    /** @type {?} */
    FivBottomSheet.prototype.panEnabled;
    /** @type {?} */
    FivBottomSheet.prototype.stateChange;
    /** @type {?} */
    FivBottomSheet.prototype.fivOpen;
    /** @type {?} */
    FivBottomSheet.prototype.fivDocked;
    /** @type {?} */
    FivBottomSheet.prototype.fivClose;
    /** @type {?} */
    FivBottomSheet.prototype.content;
    /**
     * @type {?}
     * @private
     */
    FivBottomSheet.prototype._startPositionTop;
    /** @type {?} */
    FivBottomSheet.prototype._startPositionOffset;
    /** @type {?} */
    FivBottomSheet.prototype.scrollTop;
    /** @type {?} */
    FivBottomSheet.prototype.$onDestroy;
    /**
     * @type {?}
     * @private
     */
    FivBottomSheet.prototype._element;
    /**
     * @type {?}
     * @private
     */
    FivBottomSheet.prototype._renderer;
    /**
     * @type {?}
     * @private
     */
    FivBottomSheet.prototype._domCtrl;
    /**
     * @type {?}
     * @private
     */
    FivBottomSheet.prototype._platform;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYm90dG9tLXNoZWV0LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmaXZldGhyZWUvY29yZS8iLCJzb3VyY2VzIjpbImxpYi9ib3R0b20tc2hlZXQvYm90dG9tLXNoZWV0LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sdURBQXVELENBQUM7QUFDOUYsT0FBTyxFQUNMLFNBQVMsRUFHVCxLQUFLLEVBQ0wsTUFBTSxFQUNOLFlBQVksRUFDWixVQUFVLEVBQ1YsU0FBUyxFQUVULFlBQVksRUFFYixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQUUsYUFBYSxFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3pELE9BQU8sRUFBRSxXQUFXLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUM3QyxPQUFPLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxTQUFTLEVBQUUsSUFBSSxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3ZELE9BQU8sRUFDTCxTQUFTLEVBQ1QsR0FBRyxFQUNILEdBQUcsRUFDSCxPQUFPLEVBQ1AsTUFBTSxFQUNOLGNBQWMsRUFDZCxNQUFNLEVBQ04sS0FBSyxFQUNMLElBQUksRUFDSixVQUFVLEVBRVgsTUFBTSxnQkFBZ0IsQ0FBQzs7OztBQUV4Qiw4QkFPQzs7O0lBTkMsaUNBQXNCOztJQUN0QiwrQkFBb0I7O0lBQ3BCLDhCQUFtQjs7SUFDbkIsNEJBQWlCOztJQUNqQiw0QkFBaUI7O0lBQ2pCLHlCQUFrQjs7QUFHcEI7SUEwQ0Usd0JBQ1UsUUFBb0IsRUFDcEIsU0FBb0IsRUFDcEIsUUFBdUIsRUFDdkIsU0FBbUI7UUFIbkIsYUFBUSxHQUFSLFFBQVEsQ0FBWTtRQUNwQixjQUFTLEdBQVQsU0FBUyxDQUFXO1FBQ3BCLGFBQVEsR0FBUixRQUFRLENBQWU7UUFDdkIsY0FBUyxHQUFULFNBQVMsQ0FBVTtRQXhDcEIsaUJBQVksR0FBRyxFQUFF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RCw2QkFBSTs7O0lBQUo7UUFDRSxJQUFJLENBQUMsS0FBSyxHQUFHLFdBQVcsQ0FBQyxNQUFNLENBQUM7UUFDaEMsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDakMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7SUFDakMsQ0FBQzs7Z0JBNVNGLFNBQVMsU0FBQztvQkFDVCxRQUFRLEVBQUUsa0JBQWtCO29CQUM1QiwrR0FBNEM7O2lCQUU3Qzs7OztnQkFwQ0MsVUFBVTtnQkFDVixTQUFTO2dCQUtGLGFBQWE7Z0JBQUUsUUFBUTs7OytCQWdDN0IsS0FBSzsrQkFFTCxLQUFLOzhCQUVMLEtBQUs7NkJBRUwsS0FBSzt3QkFFTCxLQUFLO2tDQUVMLEtBQUs7K0JBQ0wsS0FBSzs2QkFFTCxLQUFLOzhCQUVMLE1BQU07MEJBR04sTUFBTTs0QkFHTixNQUFNOzJCQUdOLE1BQU07MEJBSU4sWUFBWSxTQUFDLHFCQUFxQjs7SUEyUXJDLHFCQUFDO0NBQUEsQUE3U0QsSUE2U0M7U0F4U1ksY0FBYzs7O0lBQ3pCLHNDQUEyQjs7SUFFM0Isc0NBQTZCOztJQUU3QixxQ0FBMEI7O0lBRTFCLG9DQUE4Qjs7SUFFOUIsK0JBQWlEOztJQUVqRCx5Q0FBOEI7O0lBQzlCLHNDQUEyQjs7SUFFM0Isb0NBQTJCOztJQUUzQixxQ0FFSTs7SUFDSixpQ0FFSTs7SUFDSixtQ0FFSTs7SUFDSixrQ0FFSTs7SUFFSixpQ0FBb0U7Ozs7O0lBRXBFLDJDQUFrQzs7SUFDbEMsOENBQTZCOztJQUM3QixtQ0FBYzs7SUFFZCxvQ0FBMkI7Ozs7O0lBR3pCLGtDQUE0Qjs7Ozs7SUFDNUIsbUNBQTRCOzs7OztJQUM1QixrQ0FBK0I7Ozs7O0lBQy9CLG1DQUEyQiIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEZpdkJvdHRvbVNoZWV0Q29udGVudCB9IGZyb20gJy4vYm90dG9tLXNoZWV0LWNvbnRlbnQvYm90dG9tLXNoZWV0LWNvbnRlbnQuY29tcG9uZW50JztcbmltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgT25DaGFuZ2VzLFxuICBJbnB1dCxcbiAgT3V0cHV0LFxuICBFdmVudEVtaXR0ZXIsXG4gIEVsZW1lbnRSZWYsXG4gIFJlbmRlcmVyMixcbiAgU2ltcGxlQ2hhbmdlcyxcbiAgQ29udGVudENoaWxkLFxuICBPbkRlc3Ryb3lcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBEb21Db250cm9sbGVyLCBQbGF0Zm9ybSB9IGZyb20gJ0Bpb25pYy9hbmd1bGFyJztcbmltcG9ydCB7IERyYXdlclN0YXRlIH0gZnJvbSAnLi9kcmF3ZXItc3RhdGUnO1xuaW1wb3J0IHsgbWVyZ2UsIFN1YmplY3QsIGZyb21FdmVudCwgZnJvbSB9IGZyb20gJ3J4anMnO1xuaW1wb3J0IHtcbiAgdGFrZVVudGlsLFxuICBtYXAsXG4gIHRhcCxcbiAgZmxhdE1hcCxcbiAgcmVwZWF0LFxuICB3aXRoTGF0ZXN0RnJvbSxcbiAgZmlsdGVyLFxuICBmaXJzdCxcbiAgdGFrZSxcbiAgcmVwZWF0V2hlbixcbiAgc2tpcFdoaWxlXG59IGZyb20gJ3J4anMvb3BlcmF0b3JzJztcblxuZXhwb3J0IGludGVyZmFjZSBQYW5FdmVudCB7XG4gIGN1cnJlbnRPZmZzZXQ6IG51bWJlcjtcbiAgc3RhcnRPZmZzZXQ6IG51bWJlcjtcbiAgY3VycmVudFRvcDogbnVtYmVyO1xuICBzdGFydFRvcDogbnVtYmVyO1xuICBkaXN0YW5jZTogbnVtYmVyO1xuICB0b3VjaDogVG91Y2hFdmVudDtcbn1cblxuQENvbXBvbmVudCh7XG4gIHNlbGVjdG9yOiAnZml2LWJvdHRvbS1zaGVldCcsXG4gIHRlbXBsYXRlVXJsOiAnLi9ib3R0b20tc2hlZXQuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9ib3R0b20tc2hlZXQuY29tcG9uZW50LnNjc3MnXVxufSlcbmV4cG9ydCBjbGFzcyBGaXZCb3R0b21TaGVldCBpbXBsZW1lbnRzIEFmdGVyVmlld0luaXQsIE9uQ2hhbmdlcywgT25EZXN0cm95IHtcbiAgQElucHV0KCkgZG9ja2VkSGVpZ2h0ID0gODA7XG5cbiAgQElucHV0KCkgc2hvdWxkQm91bmNlID0gdHJ1ZTtcblxuICBASW5wdXQoKSBkaXN0YW5jZVRvcCA9IDU2O1xuXG4gIEBJbnB1dCgpIHRyYW5zaXRpb24gPSAnMC4yNXMnO1xuXG4gIEBJbnB1dCgpIHN0YXRlOiBEcmF3ZXJTdGF0ZSA9IERyYXdlclN0YXRlLkJvdHRvbTtcblxuICBASW5wdXQoKSBib3VuY2VUaHJlc2hvbGQgPSA0MDtcbiAgQElucHV0KCkgcGFuVGhyZXNob2xkID0gMjA7XG5cbiAgQElucHV0KCkgcGFuRW5hYmxlZCA9IHRydWU7XG5cbiAgQE91dHB1dCgpIHN0YXRlQ2hhbmdlOiBFdmVudEVtaXR0ZXI8RHJhd2VyU3RhdGU+ID0gbmV3IEV2ZW50RW1pdHRlcjxcbiAgICBEcmF3ZXJTdGF0ZVxuICA+KCk7XG4gIEBPdXRwdXQoKSBmaXZPcGVuOiBFdmVudEVtaXR0ZXI8Rml2Qm90dG9tU2hlZXQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxcbiAgICBGaXZCb3R0b21TaGVldFxuICA+KCk7XG4gIEBPdXRwdXQoKSBmaXZEb2NrZWQ6IEV2ZW50RW1pdHRlcjxGaXZCb3R0b21TaGVldD4gPSBuZXcgRXZlbnRFbWl0dGVyPFxuICAgIEZpdkJvdHRvbVNoZWV0XG4gID4oKTtcbiAgQE91dHB1dCgpIGZpdkNsb3NlOiBFdmVudEVtaXR0ZXI8Rml2Qm90dG9tU2hlZXQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxcbiAgICBGaXZCb3R0b21TaGVldFxuICA+KCk7XG5cbiAgQENvbnRlbnRDaGlsZChGaXZCb3R0b21TaGVldENvbnRlbnQpIGNvbnRlbnQ6IEZpdkJvdHRvbVNoZWV0Q29udGVudDtcblxuICBwcml2YXRlIF9zdGFydFBvc2l0aW9uVG9wOiBudW1iZXI7XG4gIF9zdGFydFBvc2l0aW9uT2Zmc2V0OiBudW1iZXI7XG4gIHNjcm9sbFRvcCA9IDA7XG5cbiAgJG9uRGVzdHJveSA9IG5ldyBTdWJqZWN0KCk7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBfZWxlbWVudDogRWxlbWVudFJlZixcbiAgICBwcml2YXRlIF9yZW5kZXJlcjogUmVuZGVyZXIyLFxuICAgIHByaXZhdGUgX2RvbUN0cmw6IERvbUNvbnRyb2xsZXIsXG4gICAgcHJpdmF0ZSBfcGxhdGZvcm06IFBsYXRmb3JtXG4gICkge31cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLiRvbkRlc3Ryb3kubmV4dCgpO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIHRoaXMuX3NldERyYXdlclN0YXRlKHRoaXMuc3RhdGUpO1xuICAgIHRoaXMuY29udGVudC5zaG91bGRCb3VuY2UgPSB0aGlzLnNob3VsZEJvdW5jZTtcblxuICAgIGNvbnN0IHRvdWNobW92ZSA9IGZyb21FdmVudDxUb3VjaEV2ZW50PihcbiAgICAgIHRoaXMuX2VsZW1lbnQubmF0aXZlRWxlbWVudCxcbiAgICAgICd0b3VjaG1vdmUnLFxuICAgICAge1xuICAgICAgICBwYXNzaXZlOiB0cnVlXG4gICAgICB9XG4gICAgKTtcbiAgICBjb25zdCB0b3VjaGVuZCA9IG1lcmdlKFxuICAgICAgZnJvbUV2ZW50PFRvdWNoRXZlbnQ+KHRoaXMuX2VsZW1lbnQubmF0aXZlRWxlbWVudCwgJ3RvdWNoZW5kJywge1xuICAgICAgICBwYXNzaXZlOiB0cnVlXG4gICAgICB9KSxcbiAgICAgIGZyb21FdmVudDxUb3VjaEV2ZW50Pih0aGlzLl9lbGVtZW50Lm5hdGl2ZUVsZW1lbnQsICd0b3VjaGNhbmNlbCcsIHtcbiAgICAgICAgcGFzc2l2ZTogdHJ1ZVxuICAgICAgfSlcbiAgICApO1xuXG4gICAgY29uc3QgZ2V0U2Nyb2xsQ29udGVudCA9IGZyb20odGhpcy5jb250ZW50LmNvbnRlbnQuZ2V0U2Nyb2xsRWxlbWVudCgpKTtcblxuICAgIGNvbnN0IHNjcm9sbCA9IHRoaXMuY29udGVudC5jb250ZW50LmlvblNjcm9sbC5waXBlKFxuICAgICAgdGFwKGVsID0+ICh0aGlzLnNjcm9sbFRvcCA9IGVsLmRldGFpbC5zY3JvbGxUb3ApKSxcbiAgICAgIHRha2VVbnRpbCh0aGlzLiRvbkRlc3Ryb3kpXG4gICAgKTtcbiAgICBzY3JvbGwuc3Vic2NyaWJlKCk7XG5cbiAgICB0aGlzLmNvbnRlbnQuY29udGVudC5pb25TY3JvbGxFbmRcbiAgICAgIC5waXBlKFxuICAgICAgICBmaWx0ZXIoZWwgPT4gdGhpcy5zY3JvbGxUb3AgPT09IDAgJiYgdGhpcy5zdGF0ZSA9PT0gRHJhd2VyU3RhdGUuVG9wKSxcbiAgICAgICAgdGFwKCgpID0+IHRoaXMuY29udGVudC5jb250ZW50LnNjcm9sbEJ5UG9pbnQoMCwgMSwgMCkpLFxuICAgICAgICB0YWtlVW50aWwodGhpcy4kb25EZXN0cm95KVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgpO1xuXG4gICAgY29uc3QgY2FuU3RhcnQgPSB0b3VjaG1vdmUucGlwZShmaWx0ZXIoKCkgPT4gdGhpcy5zY3JvbGxUb3AgPT09IDApKTtcblxuICAgIGNvbnN0IHN0YXJ0ID0gY2FuU3RhcnQucGlwZShcbiAgICAgIHRha2UoMSksXG4gICAgICB0YXAoKHM6IFRvdWNoRXZlbnQpID0+IHRoaXMuX2hhbmRsZVBhblN0YXJ0KHMpKVxuICAgICk7XG5cbiAgICBjb25zdCBwYW4gPSBzdGFydC5waXBlKFxuICAgICAgZmlsdGVyKCgpID0+IHRoaXMucGFuRW5hYmxlZCksXG4gICAgICBmbGF0TWFwKCgpID0+IHRvdWNobW92ZSksXG4gICAgICBtYXAoKHRtOiBUb3VjaEV2ZW50KSA9PiB0aGlzLmNhbGN1bGF0ZVBhbkV2ZW50KHRtKSlcbiAgICApO1xuXG4gICAgY29uc3QgaGFuZGxlUGFuID0gcGFuLnBpcGUoXG4gICAgICBmaWx0ZXIocCA9PiBNYXRoLmFicyhwLmRpc3RhbmNlKSA+IHRoaXMucGFuVGhyZXNob2xkKSxcbiAgICAgIG1hcCh0bSA9PiB0aGlzLl9oYW5kbGVQYW4odG0pKSxcbiAgICAgIHRha2VVbnRpbCh0b3VjaGVuZCksXG4gICAgICByZXBlYXQoKSxcbiAgICAgIHRha2VVbnRpbCh0aGlzLiRvbkRlc3Ryb3kpXG4gICAgKTtcblxuICAgIGNvbnN0IGhhbmRsZUJhY2tQYW4gPSBwYW5cbiAgICAgIC5waXBlKFxuICAgICAgICBmaWx0ZXIoXG4gICAgICAgICAgcCA9PiBNYXRoLmFicyhwLmRpc3RhbmNlKSA8PSB0aGlzLnBhblRocmVzaG9sZCAmJiB0aGlzLmNvbnRlbnQucGFubmluZ1xuICAgICAgICApLFxuICAgICAgICBtYXAodG0gPT4gdGhpcy5faGFuZGxlUGFuKHRtKSksXG4gICAgICAgIHRha2VVbnRpbCh0b3VjaGVuZCksXG4gICAgICAgIHJlcGVhdCgpLFxuICAgICAgICB0YWtlVW50aWwodGhpcy4kb25EZXN0cm95KVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZSgpO1xuXG4gICAgaGFuZGxlUGFuXG4gICAgICAucGlwZShcbiAgICAgICAgZmlyc3QoKSxcbiAgICAgICAgdGFwKCgpID0+ICh0aGlzLmNvbnRlbnQucGFubmluZyA9IHRydWUpKSxcbiAgICAgICAgcmVwZWF0V2hlbigoKSA9PiB0b3VjaGVuZCksXG4gICAgICAgIHRha2VVbnRpbCh0aGlzLiRvbkRlc3Ryb3kpXG4gICAgICApXG4gICAgICAuc3Vic2NyaWJlKCk7XG5cbiAgICBoYW5kbGVQYW5cbiAgICAgIC5waXBlKFxuICAgICAgICBmbGF0TWFwKCgpID0+IHRvdWNoZW5kKSxcbiAgICAgICAgZmlyc3QoKSxcbiAgICAgICAgd2l0aExhdGVzdEZyb208VG91Y2hFdmVudCwgUGFuRXZlbnQ+KHBhbiksXG4gICAgICAgIHRhcCgoKSA9PiB0aGlzLmNvbnRlbnQuY29udGVudC5zY3JvbGxCeVBvaW50KDAsIDEsIDApKSxcbiAgICAgICAgdGFwKCgpID0+ICh0aGlzLmNvbnRlbnQucGFubmluZyA9IGZhbHNlKSksXG4gICAgICAgIG1hcChldiA9PiBldlsxXSksXG4gICAgICAgIHJlcGVhdCgpLFxuICAgICAgICB0YWtlVW50aWw8UGFuRXZlbnQ+KHRoaXMuJG9uRGVzdHJveSlcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoZXYgPT4gdGhpcy5faGFuZGxlUGFuRW5kKGV2KSk7XG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgaWYgKCFjaGFuZ2VzLnN0YXRlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuX3NldERyYXdlclN0YXRlKGNoYW5nZXMuc3RhdGUuY3VycmVudFZhbHVlKTtcbiAgICB0aGlzLnVwZGF0ZUNvbnRlbnQoY2hhbmdlcy5zdGF0ZS5jdXJyZW50VmFsdWUpO1xuICB9XG5cbiAgdXBkYXRlQ29udGVudChzdGF0ZTogRHJhd2VyU3RhdGUpIHtcbiAgICBpZiAodGhpcy5jb250ZW50KSB7XG4gICAgICB0aGlzLmNvbnRlbnQudXBkYXRlU3RhdGUoc3RhdGUpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX3NldERyYXdlclN0YXRlKHN0YXRlOiBEcmF3ZXJTdGF0ZSkge1xuICAgIHRoaXMuX3JlbmRlcmVyLnNldFN0eWxlKFxuICAgICAgdGhpcy5fZWxlbWVudC5uYXRpdmVFbGVtZW50LFxuICAgICAgJ3RyYW5zaXRpb24nLFxuICAgICAgdGhpcy50cmFuc2l0aW9uXG4gICAgKTtcbiAgICBzd2l0Y2ggKHN0YXRlKSB7XG4gICAgICBjYXNlIERyYXdlclN0YXRlLkJvdHRvbTpcbiAgICAgICAgdGhpcy5jb250ZW50LmNvbnRlbnQuc2Nyb2xsVG9Ub3AoMCk7XG4gICAgICAgIHRoaXMuX3NldFRyYW5zbGF0ZVkoJzEwMHZoJyk7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSBEcmF3ZXJTdGF0ZS5Eb2NrZWQ6XG4gICAgICAgIHRoaXMuY29udGVudC5jb250ZW50LnNjcm9sbFRvVG9wKDApO1xuICAgICAgICB0aGlzLl9zZXRUcmFuc2xhdGVZKHRoaXMuX3BsYXRmb3JtLmhlaWdodCgpIC0gdGhpcy5kb2NrZWRIZWlnaHQgKyAncHgnKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBkZWZhdWx0OlxuICAgICAgICB0aGlzLl9zZXRUcmFuc2xhdGVZKHRoaXMuZGlzdGFuY2VUb3AgKyAncHgnKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF9oYW5kbGVQYW5TdGFydChldmVudDogVG91Y2hFdmVudCkge1xuICAgIHRoaXMuX3N0YXJ0UG9zaXRpb25Ub3AgPSB0aGlzLmdldEN1cnJlbnRUb3AoKTtcbiAgICB0aGlzLl9zdGFydFBvc2l0aW9uT2Zmc2V0ID0gZXZlbnQudG91Y2hlc1swXS5wYWdlWTtcbiAgfVxuXG4gIGdldEN1cnJlbnRUb3AoKSB7XG4gICAgcmV0dXJuIHRoaXMuX2VsZW1lbnQubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKS50b3A7XG4gIH1cblxuICBwcml2YXRlIF9oYW5kbGVQYW5FbmQoZXY6IFBhbkV2ZW50KSB7XG4gICAgaWYgKHRoaXMuc2hvdWxkQm91bmNlKSB7XG4gICAgICB0aGlzLl9yZW5kZXJlci5zZXRTdHlsZShcbiAgICAgICAgdGhpcy5fZWxlbWVudC5uYXRpdmVFbGVtZW50LFxuICAgICAgICAndHJhbnNpdGlvbicsXG4gICAgICAgIHRoaXMudHJhbnNpdGlvblxuICAgICAgKTtcblxuICAgICAgc3dpdGNoICh0aGlzLnN0YXRlKSB7XG4gICAgICAgIGNhc2UgRHJhd2VyU3RhdGUuRG9ja2VkOlxuICAgICAgICAgIHRoaXMuX2hhbmRsZURvY2tlZFBhbkVuZChldik7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGNhc2UgRHJhd2VyU3RhdGUuVG9wOlxuICAgICAgICAgIHRoaXMuX2hhbmRsZVRvcFBhbkVuZChldik7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgdGhpcy5faGFuZGxlQm90dG9tUGFuRW5kKGV2KTtcbiAgICAgIH1cbiAgICB9XG4gICAgdGhpcy5zdGF0ZUNoYW5nZS5lbWl0KHRoaXMuc3RhdGUpO1xuICB9XG5cbiAgcHJpdmF0ZSBfaGFuZGxlVG9wUGFuRW5kKGV2OiBQYW5FdmVudCkge1xuICAgIGlmIChldi5kaXN0YW5jZSA+IHRoaXMuYm91bmNlVGhyZXNob2xkKSB7XG4gICAgICBpZiAodGhpcy5zdGF0ZSAhPT0gRHJhd2VyU3RhdGUuRG9ja2VkKSB7XG4gICAgICAgIHRoaXMuc3RhdGUgPSBEcmF3ZXJTdGF0ZS5Eb2NrZWQ7XG4gICAgICAgIHRoaXMuZml2RG9ja2VkLmVtaXQodGhpcyk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuX3NldFRyYW5zbGF0ZVkodGhpcy5kaXN0YW5jZVRvcCArICdweCcpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgX2hhbmRsZURvY2tlZFBhbkVuZChldjogUGFuRXZlbnQpIHtcbiAgICBjb25zdCBhYnNEZWx0YVkgPSBNYXRoLmFicyhldi5kaXN0YW5jZSk7XG4gICAgaWYgKGFic0RlbHRhWSA+IHRoaXMuYm91bmNlVGhyZXNob2xkICYmIGV2LmRpc3RhbmNlIDwgMCkge1xuICAgICAgaWYgKHRoaXMuc3RhdGUgIT09IERyYXdlclN0YXRlLlRvcCkge1xuICAgICAgICB0aGlzLnN0YXRlID0gRHJhd2VyU3RhdGUuVG9wO1xuICAgICAgICB0aGlzLmZpdk9wZW4uZW1pdCgpO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoYWJzRGVsdGFZID4gdGhpcy5ib3VuY2VUaHJlc2hvbGQgJiYgZXYuZGlzdGFuY2UgPiAwKSB7XG4gICAgICBpZiAodGhpcy5zdGF0ZSAhPT0gRHJhd2VyU3RhdGUuQm90dG9tKSB7XG4gICAgICAgIHRoaXMuc3RhdGUgPSBEcmF3ZXJTdGF0ZS5Cb3R0b207XG4gICAgICAgIHRoaXMuZml2Q2xvc2UuZW1pdCgpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9zZXRUcmFuc2xhdGVZKHRoaXMuX3BsYXRmb3JtLmhlaWdodCgpIC0gdGhpcy5kb2NrZWRIZWlnaHQgKyAncHgnKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIF9oYW5kbGVCb3R0b21QYW5FbmQoZXY6IFBhbkV2ZW50KSB7XG4gICAgaWYgKC1ldi5kaXN0YW5jZSA+IHRoaXMuYm91bmNlVGhyZXNob2xkKSB7XG4gICAgICBpZiAodGhpcy5zdGF0ZSAhPT0gRHJhd2VyU3RhdGUuRG9ja2VkKSB7XG4gICAgICAgIHRoaXMuc3RhdGUgPSBEcmF3ZXJTdGF0ZS5Eb2NrZWQ7XG4gICAgICAgIHRoaXMuZml2RG9ja2VkLmVtaXQoKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fc2V0VHJhbnNsYXRlWSgnMTAwdmgnKTtcbiAgICB9XG4gIH1cblxuICBjYWxjdWxhdGVQYW5FdmVudChldjogVG91Y2hFdmVudCk6IFBhbkV2ZW50IHtcbiAgICByZXR1cm4ge1xuICAgICAgY3VycmVudE9mZnNldDogZXYudG91Y2hlc1swXS5wYWdlWSxcbiAgICAgIHN0YXJ0T2Zmc2V0OiB0aGlzLl9zdGFydFBvc2l0aW9uT2Zmc2V0LFxuICAgICAgc3RhcnRUb3A6IHRoaXMuX3N0YXJ0UG9zaXRpb25Ub3AsXG4gICAgICBjdXJyZW50VG9wOiB0aGlzLmdldEN1cnJlbnRUb3AoKSxcbiAgICAgIGRpc3RhbmNlOiBldi50b3VjaGVzWzBdLnBhZ2VZIC0gdGhpcy5fc3RhcnRQb3NpdGlvbk9mZnNldCxcbiAgICAgIHRvdWNoOiBldlxuICAgIH07XG4gIH1cblxuICBwcml2YXRlIF9oYW5kbGVQYW4oZXZlbnQ6IFBhbkV2ZW50KSB7XG4gICAgdGhpcy5fcmVuZGVyZXIuc2V0U3R5bGUodGhpcy5fZWxlbWVudC5uYXRpdmVFbGVtZW50LCAndHJhbnNpdGlvbicsICdub25lJyk7XG4gICAgaWYgKGV2ZW50LmN1cnJlbnRUb3AgPj0gMCAmJiBldmVudC5jdXJyZW50VG9wIDw9IHRoaXMuX3BsYXRmb3JtLmhlaWdodCgpKSB7XG4gICAgICBjb25zdCBuZXdUb3AgPSB0aGlzLl9zdGFydFBvc2l0aW9uVG9wICsgZXZlbnQuZGlzdGFuY2U7XG4gICAgICBpZiAobmV3VG9wID49IHRoaXMuZGlzdGFuY2VUb3ApIHtcbiAgICAgICAgdGhpcy5fc2V0VHJhbnNsYXRlWShuZXdUb3AgKyAncHgnKTtcbiAgICAgIH0gZWxzZSBpZiAobmV3VG9wIDw9IHRoaXMuZGlzdGFuY2VUb3AgJiYgdGhpcy5jb250ZW50LnBhbm5pbmcpIHtcbiAgICAgICAgdGhpcy5fc2V0VHJhbnNsYXRlWSh0aGlzLmRpc3RhbmNlVG9wICsgJ3B4Jyk7XG4gICAgICAgIHRoaXMuY29udGVudC5jb250ZW50LnNjcm9sbFRvUG9pbnQoMCwgMCAtIG5ld1RvcCwgMCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZXZlbnQ7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBfc2V0VHJhbnNsYXRlWSh2YWx1ZSkge1xuICAgIHRoaXMuX2RvbUN0cmwud3JpdGUoKCkgPT4ge1xuICAgICAgdGhpcy5fcmVuZGVyZXIuc2V0U3R5bGUoXG4gICAgICAgIHRoaXMuX2VsZW1lbnQubmF0aXZlRWxlbWVudCxcbiAgICAgICAgJ3RyYW5zZm9ybScsXG4gICAgICAgICd0cmFuc2xhdGVZKCcgKyB2YWx1ZSArICcpJ1xuICAgICAgKTtcbiAgICB9KTtcbiAgfVxuXG4gIG9wZW4oKSB7XG4gICAgdGhpcy5zdGF0ZSA9IERyYXdlclN0YXRlLlRvcDtcbiAgICB0aGlzLl9zZXREcmF3ZXJTdGF0ZSh0aGlzLnN0YXRlKTtcbiAgICB0aGlzLnVwZGF0ZUNvbnRlbnQodGhpcy5zdGF0ZSk7XG4gIH1cblxuICBjbG9zZSgpIHtcbiAgICB0aGlzLnN0YXRlID0gRHJhd2VyU3RhdGUuQm90dG9tO1xuICAgIHRoaXMuX3NldERyYXdlclN0YXRlKHRoaXMuc3RhdGUpO1xuICAgIHRoaXMudXBkYXRlQ29udGVudCh0aGlzLnN0YXRlKTtcbiAgfVxuXG4gIGRvY2soKSB7XG4gICAgdGhpcy5zdGF0ZSA9IERyYXdlclN0YXRlLkRvY2tlZDtcbiAgICB0aGlzLl9zZXREcmF3ZXJTdGF0ZSh0aGlzLnN0YXRlKTtcbiAgICB0aGlzLnVwZGF0ZUNvbnRlbnQodGhpcy5zdGF0ZSk7XG4gIH1cbn1cbiJdfQ==