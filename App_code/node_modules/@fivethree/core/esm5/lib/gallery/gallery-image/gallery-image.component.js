/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ElementRef, ViewChild, Output, EventEmitter } from '@angular/core';
import { trigger, transition, style, animate, state, keyframes } from '@angular/animations';
import { FivOverlay } from '../../overlay/overlay.component';
var FivGalleryImage = /** @class */ (function () {
    function FivGalleryImage() {
        this.viewerState = 'in';
        this.backdropColor = 'rgb(0,0,0)';
        this.openTiming = '300ms';
        this.closeTiming = '340ms';
        this.willOpen = new EventEmitter();
        this.didOpen = new EventEmitter();
        this.didClose = new EventEmitter();
    }
    /**
     * @return {?}
     */
    FivGalleryImage.prototype.ngOnInit = /**
     * @return {?}
     */
    function () { };
    /**
     * @return {?}
     */
    FivGalleryImage.prototype.open = /**
     * @return {?}
     */
    function () {
        this.willOpen.emit(this);
        /** @type {?} */
        var p = this.getThumbnailPosition(this.image);
        this.animationParams = {
            translate: p.translate,
            timing: this.openTiming,
            height: p.height,
            width: p.width,
            top: p.top,
            left: p.left
        };
        this.overlay.show(49999);
    };
    /**
     * @param {?} position
     * @return {?}
     */
    FivGalleryImage.prototype.close = /**
     * @param {?} position
     * @return {?}
     */
    function (position) {
        /** @type {?} */
        var p = this.getThumbnailPosition(this.image);
        this.animationParams = {
            translate: position.translate,
            timing: this.closeTiming,
            height: p.height,
            width: p.width,
            top: p.top,
            left: p.left
        };
        this.viewerState = 'out';
    };
    /**
     * @param {?} position
     * @param {?} src
     * @return {?}
     */
    FivGalleryImage.prototype.slideOut = /**
     * @param {?} position
     * @param {?} src
     * @return {?}
     */
    function (position, src) {
        this.originalSrc = src;
        /** @type {?} */
        var p = this.getThumbnailPosition(this.image);
        this.animationParams = {
            translate: position.translate,
            timing: this.closeTiming,
            height: p.height,
            width: p.width,
            top: p.top,
            left: p.left
        };
        this.viewerState = 'slideout';
    };
    /**
     * @param {?} event
     * @return {?}
     */
    FivGalleryImage.prototype.handleViewerAnimation = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        if (event.fromState === 'void' && event.toState === 'in') {
            this.didOpen.emit(this);
        }
        if ((event.fromState === 'in' || event.fromState === 'hidden') &&
            (event.toState === 'out' || event.toState === 'slideout')) {
            this.overlay.hide();
            this.didClose.emit(this);
            this.viewerState = 'in';
        }
        if (event.toState === 'slideout') {
            this.src = this.originalSrc;
        }
    };
    /**
     * @private
     * @param {?} element
     * @return {?}
     */
    FivGalleryImage.prototype.getThumbnailPosition = /**
     * @private
     * @param {?} element
     * @return {?}
     */
    function (element) {
        /** @type {?} */
        var bounds = element.nativeElement.getBoundingClientRect();
        return {
            top: bounds.top,
            left: bounds.left,
            height: element.nativeElement.clientHeight,
            width: element.nativeElement.clientWidth
        };
    };
    FivGalleryImage.decorators = [
        { type: Component, args: [{
                    selector: 'fiv-gallery-image',
                    template: "<ng-container *ngIf=\"!overlay.open && !src\">\n  <ng-content></ng-content>\n</ng-container>\n\n<img #thumbnail [ngClass]=\"{'hidden': (overlay.open || !src)}\" class=\"thumbnail\" [src]=\"src\" (click)=\"open()\">\n<fiv-overlay #overlay>\n\n  <div [style.backgroundColor]=\"backdropColor\"\n    *ngIf=\"overlay.open && viewerState !== 'out' && viewerState !== 'slideout'\" [@fade]=\"viewerState\" class=\"backdrop\">\n  </div>\n\n  <img *ngIf=\"overlay.open\" class=\"viewer-image\" (@image.done)=\"handleViewerAnimation($event)\"\n    [@image]=\"{ value: viewerState, params : animationParams}\" [src]=\"src\">\n\n</fiv-overlay>",
                    animations: [
                        trigger('image', [
                            transition('* => in', [
                                style({
                                    position: 'absolute',
                                    top: '{{top}}px',
                                    left: '{{left}}px',
                                    transform: 'translate(0%,0%)',
                                    height: '{{height}}px',
                                    width: '{{width}}px',
                                    opacity: 1,
                                    borderRadius: '*'
                                }),
                                animate('{{timing}}', style({
                                    position: 'absolute',
                                    top: '50%',
                                    left: '50%',
                                    transform: 'translate(-50%,-50%)',
                                    height: '*',
                                    width: '*',
                                    opacity: 1,
                                    borderRadius: '0'
                                }))
                            ], {
                                params: {
                                    top: '0',
                                    left: '0',
                                    height: '*',
                                    width: '*',
                                    timing: '300ms'
                                }
                            }),
                            transition('* => out', [
                                style({
                                    position: 'absolute',
                                    top: '{{translate}}px',
                                    left: '50%',
                                    transform: 'translate(-50%,-50%)',
                                    height: '*',
                                    width: '*',
                                    opacity: 1,
                                    borderRadius: '0'
                                }),
                                animate('{{timing}}', style({
                                    position: 'absolute',
                                    top: '{{top}}px',
                                    left: '{{left}}px',
                                    transform: 'translate(0%,0%)',
                                    height: '{{height}}px',
                                    width: '{{width}}px',
                                    opacity: 1,
                                    borderRadius: '*'
                                }))
                            ], {
                                params: {
                                    top: '0',
                                    left: '0',
                                    height: '*',
                                    width: '*',
                                    translate: '0',
                                    timing: '340ms'
                                }
                            }),
                            state('hidden', style({ opacity: 0 })),
                            transition('* => slideout', [
                                style({
                                    position: 'absolute',
                                    top: '{{translate}}px',
                                    left: '50%',
                                    transform: 'translate(-50%,-50%)',
                                    opacity: 1,
                                    borderRadius: '0'
                                }),
                                animate('{{timing}}', style({
                                    transform: 'translate(-50%,100%)',
                                    opacity: 0.2,
                                    borderRadius: '0'
                                }))
                            ], {
                                params: {
                                    top: '0',
                                    left: '0',
                                    height: '*',
                                    width: '*',
                                    translate: '0',
                                    timing: '340ms'
                                }
                            })
                        ]),
                        trigger('fade', [
                            transition('void => *', [
                                style({ opacity: 0 }),
                                animate('180ms', keyframes([
                                    style({ opacity: 0, offset: 0 }),
                                    style({ opacity: 0.3, offset: 0.75 }),
                                    style({ opacity: 0.97, offset: 1 })
                                ]))
                            ]),
                            transition(':leave', [
                                style({ opacity: 0.97 }),
                                animate('180ms', keyframes([
                                    style({ opacity: 0.97, offset: 0 }),
                                    style({ opacity: 0.6, offset: 0.8 }),
                                    style({ opacity: 0, offset: 1 })
                                ]))
                            ])
                        ])
                    ],
                    styles: [":host{display:block;--max-height:100%;--border-radius:0px;min-height:var(--max-height);--background:var(--ion-color-light);background:var(--background)}.backdrop{width:100vw;height:100vh;opacity:.97;position:absolute;transition:background-color .3s}.thumbnail{-o-object-position:center;object-position:center;-o-object-fit:cover;object-fit:cover;display:block;height:var(--height,auto);max-height:var(--max-height);width:var(--width,100%);border-radius:var(--border-radius)}.hidden{opacity:0}.viewer-image{-o-object-position:center;object-position:center;-o-object-fit:cover;object-fit:cover;position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);height:auto;max-height:100%;width:auto;max-width:100%;border-radius:var(--border-radius)}"]
                }] }
    ];
    /** @nocollapse */
    FivGalleryImage.ctorParameters = function () { return []; };
    FivGalleryImage.propDecorators = {
        src: [{ type: Input }],
        image: [{ type: ViewChild, args: ['thumbnail',] }],
        overlay: [{ type: ViewChild, args: ['overlay',] }],
        willOpen: [{ type: Output }],
        didOpen: [{ type: Output }],
        didClose: [{ type: Output }]
    };
    return FivGalleryImage;
}());
export { FivGalleryImage };
if (false) {
    /** @type {?} */
    FivGalleryImage.prototype.src;
    /** @type {?} */
    FivGalleryImage.prototype.originalSrc;
    /** @type {?} */
    FivGalleryImage.prototype.index;
    /** @type {?} */
    FivGalleryImage.prototype.image;
    /** @type {?} */
    FivGalleryImage.prototype.overlay;
    /** @type {?} */
    FivGalleryImage.prototype.viewerState;
    /** @type {?} */
    FivGalleryImage.prototype.animationParams;
    /** @type {?} */
    FivGalleryImage.prototype.backdropColor;
    /** @type {?} */
    FivGalleryImage.prototype.openTiming;
    /** @type {?} */
    FivGalleryImage.prototype.closeTiming;
    /** @type {?} */
    FivGalleryImage.prototype.willOpen;
    /** @type {?} */
    FivGalleryImage.prototype.didOpen;
    /** @type {?} */
    FivGalleryImage.prototype.didClose;
}
var Position = /** @class */ (function () {
    function Position() {
    }
    return Position;
}());
export { Position };
if (false) {
    /** @type {?} */
    Position.prototype.top;
    /** @type {?} */
    Position.prototype.left;
    /** @type {?} */
    Position.prototype.height;
    /** @type {?} */
    Position.prototype.width;
    /** @type {?} */
    Position.prototype.translate;
}
/**
 * @record
 */
export function AnimationParams() { }
if (false) {
    /** @type {?} */
    AnimationParams.prototype.timing;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2FsbGVyeS1pbWFnZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZml2ZXRocmVlL2NvcmUvIiwic291cmNlcyI6WyJsaWIvZ2FsbGVyeS9nYWxsZXJ5LWltYWdlL2dhbGxlcnktaW1hZ2UuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUVULEtBQUssRUFDTCxVQUFVLEVBQ1YsU0FBUyxFQUNULE1BQU0sRUFDTixZQUFZLEVBQ2IsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUNMLE9BQU8sRUFDUCxVQUFVLEVBQ1YsS0FBSyxFQUNMLE9BQU8sRUFDUCxLQUFLLEVBRUwsU0FBUyxFQUNWLE1BQU0scUJBQXFCLENBQUM7QUFDN0IsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBRTdEO0lBK0pFO1FBWEEsZ0JBQVcsR0FBRyxJQUFJLENBQUM7UUFHbkIsa0JBQWEsR0FBRyxZQUFZLENBQUM7UUFDN0IsZUFBVSxHQUFHLE9BQU8sQ0FBQztRQUNyQixnQkFBVyxHQUFHLE9BQU8sQ0FBQztRQUVaLGFBQVEsR0FBRyxJQUFJLFlBQVksRUFBbUIsQ0FBQztRQUMvQyxZQUFPLEdBQUcsSUFBSSxZQUFZLEVBQW1CLENBQUM7UUFDOUMsYUFBUSxHQUFHLElBQUksWUFBWSxFQUFtQixDQUFDO0lBRTFDLENBQUM7Ozs7SUFFaEIsa0NBQVE7OztJQUFSLGNBQVksQ0FBQzs7OztJQUViLDhCQUFJOzs7SUFBSjtRQUNFLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDOztZQUNuQixDQUFDLEdBQUcsSUFBSSxDQUFDLG9CQUFvQixDQUFDLElBQUksQ0FBQyxLQUFLLENBQUM7UUFDL0MsSUFBSSxDQUFDLGVBQWUsR0FBRztZQUNyQixTQUFTLEVBQUUsQ0FBQyxDQUFDLFNBQVM7WUFDdEIsTUFBTSxFQUFFLElBQUksQ0FBQyxVQUFVO1lBQ3ZC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LElBeU9DO1NBN0ZZLGVBQWU7OztJQUMxQiw4QkFBdUM7O0lBQ3ZDLHNDQUFzQzs7SUFDdEMsZ0NBQWM7O0lBRWQsZ0NBQTBDOztJQUMxQyxrQ0FBMEM7O0lBRTFDLHNDQUFtQjs7SUFDbkIsMENBQWlDOztJQUVqQyx3Q0FBNkI7O0lBQzdCLHFDQUFxQjs7SUFDckIsc0NBQXNCOztJQUV0QixtQ0FBeUQ7O0lBQ3pELGtDQUF3RDs7SUFDeEQsbUNBQXlEOztBQThFM0Q7SUFBQTtJQU1BLENBQUM7SUFBRCxlQUFDO0FBQUQsQ0FBQyxBQU5ELElBTUM7Ozs7SUFMQyx1QkFBWTs7SUFDWix3QkFBYTs7SUFDYiwwQkFBZTs7SUFDZix5QkFBYzs7SUFDZCw2QkFBbUI7Ozs7O0FBR3JCLHFDQUVDOzs7SUFEQyxpQ0FBZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgT25Jbml0LFxuICBJbnB1dCxcbiAgRWxlbWVudFJlZixcbiAgVmlld0NoaWxkLFxuICBPdXRwdXQsXG4gIEV2ZW50RW1pdHRlclxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFNhZmVSZXNvdXJjZVVybCB9IGZyb20gJ0Bhbmd1bGFyL3BsYXRmb3JtLWJyb3dzZXInO1xuaW1wb3J0IHtcbiAgdHJpZ2dlcixcbiAgdHJhbnNpdGlvbixcbiAgc3R5bGUsXG4gIGFuaW1hdGUsXG4gIHN0YXRlLFxuICBBbmltYXRpb25FdmVudCxcbiAga2V5ZnJhbWVzXG59IGZyb20gJ0Bhbmd1bGFyL2FuaW1hdGlvbnMnO1xuaW1wb3J0IHsgRml2T3ZlcmxheSB9IGZyb20gJy4uLy4uL292ZXJsYXkvb3ZlcmxheS5jb21wb25lbnQnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdmaXYtZ2FsbGVyeS1pbWFnZScsXG4gIHRlbXBsYXRlVXJsOiAnLi9nYWxsZXJ5LWltYWdlLmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vZ2FsbGVyeS1pbWFnZS5jb21wb25lbnQuc2NzcyddLFxuICBhbmltYXRpb25zOiBbXG4gICAgdHJpZ2dlcignaW1hZ2UnLCBbXG4gICAgICB0cmFuc2l0aW9uKFxuICAgICAgICAnKiA9PiBpbicsXG4gICAgICAgIFtcbiAgICAgICAgICBzdHlsZSh7XG4gICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgICAgICAgIHRvcDogJ3t7dG9wfX1weCcsXG4gICAgICAgICAgICBsZWZ0OiAne3tsZWZ0fX1weCcsXG4gICAgICAgICAgICB0cmFuc2Zvcm06ICd0cmFuc2xhdGUoMCUsMCUpJyxcbiAgICAgICAgICAgIGhlaWdodDogJ3t7aGVpZ2h0fX1weCcsXG4gICAgICAgICAgICB3aWR0aDogJ3t7d2lkdGh9fXB4JyxcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICBib3JkZXJSYWRpdXM6ICcqJ1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIGFuaW1hdGUoXG4gICAgICAgICAgICAne3t0aW1pbmd9fScsXG4gICAgICAgICAgICBzdHlsZSh7XG4gICAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgICAgICAgICB0b3A6ICc1MCUnLFxuICAgICAgICAgICAgICBsZWZ0OiAnNTAlJyxcbiAgICAgICAgICAgICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlKC01MCUsLTUwJSknLFxuICAgICAgICAgICAgICBoZWlnaHQ6ICcqJyxcbiAgICAgICAgICAgICAgd2lkdGg6ICcqJyxcbiAgICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAnMCdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKVxuICAgICAgICBdLFxuICAgICAgICB7XG4gICAgICAgICAgcGFyYW1zOiB7XG4gICAgICAgICAgICB0b3A6ICcwJyxcbiAgICAgICAgICAgIGxlZnQ6ICcwJyxcbiAgICAgICAgICAgIGhlaWdodDogJyonLFxuICAgICAgICAgICAgd2lkdGg6ICcqJyxcbiAgICAgICAgICAgIHRpbWluZzogJzMwMG1zJ1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKSxcbiAgICAgIHRyYW5zaXRpb24oXG4gICAgICAgICcqID0+IG91dCcsXG4gICAgICAgIFtcbiAgICAgICAgICBzdHlsZSh7XG4gICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgICAgICAgIHRvcDogJ3t7dHJhbnNsYXRlfX1weCcsXG4gICAgICAgICAgICBsZWZ0OiAnNTAlJyxcbiAgICAgICAgICAgIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZSgtNTAlLC01MCUpJyxcbiAgICAgICAgICAgIGhlaWdodDogJyonLFxuICAgICAgICAgICAgd2lkdGg6ICcqJyxcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICBib3JkZXJSYWRpdXM6ICcwJ1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIGFuaW1hdGUoXG4gICAgICAgICAgICAne3t0aW1pbmd9fScsXG4gICAgICAgICAgICBzdHlsZSh7XG4gICAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgICAgICAgICB0b3A6ICd7e3RvcH19cHgnLFxuICAgICAgICAgICAgICBsZWZ0OiAne3tsZWZ0fX1weCcsXG4gICAgICAgICAgICAgIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZSgwJSwwJSknLFxuICAgICAgICAgICAgICBoZWlnaHQ6ICd7e2hlaWdodH19cHgnLFxuICAgICAgICAgICAgICB3aWR0aDogJ3t7d2lkdGh9fXB4JyxcbiAgICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgICAgYm9yZGVyUmFkaXVzOiAnKidcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKVxuICAgICAgICBdLFxuICAgICAgICB7XG4gICAgICAgICAgcGFyYW1zOiB7XG4gICAgICAgICAgICB0b3A6ICcwJyxcbiAgICAgICAgICAgIGxlZnQ6ICcwJyxcbiAgICAgICAgICAgIGhlaWdodDogJyonLFxuICAgICAgICAgICAgd2lkdGg6ICcqJyxcbiAgICAgICAgICAgIHRyYW5zbGF0ZTogJzAnLFxuICAgICAgICAgICAgdGltaW5nOiAnMzQwbXMnXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApLFxuICAgICAgc3RhdGUoJ2hpZGRlbicsIHN0eWxlKHsgb3BhY2l0eTogMCB9KSksXG4gICAgICB0cmFuc2l0aW9uKFxuICAgICAgICAnKiA9PiBzbGlkZW91dCcsXG4gICAgICAgIFtcbiAgICAgICAgICBzdHlsZSh7XG4gICAgICAgICAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICAgICAgICAgIHRvcDogJ3t7dHJhbnNsYXRlfX1weCcsXG4gICAgICAgICAgICBsZWZ0OiAnNTAlJyxcbiAgICAgICAgICAgIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZSgtNTAlLC01MCUpJyxcbiAgICAgICAgICAgIG9wYWNpdHk6IDEsXG4gICAgICAgICAgICBib3JkZXJSYWRpdXM6ICcwJ1xuICAgICAgICAgIH0pLFxuICAgICAgICAgIGFuaW1hdGUoXG4gICAgICAgICAgICAne3t0aW1pbmd9fScsXG4gICAgICAgICAgICBzdHlsZSh7XG4gICAgICAgICAgICAgIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZSgtNTAlLDEwMCUpJyxcbiAgICAgICAgICAgICAgb3BhY2l0eTogMC4yLFxuICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICcwJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICApXG4gICAgICAgIF0sXG4gICAgICAgIHtcbiAgICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICAgIHRvcDogJzAnLFxuICAgICAgICAgICAgbGVmdDogJzAnLFxuICAgICAgICAgICAgaGVpZ2h0OiAnKicsXG4gICAgICAgICAgICB3aWR0aDogJyonLFxuICAgICAgICAgICAgdHJhbnNsYXRlOiAnMCcsXG4gICAgICAgICAgICB0aW1pbmc6ICczNDBtcydcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIClcbiAgICBdKSxcbiAgICB0cmlnZ2VyKCdmYWRlJywgW1xuICAgICAgdHJhbnNpdGlvbigndm9pZCA9PiAqJywgW1xuICAgICAgICBzdHlsZSh7IG9wYWNpdHk6IDAgfSksXG4gICAgICAgIGFuaW1hdGUoXG4gICAgICAgICAgJzE4MG1zJyxcbiAgICAgICAgICBrZXlmcmFtZXMoW1xuICAgICAgICAgICAgc3R5bGUoeyBvcGFjaXR5OiAwLCBvZmZzZXQ6IDAgfSksXG4gICAgICAgICAgICBzdHlsZSh7IG9wYWNpdHk6IDAuMywgb2Zmc2V0OiAwLjc1IH0pLFxuICAgICAgICAgICAgc3R5bGUoeyBvcGFjaXR5OiAwLjk3LCBvZmZzZXQ6IDEgfSlcbiAgICAgICAgICBdKVxuICAgICAgICApXG4gICAgICBdKSxcbiAgICAgIHRyYW5zaXRpb24oJzpsZWF2ZScsIFtcbiAgICAgICAgc3R5bGUoeyBvcGFjaXR5OiAwLjk3IH0pLFxuICAgICAgICBhbmltYXRlKFxuICAgICAgICAgICcxODBtcycsXG4gICAgICAgICAga2V5ZnJhbWVzKFtcbiAgICAgICAgICAgIHN0eWxlKHsgb3BhY2l0eTogMC45Nywgb2Zmc2V0OiAwIH0pLFxuICAgICAgICAgICAgc3R5bGUoeyBvcGFjaXR5OiAwLjYsIG9mZnNldDogMC44IH0pLFxuICAgICAgICAgICAgc3R5bGUoeyBvcGFjaXR5OiAwLCBvZmZzZXQ6IDEgfSlcbiAgICAgICAgICBdKVxuICAgICAgICApXG4gICAgICBdKVxuICAgIF0pXG4gIF1cbn0pXG5leHBvcnQgY2xhc3MgRml2R2FsbGVyeUltYWdlIGltcGxlbWVudHMgT25Jbml0IHtcbiAgQElucHV0KCkgc3JjOiBzdHJpbmcgfCBTYWZlUmVzb3VyY2VVcmw7XG4gIG9yaWdpbmFsU3JjOiBzdHJpbmcgfCBTYWZlUmVzb3VyY2VVcmw7XG4gIGluZGV4OiBudW1iZXI7XG5cbiAgQFZpZXdDaGlsZCgndGh1bWJuYWlsJykgaW1hZ2U6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoJ292ZXJsYXknKSBvdmVybGF5OiBGaXZPdmVybGF5O1xuXG4gIHZpZXdlclN0YXRlID0gJ2luJztcbiAgYW5pbWF0aW9uUGFyYW1zOiBBbmltYXRpb25QYXJhbXM7XG5cbiAgYmFja2Ryb3BDb2xvciA9ICdyZ2IoMCwwLDApJztcbiAgb3BlblRpbWluZyA9ICczMDBtcyc7XG4gIGNsb3NlVGltaW5nID0gJzM0MG1zJztcblxuICBAT3V0cHV0KCkgd2lsbE9wZW4gPSBuZXcgRXZlbnRFbWl0dGVyPEZpdkdhbGxlcnlJbWFnZT4oKTtcbiAgQE91dHB1dCgpIGRpZE9wZW4gPSBuZXcgRXZlbnRFbWl0dGVyPEZpdkdhbGxlcnlJbWFnZT4oKTtcbiAgQE91dHB1dCgpIGRpZENsb3NlID0gbmV3IEV2ZW50RW1pdHRlcjxGaXZHYWxsZXJ5SW1hZ2U+KCk7XG5cbiAgY29uc3RydWN0b3IoKSB7fVxuXG4gIG5nT25Jbml0KCkge31cblxuICBvcGVuKCkge1xuICAgIHRoaXMud2lsbE9wZW4uZW1pdCh0aGlzKTtcbiAgICBjb25zdCBwID0gdGhpcy5nZXRUaHVtYm5haWxQb3NpdGlvbih0aGlzLmltYWdlKTtcbiAgICB0aGlzLmFuaW1hdGlvblBhcmFtcyA9IHtcbiAgICAgIHRyYW5zbGF0ZTogcC50cmFuc2xhdGUsXG4gICAgICB0aW1pbmc6IHRoaXMub3BlblRpbWluZyxcbiAgICAgIGhlaWdodDogcC5oZWlnaHQsXG4gICAgICB3aWR0aDogcC53aWR0aCxcbiAgICAgIHRvcDogcC50b3AsXG4gICAgICBsZWZ0OiBwLmxlZnRcbiAgICB9O1xuXG4gICAgdGhpcy5vdmVybGF5LnNob3coNDk5OTkpO1xuICB9XG5cbiAgY2xvc2UocG9zaXRpb246IFBvc2l0aW9uKSB7XG4gICAgY29uc3QgcCA9IHRoaXMuZ2V0VGh1bWJuYWlsUG9zaXRpb24odGhpcy5pbWFnZSk7XG4gICAgdGhpcy5hbmltYXRpb25QYXJhbXMgPSB7XG4gICAgICB0cmFuc2xhdGU6IHBvc2l0aW9uLnRyYW5zbGF0ZSxcbiAgICAgIHRpbWluZzogdGhpcy5jbG9zZVRpbWluZyxcbiAgICAgIGhlaWdodDogcC5oZWlnaHQsXG4gICAgICB3aWR0aDogcC53aWR0aCxcbiAgICAgIHRvcDogcC50b3AsXG4gICAgICBsZWZ0OiBwLmxlZnRcbiAgICB9O1xuICAgIHRoaXMudmlld2VyU3RhdGUgPSAnb3V0JztcbiAgfVxuXG4gIHNsaWRlT3V0KHBvc2l0aW9uOiBQb3NpdGlvbiwgc3JjKSB7XG4gICAgdGhpcy5vcmlnaW5hbFNyYyA9IHNyYztcbiAgICBjb25zdCBwID0gdGhpcy5nZXRUaHVtYm5haWxQb3NpdGlvbih0aGlzLmltYWdlKTtcbiAgICB0aGlzLmFuaW1hdGlvblBhcmFtcyA9IHtcbiAgICAgIHRyYW5zbGF0ZTogcG9zaXRpb24udHJhbnNsYXRlLFxuICAgICAgdGltaW5nOiB0aGlzLmNsb3NlVGltaW5nLFxuICAgICAgaGVpZ2h0OiBwLmhlaWdodCxcbiAgICAgIHdpZHRoOiBwLndpZHRoLFxuICAgICAgdG9wOiBwLnRvcCxcbiAgICAgIGxlZnQ6IHAubGVmdFxuICAgIH07XG4gICAgdGhpcy52aWV3ZXJTdGF0ZSA9ICdzbGlkZW91dCc7XG4gIH1cblxuICBoYW5kbGVWaWV3ZXJBbmltYXRpb24oZXZlbnQ6IEFuaW1hdGlvbkV2ZW50KSB7XG4gICAgaWYgKGV2ZW50LmZyb21TdGF0ZSA9PT0gJ3ZvaWQnICYmIGV2ZW50LnRvU3RhdGUgPT09ICdpbicpIHtcbiAgICAgIHRoaXMuZGlkT3Blbi5lbWl0KHRoaXMpO1xuICAgIH1cbiAgICBpZiAoXG4gICAgICAoZXZlbnQuZnJvbVN0YXRlID09PSAnaW4nIHx8IGV2ZW50LmZyb21TdGF0ZSA9PT0gJ2hpZGRlbicpICYmXG4gICAgICAoZXZlbnQudG9TdGF0ZSA9PT0gJ291dCcgfHwgZXZlbnQudG9TdGF0ZSA9PT0gJ3NsaWRlb3V0JylcbiAgICApIHtcbiAgICAgIHRoaXMub3ZlcmxheS5oaWRlKCk7XG4gICAgICB0aGlzLmRpZENsb3NlLmVtaXQodGhpcyk7XG4gICAgICB0aGlzLnZpZXdlclN0YXRlID0gJ2luJztcbiAgICB9XG4gICAgaWYgKGV2ZW50LnRvU3RhdGUgPT09ICdzbGlkZW91dCcpIHtcbiAgICAgIHRoaXMuc3JjID0gdGhpcy5vcmlnaW5hbFNyYztcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGdldFRodW1ibmFpbFBvc2l0aW9uKFxuICAgIGVsZW1lbnQ6IEVsZW1lbnRSZWZcbiAgKTogUG9zaXRpb24ge1xuICAgIGNvbnN0IGJvdW5kcyA9IGVsZW1lbnQubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICByZXR1cm4ge1xuICAgICAgdG9wOiBib3VuZHMudG9wLFxuICAgICAgbGVmdDogYm91bmRzLmxlZnQsXG4gICAgICBoZWlnaHQ6IGVsZW1lbnQubmF0aXZlRWxlbWVudC5jbGllbnRIZWlnaHQsXG4gICAgICB3aWR0aDogZWxlbWVudC5uYXRpdmVFbGVtZW50LmNsaWVudFdpZHRoXG4gICAgfTtcbiAgfVxufVxuXG5leHBvcnQgY2xhc3MgUG9zaXRpb24ge1xuICB0b3A6IG51bWJlcjtcbiAgbGVmdDogbnVtYmVyO1xuICBoZWlnaHQ6IG51bWJlcjtcbiAgd2lkdGg6IG51bWJlcjtcbiAgdHJhbnNsYXRlPzogbnVtYmVyO1xufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFuaW1hdGlvblBhcmFtcyBleHRlbmRzIFBvc2l0aW9uIHtcbiAgdGltaW5nOiBzdHJpbmc7XG59XG4iXX0=