/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, ElementRef, ViewChild, Output, EventEmitter } from '@angular/core';
import { trigger, transition, style, animate, state, keyframes } from '@angular/animations';
import { FivOverlay } from '../../overlay/overlay.component';
export class FivGalleryImage {
    constructor() {
        this.viewerState = 'in';
        this.backdropColor = 'rgb(0,0,0)';
        this.openTiming = '300ms';
        this.closeTiming = '340ms';
        this.willOpen = new EventEmitter();
        this.didOpen = new EventEmitter();
        this.didClose = new EventEmitter();
    }
    /**
     * @return {?}
     */
    ngOnInit() { }
    /**
     * @return {?}
     */
    open() {
        this.willOpen.emit(this);
        /** @type {?} */
        const p = this.getThumbnailPosition(this.image);
        this.animationParams = {
            translate: p.translate,
            timing: this.openTiming,
            height: p.height,
            width: p.width,
            top: p.top,
            left: p.left
        };
        this.overlay.show(49999);
    }
    /**
     * @param {?} position
     * @return {?}
     */
    close(position) {
        /** @type {?} */
        const p = this.getThumbnailPosition(this.image);
        this.animationParams = {
            translate: position.translate,
            timing: this.closeTiming,
            height: p.height,
            width: p.width,
            top: p.top,
            left: p.left
        };
        this.viewerState = 'out';
    }
    /**
     * @param {?} position
     * @param {?} src
     * @return {?}
     */
    slideOut(position, src) {
        this.originalSrc = src;
        /** @type {?} */
        const p = this.getThumbnailPosition(this.image);
        this.animationParams = {
            translate: position.translate,
            timing: this.closeTiming,
            height: p.height,
            width: p.width,
            top: p.top,
            left: p.left
        };
        this.viewerState = 'slideout';
    }
    /**
     * @param {?} event
     * @return {?}
     */
    handleViewerAnimation(event) {
        if (event.fromState === 'void' && event.toState === 'in') {
            this.didOpen.emit(this);
        }
        if ((event.fromState === 'in' || event.fromState === 'hidden') &&
            (event.toState === 'out' || event.toState === 'slideout')) {
            this.overlay.hide();
            this.didClose.emit(this);
            this.viewerState = 'in';
        }
        if (event.toState === 'slideout') {
            this.src = this.originalSrc;
        }
    }
    /**
     * @private
     * @param {?} element
     * @return {?}
     */
    getThumbnailPosition(element) {
        /** @type {?} */
        const bounds = element.nativeElement.getBoundingClientRect();
        return {
            top: bounds.top,
            left: bounds.left,
            height: element.nativeElement.clientHeight,
            width: element.nativeElement.clientWidth
        };
    }
}
FivGalleryImage.decorators = [
    { type: Component, args: [{
                selector: 'fiv-gallery-image',
                template: "<ng-container *ngIf=\"!overlay.open && !src\">\n  <ng-content></ng-content>\n</ng-container>\n\n<img #thumbnail [ngClass]=\"{'hidden': (overlay.open || !src)}\" class=\"thumbnail\" [src]=\"src\" (click)=\"open()\">\n<fiv-overlay #overlay>\n\n  <div [style.backgroundColor]=\"backdropColor\"\n    *ngIf=\"overlay.open && viewerState !== 'out' && viewerState !== 'slideout'\" [@fade]=\"viewerState\" class=\"backdrop\">\n  </div>\n\n  <img *ngIf=\"overlay.open\" class=\"viewer-image\" (@image.done)=\"handleViewerAnimation($event)\"\n    [@image]=\"{ value: viewerState, params : animationParams}\" [src]=\"src\">\n\n</fiv-overlay>",
                animations: [
                    trigger('image', [
                        transition('* => in', [
                            style({
                                position: 'absolute',
                                top: '{{top}}px',
                                left: '{{left}}px',
                                transform: 'translate(0%,0%)',
                                height: '{{height}}px',
                                width: '{{width}}px',
                                opacity: 1,
                                borderRadius: '*'
                            }),
                            animate('{{timing}}', style({
                                position: 'absolute',
                                top: '50%',
                                left: '50%',
                                transform: 'translate(-50%,-50%)',
                                height: '*',
                                width: '*',
                                opacity: 1,
                                borderRadius: '0'
                            }))
                        ], {
                            params: {
                                top: '0',
                                left: '0',
                                height: '*',
                                width: '*',
                                timing: '300ms'
                            }
                        }),
                        transition('* => out', [
                            style({
                                position: 'absolute',
                                top: '{{translate}}px',
                                left: '50%',
                                transform: 'translate(-50%,-50%)',
                                height: '*',
                                width: '*',
                                opacity: 1,
                                borderRadius: '0'
                            }),
                            animate('{{timing}}', style({
                                position: 'absolute',
                                top: '{{top}}px',
                                left: '{{left}}px',
                                transform: 'translate(0%,0%)',
                                height: '{{height}}px',
                                width: '{{width}}px',
                                opacity: 1,
                                borderRadius: '*'
                            }))
                        ], {
                            params: {
                                top: '0',
                                left: '0',
                                height: '*',
                                width: '*',
                                translate: '0',
                                timing: '340ms'
                            }
                        }),
                        state('hidden', style({ opacity: 0 })),
                        transition('* => slideout', [
                            style({
                                position: 'absolute',
                                top: '{{translate}}px',
                                left: '50%',
                                transform: 'translate(-50%,-50%)',
                                opacity: 1,
                                borderRadius: '0'
                            }),
                            animate('{{timing}}', style({
                                transform: 'translate(-50%,100%)',
                                opacity: 0.2,
                                borderRadius: '0'
                            }))
                        ], {
                            params: {
                                top: '0',
                                left: '0',
                                height: '*',
                                width: '*',
                                translate: '0',
                                timing: '340ms'
                            }
                        })
                    ]),
                    trigger('fade', [
                        transition('void => *', [
                            style({ opacity: 0 }),
                            animate('180ms', keyframes([
                                style({ opacity: 0, offset: 0 }),
                                style({ opacity: 0.3, offset: 0.75 }),
                                style({ opacity: 0.97, offset: 1 })
                            ]))
                        ]),
                        transition(':leave', [
                            style({ opacity: 0.97 }),
                            animate('180ms', keyframes([
                                style({ opacity: 0.97, offset: 0 }),
                                style({ opacity: 0.6, offset: 0.8 }),
                                style({ opacity: 0, offset: 1 })
                            ]))
                        ])
                    ])
                ],
                styles: [":host{display:block;--max-height:100%;--border-radius:0px;min-height:var(--max-height);--background:var(--ion-color-light);background:var(--background)}.backdrop{width:100vw;height:100vh;opacity:.97;position:absolute;transition:background-color .3s}.thumbnail{-o-object-position:center;object-position:center;-o-object-fit:cover;object-fit:cover;display:block;height:var(--height,auto);max-height:var(--max-height);width:var(--width,100%);border-radius:var(--border-radius)}.hidden{opacity:0}.viewer-image{-o-object-position:center;object-position:center;-o-object-fit:cover;object-fit:cover;position:absolute;top:50%;left:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);height:auto;max-height:100%;width:auto;max-width:100%;border-radius:var(--border-radius)}"]
            }] }
];
/** @nocollapse */
FivGalleryImage.ctorParameters = () => [];
FivGalleryImage.propDecorators = {
    src: [{ type: Input }],
    image: [{ type: ViewChild, args: ['thumbnail',] }],
    overlay: [{ type: ViewChild, args: ['overlay',] }],
    willOpen: [{ type: Output }],
    didOpen: [{ type: Output }],
    didClose: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    FivGalleryImage.prototype.src;
    /** @type {?} */
    FivGalleryImage.prototype.originalSrc;
    /** @type {?} */
    FivGalleryImage.prototype.index;
    /** @type {?} */
    FivGalleryImage.prototype.image;
    /** @type {?} */
    FivGalleryImage.prototype.overlay;
    /** @type {?} */
    FivGalleryImage.prototype.viewerState;
    /** @type {?} */
    FivGalleryImage.prototype.animationParams;
    /** @type {?} */
    FivGalleryImage.prototype.backdropColor;
    /** @type {?} */
    FivGalleryImage.prototype.openTiming;
    /** @type {?} */
    FivGalleryImage.prototype.closeTiming;
    /** @type {?} */
    FivGalleryImage.prototype.willOpen;
    /** @type {?} */
    FivGalleryImage.prototype.didOpen;
    /** @type {?} */
    FivGalleryImage.prototype.didClose;
}
export class Position {
}
if (false) {
    /** @type {?} */
    Position.prototype.top;
    /** @type {?} */
    Position.prototype.left;
    /** @type {?} */
    Position.prototype.height;
    /** @type {?} */
    Position.prototype.width;
    /** @type {?} */
    Position.prototype.translate;
}
/**
 * @record
 */
export function AnimationParams() { }
if (false) {
    /** @type {?} */
    AnimationParams.prototype.timing;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2FsbGVyeS1pbWFnZS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZml2ZXRocmVlL2NvcmUvIiwic291cmNlcyI6WyJsaWIvZ2FsbGVyeS9nYWxsZXJ5LWltYWdlL2dhbGxlcnktaW1hZ2UuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUVULEtBQUssRUFDTCxVQUFVLEVBQ1YsU0FBUyxFQUNULE1BQU0sRUFDTixZQUFZLEVBQ2IsTUFBTSxlQUFlLENBQUM7QUFFdkIsT0FBTyxFQUNMLE9BQU8sRUFDUCxVQUFVLEVBQ1YsS0FBSyxFQUNMLE9BQU8sRUFDUCxLQUFLLEVBRUwsU0FBUyxFQUNWLE1BQU0scUJBQXFCLENBQUM7QUFDN0IsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGlDQUFpQyxDQUFDO0FBOEk3RCxNQUFNLE9BQU8sZUFBZTtJQW1CMUI7UUFYQSxnQkFBVyxHQUFHLElBQUksQ0FBQztRQUduQixrQkFBYSxHQUFHLFlBQVksQ0FBQztRQUM3QixlQUFVLEdBQUcsT0FBTyxDQUFDO1FBQ3JCLGdCQUFXLEdBQUcsT0FBTyxDQUFDO1FBRVosYUFBUSxHQUFHLElBQUksWUFBWSxFQUFtQixDQUFDO1FBQy9DLFlBQU8sR0FBRyxJQUFJLFlBQVksRUFBbUIsQ0FBQztRQUM5QyxhQUFRLEdBQUcsSUFBSSxZQUFZLEVBQW1CLENBQUM7SUFFMUMsQ0FBQzs7OztJQUVoQixRQUFRLEtBQUksQ0FBQzs7OztJQUViLElBQUk7UUFDRixJQUFJLENBQUMsUUFBUSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQzs7Y0FDbkIsQ0FBQyxHQUFHLElBQUksQ0FBQyxvQkFBb0IsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDO1FBQy9DLElBQUksQ0FBQyxlQUFlLEdBQUc7WUFDckIsU0FBUyxFQUFFLENBQUMsQ0FBQyxTQUFTO1lBQ3RCLE1BQU0sRUFBRSxJQUFJLENBQUMsVUFBVTtZQUN2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QyxrQ0FBMEM7O0lBRTFDLHNDQUFtQjs7SUFDbkIsMENBQWlDOztJQUVqQyx3Q0FBNkI7O0lBQzdCLHFDQUFxQjs7SUFDckIsc0NBQXNCOztJQUV0QixtQ0FBeUQ7O0lBQ3pELGtDQUF3RDs7SUFDeEQsbUNBQXlEOztBQThFM0QsTUFBTSxPQUFPLFFBQVE7Q0FNcEI7OztJQUxDLHVCQUFZOztJQUNaLHdCQUFhOztJQUNiLDBCQUFlOztJQUNmLHlCQUFjOztJQUNkLDZCQUFtQjs7Ozs7QUFHckIscUNBRUM7OztJQURDLGlDQUFlIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBPbkluaXQsXG4gIElucHV0LFxuICBFbGVtZW50UmVmLFxuICBWaWV3Q2hpbGQsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgU2FmZVJlc291cmNlVXJsIH0gZnJvbSAnQGFuZ3VsYXIvcGxhdGZvcm0tYnJvd3Nlcic7XG5pbXBvcnQge1xuICB0cmlnZ2VyLFxuICB0cmFuc2l0aW9uLFxuICBzdHlsZSxcbiAgYW5pbWF0ZSxcbiAgc3RhdGUsXG4gIEFuaW1hdGlvbkV2ZW50LFxuICBrZXlmcmFtZXNcbn0gZnJvbSAnQGFuZ3VsYXIvYW5pbWF0aW9ucyc7XG5pbXBvcnQgeyBGaXZPdmVybGF5IH0gZnJvbSAnLi4vLi4vb3ZlcmxheS9vdmVybGF5LmNvbXBvbmVudCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2Zpdi1nYWxsZXJ5LWltYWdlJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2dhbGxlcnktaW1hZ2UuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybHM6IFsnLi9nYWxsZXJ5LWltYWdlLmNvbXBvbmVudC5zY3NzJ10sXG4gIGFuaW1hdGlvbnM6IFtcbiAgICB0cmlnZ2VyKCdpbWFnZScsIFtcbiAgICAgIHRyYW5zaXRpb24oXG4gICAgICAgICcqID0+IGluJyxcbiAgICAgICAgW1xuICAgICAgICAgIHN0eWxlKHtcbiAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgICAgICAgdG9wOiAne3t0b3B9fXB4JyxcbiAgICAgICAgICAgIGxlZnQ6ICd7e2xlZnR9fXB4JyxcbiAgICAgICAgICAgIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZSgwJSwwJSknLFxuICAgICAgICAgICAgaGVpZ2h0OiAne3toZWlnaHR9fXB4JyxcbiAgICAgICAgICAgIHdpZHRoOiAne3t3aWR0aH19cHgnLFxuICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgIGJvcmRlclJhZGl1czogJyonXG4gICAgICAgICAgfSksXG4gICAgICAgICAgYW5pbWF0ZShcbiAgICAgICAgICAgICd7e3RpbWluZ319JyxcbiAgICAgICAgICAgIHN0eWxlKHtcbiAgICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgICAgICAgICAgIHRvcDogJzUwJScsXG4gICAgICAgICAgICAgIGxlZnQ6ICc1MCUnLFxuICAgICAgICAgICAgICB0cmFuc2Zvcm06ICd0cmFuc2xhdGUoLTUwJSwtNTAlKScsXG4gICAgICAgICAgICAgIGhlaWdodDogJyonLFxuICAgICAgICAgICAgICB3aWR0aDogJyonLFxuICAgICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICcwJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICApXG4gICAgICAgIF0sXG4gICAgICAgIHtcbiAgICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICAgIHRvcDogJzAnLFxuICAgICAgICAgICAgbGVmdDogJzAnLFxuICAgICAgICAgICAgaGVpZ2h0OiAnKicsXG4gICAgICAgICAgICB3aWR0aDogJyonLFxuICAgICAgICAgICAgdGltaW5nOiAnMzAwbXMnXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApLFxuICAgICAgdHJhbnNpdGlvbihcbiAgICAgICAgJyogPT4gb3V0JyxcbiAgICAgICAgW1xuICAgICAgICAgIHN0eWxlKHtcbiAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgICAgICAgdG9wOiAne3t0cmFuc2xhdGV9fXB4JyxcbiAgICAgICAgICAgIGxlZnQ6ICc1MCUnLFxuICAgICAgICAgICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlKC01MCUsLTUwJSknLFxuICAgICAgICAgICAgaGVpZ2h0OiAnKicsXG4gICAgICAgICAgICB3aWR0aDogJyonLFxuICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgIGJvcmRlclJhZGl1czogJzAnXG4gICAgICAgICAgfSksXG4gICAgICAgICAgYW5pbWF0ZShcbiAgICAgICAgICAgICd7e3RpbWluZ319JyxcbiAgICAgICAgICAgIHN0eWxlKHtcbiAgICAgICAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgICAgICAgICAgIHRvcDogJ3t7dG9wfX1weCcsXG4gICAgICAgICAgICAgIGxlZnQ6ICd7e2xlZnR9fXB4JyxcbiAgICAgICAgICAgICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlKDAlLDAlKScsXG4gICAgICAgICAgICAgIGhlaWdodDogJ3t7aGVpZ2h0fX1weCcsXG4gICAgICAgICAgICAgIHdpZHRoOiAne3t3aWR0aH19cHgnLFxuICAgICAgICAgICAgICBvcGFjaXR5OiAxLFxuICAgICAgICAgICAgICBib3JkZXJSYWRpdXM6ICcqJ1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICApXG4gICAgICAgIF0sXG4gICAgICAgIHtcbiAgICAgICAgICBwYXJhbXM6IHtcbiAgICAgICAgICAgIHRvcDogJzAnLFxuICAgICAgICAgICAgbGVmdDogJzAnLFxuICAgICAgICAgICAgaGVpZ2h0OiAnKicsXG4gICAgICAgICAgICB3aWR0aDogJyonLFxuICAgICAgICAgICAgdHJhbnNsYXRlOiAnMCcsXG4gICAgICAgICAgICB0aW1pbmc6ICczNDBtcydcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICksXG4gICAgICBzdGF0ZSgnaGlkZGVuJywgc3R5bGUoeyBvcGFjaXR5OiAwIH0pKSxcbiAgICAgIHRyYW5zaXRpb24oXG4gICAgICAgICcqID0+IHNsaWRlb3V0JyxcbiAgICAgICAgW1xuICAgICAgICAgIHN0eWxlKHtcbiAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgICAgICAgICAgdG9wOiAne3t0cmFuc2xhdGV9fXB4JyxcbiAgICAgICAgICAgIGxlZnQ6ICc1MCUnLFxuICAgICAgICAgICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlKC01MCUsLTUwJSknLFxuICAgICAgICAgICAgb3BhY2l0eTogMSxcbiAgICAgICAgICAgIGJvcmRlclJhZGl1czogJzAnXG4gICAgICAgICAgfSksXG4gICAgICAgICAgYW5pbWF0ZShcbiAgICAgICAgICAgICd7e3RpbWluZ319JyxcbiAgICAgICAgICAgIHN0eWxlKHtcbiAgICAgICAgICAgICAgdHJhbnNmb3JtOiAndHJhbnNsYXRlKC01MCUsMTAwJSknLFxuICAgICAgICAgICAgICBvcGFjaXR5OiAwLjIsXG4gICAgICAgICAgICAgIGJvcmRlclJhZGl1czogJzAnXG4gICAgICAgICAgICB9KVxuICAgICAgICAgIClcbiAgICAgICAgXSxcbiAgICAgICAge1xuICAgICAgICAgIHBhcmFtczoge1xuICAgICAgICAgICAgdG9wOiAnMCcsXG4gICAgICAgICAgICBsZWZ0OiAnMCcsXG4gICAgICAgICAgICBoZWlnaHQ6ICcqJyxcbiAgICAgICAgICAgIHdpZHRoOiAnKicsXG4gICAgICAgICAgICB0cmFuc2xhdGU6ICcwJyxcbiAgICAgICAgICAgIHRpbWluZzogJzM0MG1zJ1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKVxuICAgIF0pLFxuICAgIHRyaWdnZXIoJ2ZhZGUnLCBbXG4gICAgICB0cmFuc2l0aW9uKCd2b2lkID0+IConLCBbXG4gICAgICAgIHN0eWxlKHsgb3BhY2l0eTogMCB9KSxcbiAgICAgICAgYW5pbWF0ZShcbiAgICAgICAgICAnMTgwbXMnLFxuICAgICAgICAgIGtleWZyYW1lcyhbXG4gICAgICAgICAgICBzdHlsZSh7IG9wYWNpdHk6IDAsIG9mZnNldDogMCB9KSxcbiAgICAgICAgICAgIHN0eWxlKHsgb3BhY2l0eTogMC4zLCBvZmZzZXQ6IDAuNzUgfSksXG4gICAgICAgICAgICBzdHlsZSh7IG9wYWNpdHk6IDAuOTcsIG9mZnNldDogMSB9KVxuICAgICAgICAgIF0pXG4gICAgICAgIClcbiAgICAgIF0pLFxuICAgICAgdHJhbnNpdGlvbignOmxlYXZlJywgW1xuICAgICAgICBzdHlsZSh7IG9wYWNpdHk6IDAuOTcgfSksXG4gICAgICAgIGFuaW1hdGUoXG4gICAgICAgICAgJzE4MG1zJyxcbiAgICAgICAgICBrZXlmcmFtZXMoW1xuICAgICAgICAgICAgc3R5bGUoeyBvcGFjaXR5OiAwLjk3LCBvZmZzZXQ6IDAgfSksXG4gICAgICAgICAgICBzdHlsZSh7IG9wYWNpdHk6IDAuNiwgb2Zmc2V0OiAwLjggfSksXG4gICAgICAgICAgICBzdHlsZSh7IG9wYWNpdHk6IDAsIG9mZnNldDogMSB9KVxuICAgICAgICAgIF0pXG4gICAgICAgIClcbiAgICAgIF0pXG4gICAgXSlcbiAgXVxufSlcbmV4cG9ydCBjbGFzcyBGaXZHYWxsZXJ5SW1hZ2UgaW1wbGVtZW50cyBPbkluaXQge1xuICBASW5wdXQoKSBzcmM6IHN0cmluZyB8IFNhZmVSZXNvdXJjZVVybDtcbiAgb3JpZ2luYWxTcmM6IHN0cmluZyB8IFNhZmVSZXNvdXJjZVVybDtcbiAgaW5kZXg6IG51bWJlcjtcblxuICBAVmlld0NoaWxkKCd0aHVtYm5haWwnKSBpbWFnZTogRWxlbWVudFJlZjtcbiAgQFZpZXdDaGlsZCgnb3ZlcmxheScpIG92ZXJsYXk6IEZpdk92ZXJsYXk7XG5cbiAgdmlld2VyU3RhdGUgPSAnaW4nO1xuICBhbmltYXRpb25QYXJhbXM6IEFuaW1hdGlvblBhcmFtcztcblxuICBiYWNrZHJvcENvbG9yID0gJ3JnYigwLDAsMCknO1xuICBvcGVuVGltaW5nID0gJzMwMG1zJztcbiAgY2xvc2VUaW1pbmcgPSAnMzQwbXMnO1xuXG4gIEBPdXRwdXQoKSB3aWxsT3BlbiA9IG5ldyBFdmVudEVtaXR0ZXI8Rml2R2FsbGVyeUltYWdlPigpO1xuICBAT3V0cHV0KCkgZGlkT3BlbiA9IG5ldyBFdmVudEVtaXR0ZXI8Rml2R2FsbGVyeUltYWdlPigpO1xuICBAT3V0cHV0KCkgZGlkQ2xvc2UgPSBuZXcgRXZlbnRFbWl0dGVyPEZpdkdhbGxlcnlJbWFnZT4oKTtcblxuICBjb25zdHJ1Y3RvcigpIHt9XG5cbiAgbmdPbkluaXQoKSB7fVxuXG4gIG9wZW4oKSB7XG4gICAgdGhpcy53aWxsT3Blbi5lbWl0KHRoaXMpO1xuICAgIGNvbnN0IHAgPSB0aGlzLmdldFRodW1ibmFpbFBvc2l0aW9uKHRoaXMuaW1hZ2UpO1xuICAgIHRoaXMuYW5pbWF0aW9uUGFyYW1zID0ge1xuICAgICAgdHJhbnNsYXRlOiBwLnRyYW5zbGF0ZSxcbiAgICAgIHRpbWluZzogdGhpcy5vcGVuVGltaW5nLFxuICAgICAgaGVpZ2h0OiBwLmhlaWdodCxcbiAgICAgIHdpZHRoOiBwLndpZHRoLFxuICAgICAgdG9wOiBwLnRvcCxcbiAgICAgIGxlZnQ6IHAubGVmdFxuICAgIH07XG5cbiAgICB0aGlzLm92ZXJsYXkuc2hvdyg0OTk5OSk7XG4gIH1cblxuICBjbG9zZShwb3NpdGlvbjogUG9zaXRpb24pIHtcbiAgICBjb25zdCBwID0gdGhpcy5nZXRUaHVtYm5haWxQb3NpdGlvbih0aGlzLmltYWdlKTtcbiAgICB0aGlzLmFuaW1hdGlvblBhcmFtcyA9IHtcbiAgICAgIHRyYW5zbGF0ZTogcG9zaXRpb24udHJhbnNsYXRlLFxuICAgICAgdGltaW5nOiB0aGlzLmNsb3NlVGltaW5nLFxuICAgICAgaGVpZ2h0OiBwLmhlaWdodCxcbiAgICAgIHdpZHRoOiBwLndpZHRoLFxuICAgICAgdG9wOiBwLnRvcCxcbiAgICAgIGxlZnQ6IHAubGVmdFxuICAgIH07XG4gICAgdGhpcy52aWV3ZXJTdGF0ZSA9ICdvdXQnO1xuICB9XG5cbiAgc2xpZGVPdXQocG9zaXRpb246IFBvc2l0aW9uLCBzcmMpIHtcbiAgICB0aGlzLm9yaWdpbmFsU3JjID0gc3JjO1xuICAgIGNvbnN0IHAgPSB0aGlzLmdldFRodW1ibmFpbFBvc2l0aW9uKHRoaXMuaW1hZ2UpO1xuICAgIHRoaXMuYW5pbWF0aW9uUGFyYW1zID0ge1xuICAgICAgdHJhbnNsYXRlOiBwb3NpdGlvbi50cmFuc2xhdGUsXG4gICAgICB0aW1pbmc6IHRoaXMuY2xvc2VUaW1pbmcsXG4gICAgICBoZWlnaHQ6IHAuaGVpZ2h0LFxuICAgICAgd2lkdGg6IHAud2lkdGgsXG4gICAgICB0b3A6IHAudG9wLFxuICAgICAgbGVmdDogcC5sZWZ0XG4gICAgfTtcbiAgICB0aGlzLnZpZXdlclN0YXRlID0gJ3NsaWRlb3V0JztcbiAgfVxuXG4gIGhhbmRsZVZpZXdlckFuaW1hdGlvbihldmVudDogQW5pbWF0aW9uRXZlbnQpIHtcbiAgICBpZiAoZXZlbnQuZnJvbVN0YXRlID09PSAndm9pZCcgJiYgZXZlbnQudG9TdGF0ZSA9PT0gJ2luJykge1xuICAgICAgdGhpcy5kaWRPcGVuLmVtaXQodGhpcyk7XG4gICAgfVxuICAgIGlmIChcbiAgICAgIChldmVudC5mcm9tU3RhdGUgPT09ICdpbicgfHwgZXZlbnQuZnJvbVN0YXRlID09PSAnaGlkZGVuJykgJiZcbiAgICAgIChldmVudC50b1N0YXRlID09PSAnb3V0JyB8fCBldmVudC50b1N0YXRlID09PSAnc2xpZGVvdXQnKVxuICAgICkge1xuICAgICAgdGhpcy5vdmVybGF5LmhpZGUoKTtcbiAgICAgIHRoaXMuZGlkQ2xvc2UuZW1pdCh0aGlzKTtcbiAgICAgIHRoaXMudmlld2VyU3RhdGUgPSAnaW4nO1xuICAgIH1cbiAgICBpZiAoZXZlbnQudG9TdGF0ZSA9PT0gJ3NsaWRlb3V0Jykge1xuICAgICAgdGhpcy5zcmMgPSB0aGlzLm9yaWdpbmFsU3JjO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgZ2V0VGh1bWJuYWlsUG9zaXRpb24oXG4gICAgZWxlbWVudDogRWxlbWVudFJlZlxuICApOiBQb3NpdGlvbiB7XG4gICAgY29uc3QgYm91bmRzID0gZWxlbWVudC5uYXRpdmVFbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpO1xuICAgIHJldHVybiB7XG4gICAgICB0b3A6IGJvdW5kcy50b3AsXG4gICAgICBsZWZ0OiBib3VuZHMubGVmdCxcbiAgICAgIGhlaWdodDogZWxlbWVudC5uYXRpdmVFbGVtZW50LmNsaWVudEhlaWdodCxcbiAgICAgIHdpZHRoOiBlbGVtZW50Lm5hdGl2ZUVsZW1lbnQuY2xpZW50V2lkdGhcbiAgICB9O1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBQb3NpdGlvbiB7XG4gIHRvcDogbnVtYmVyO1xuICBsZWZ0OiBudW1iZXI7XG4gIGhlaWdodDogbnVtYmVyO1xuICB3aWR0aDogbnVtYmVyO1xuICB0cmFuc2xhdGU/OiBudW1iZXI7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQW5pbWF0aW9uUGFyYW1zIGV4dGVuZHMgUG9zaXRpb24ge1xuICB0aW1pbmc6IHN0cmluZztcbn1cbiJdfQ==