/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { FivGalleryToolbar } from './gallery-toolbar/gallery-toolbar.component';
import { ImageService } from './image.service';
import { IonSlides, DomController, Platform } from '@ionic/angular';
import { FivOverlay } from './../overlay/overlay.component';
import { Component, ViewChild, ElementRef, Renderer2, ContentChildren, QueryList, forwardRef, HostListener, Inject, ChangeDetectorRef, Input, Output, EventEmitter } from '@angular/core';
import { style, animate, AnimationBuilder, trigger, transition } from '@angular/animations';
import { Key } from './keycodes.enum';
import { DOCUMENT } from '@angular/common';
import { FivGalleryImage } from './gallery-image/gallery-image.component';
import { from, Subject } from 'rxjs';
import { mergeMap, takeUntil } from 'rxjs/operators';
export class FivGallery {
    /**
     * @param {?} domCtrl
     * @param {?} renderer
     * @param {?} animation
     * @param {?} change
     * @param {?} platform
     * @param {?} document
     * @param {?} imageService
     */
    constructor(domCtrl, renderer, animation, change, platform, document, imageService) {
        this.domCtrl = domCtrl;
        this.renderer = renderer;
        this.animation = animation;
        this.change = change;
        this.platform = platform;
        this.document = document;
        this.imageService = imageService;
        // properties for the slides
        this.activeIndex = 0;
        this.options = {
            zoom: true,
            initialSlide: 0
        };
        this.controlsVisible = true;
        this.pagerVisible = true;
        this.ambient = true;
        this.openTiming = '300ms';
        this.closeTiming = '340ms';
        this.willOpen = new EventEmitter();
        this.willClose = new EventEmitter();
        this.didOpen = new EventEmitter();
        this.didClose = new EventEmitter();
        this.backdropChange = new EventEmitter();
        this.$onDestroy = new Subject();
    }
    /**
     * @param {?} event
     * @return {?}
     */
    keyEvent(event) {
        if (this.overlay &&
            this.overlay.open &&
            this.initialImage &&
            this.initialImage.viewerState === 'hidden') {
            this.handleKeyboardEvents(event);
        }
    }
    /**
     * @return {?}
     */
    ngOnInit() { }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        this.updateImages();
        this.updateToolbars();
        this.subscribeToImageEvents();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.$onDestroy.next();
    }
    /**
     * @return {?}
     */
    subscribeToImageEvents() {
        from(this.images.map((/**
         * @param {?} image
         * @return {?}
         */
        image => image.didOpen)))
            .pipe(mergeMap((/**
         * @param {?} value
         * @return {?}
         */
        (value) => value)), takeUntil(this.$onDestroy))
            .subscribe((/**
         * @param {?} image
         * @return {?}
         */
        image => this.open(image)));
        from(this.images.map((/**
         * @param {?} image
         * @return {?}
         */
        image => image.willOpen)))
            .pipe(mergeMap((/**
         * @param {?} value
         * @return {?}
         */
        (value) => value)), takeUntil(this.$onDestroy))
            .subscribe((/**
         * @param {?} image
         * @return {?}
         */
        image => this.willOpen.emit(image)));
        from(this.images.map((/**
         * @param {?} image
         * @return {?}
         */
        image => image.didClose)))
            .pipe(mergeMap((/**
         * @param {?} value
         * @return {?}
         */
        (value) => value)), takeUntil(this.$onDestroy))
            .subscribe((/**
         * @param {?} image
         * @return {?}
         */
        image => this.didClose.emit(image)));
    }
    /**
     * @return {?}
     */
    updateImages() {
        this.images.forEach((/**
         * @param {?} img
         * @param {?} i
         * @return {?}
         */
        (img, i) => {
            img.index = i;
        }));
    }
    /**
     * @return {?}
     */
    updateToolbars() {
        this.toolbars.forEach((/**
         * @param {?} toolbar
         * @return {?}
         */
        toolbar => {
            if (toolbar.position === 'top') {
                this.topToolbar = toolbar.content;
            }
            else {
                this.bottomToolbar = toolbar.content;
            }
        }));
    }
    /**
     * @param {?} event
     * @return {?}
     */
    handleKeyboardEvents(event) {
        if (event.keyCode === Key.RightArrow) {
            this.next();
            return;
        }
        if (event.keyCode === Key.LeftArrow) {
            this.prev();
            return;
        }
        if (event.keyCode === Key.DownArrow || event.keyCode === Key.Escape) {
            this.close();
            return;
        }
    }
    /**
     * @return {?}
     */
    next() {
        if (this.overlay &&
            this.overlay.open &&
            this.initialImage &&
            this.initialImage.viewerState === 'hidden') {
            this.slides.slideNext();
        }
    }
    /**
     * @return {?}
     */
    prev() {
        if (this.overlay &&
            this.overlay.open &&
            this.initialImage &&
            this.initialImage.viewerState === 'hidden') {
            this.slides.slidePrev();
        }
    }
    /**
     * @param {?} initial
     * @return {?}
     */
    open(initial) {
        this.activeIndex = initial.index;
        this.options.initialSlide = this.activeIndex;
        this.overlay.show(50000);
        this.initialImage = initial;
        this.initialImage.openTiming = this.openTiming;
        this.initialImage.closeTiming = this.closeTiming;
        this.initialImage.backdropColor = this.ambient
            ? this.imageService.getAverageRGB(this.images.toArray()[this.activeIndex].image.nativeElement)
            : '#000';
        this.showControls();
    }
    /**
     * @return {?}
     */
    close() {
        this.closeFromPullDown(0);
    }
    /**
     * @return {?}
     */
    dismiss() {
        this.closeFromPullDown(0, false);
    }
    /**
     * @param {?} progress
     * @param {?=} emit
     * @return {?}
     */
    closeFromPullDown(progress, emit = true) {
        if (emit) {
            this.willClose.emit(this.initialImage);
        }
        this.transformSlides(0);
        /** @type {?} */
        const sameAsInitial = this.images.toArray()[this.activeIndex].index === this.initialImage.index;
        /** @type {?} */
        const position = this.getImagePosition(this.images.toArray()[this.activeIndex].image, progress);
        if (sameAsInitial) {
            this.initialImage.close(position);
        }
        else {
            /** @type {?} */
            const src = this.initialImage.src;
            this.initialImage.src = this.images.toArray()[this.activeIndex].src;
            this.initialImage.slideOut(position, src);
        }
        if (this.inFullscreen) {
            this.closeFullscreen();
        }
        this.slidesLoaded = false;
        this.overlay.hide();
    }
    /**
     * @param {?} progress
     * @return {?}
     */
    resetPan(progress) {
        this.resetSlides(progress);
    }
    /**
     * @private
     * @param {?} element
     * @param {?=} offset
     * @return {?}
     */
    getImagePosition(element, offset = 0) {
        /** @type {?} */
        const bounds = element.nativeElement.getBoundingClientRect();
        return {
            top: bounds.top,
            left: bounds.left,
            height: element.nativeElement.clientHeight,
            width: element.nativeElement.clientWidth,
            translate: this.platform.height() / 2 + offset * 120
        };
    }
    /**
     * @param {?} progress
     * @return {?}
     */
    transformSlides(progress) {
        if (this.controlsVisible) {
            this.hideControls();
        }
        this.domCtrl.write((/**
         * @return {?}
         */
        () => {
            this.renderer.setStyle(this.viewer.nativeElement, 'transform', `translateY(${progress * 120}px)`);
        }));
    }
    /**
     * @param {?} progress
     * @return {?}
     */
    resetSlides(progress) {
        /** @type {?} */
        const reset = this.animation.build([
            style({ transform: `translateY(${progress * 120}px)` }),
            animate('150ms', style({ transform: `translateY(0px)` }))
        ]);
        /** @type {?} */
        const animation = reset.create(this.viewer.nativeElement);
        animation.play();
        animation.onDone((/**
         * @return {?}
         */
        () => {
            animation.destroy();
            this.transformSlides(0);
            this.showControls();
        }));
    }
    /**
     * @return {?}
     */
    slideDidChange() {
        this.activeIndex = this.swiper.nativeElement.swiper.activeIndex;
    }
    /**
     * @return {?}
     */
    ionSlideNextStart() {
        if (this.slidesLoaded) {
            this.updateBackdrop(this.activeIndex + 1);
        }
    }
    /**
     * @return {?}
     */
    ionSlidePrevStart() {
        if (this.slidesLoaded) {
            this.updateBackdrop(this.activeIndex - 1);
        }
    }
    /**
     * @param {?} index
     * @return {?}
     */
    updateBackdrop(index) {
        this.initialImage.backdropColor = this.ambient
            ? this.imageService.getAverageRGB(this.images.toArray()[index].image.nativeElement)
            : '#000';
        this.backdropChange.emit(this.initialImage);
    }
    /**
     * @return {?}
     */
    onSlidesLoad() {
        this.slidesLoaded = true;
        this.didOpen.emit(this.initialImage);
        this.activeIndex = this.swiper.nativeElement.swiper.activeIndex;
        this.initialImage.viewerState = 'hidden';
        this.swiper.nativeElement.swiper.on('click', (/**
         * @return {?}
         */
        () => {
            this.handleSingleTap();
        }));
    }
    /**
     * @return {?}
     */
    fullscreen() {
        if (this.inFullscreen) {
            this.closeFullscreen();
        }
        else {
            this.openFullscreen();
        }
    }
    /**
     * @return {?}
     */
    openFullscreen() {
        /** @type {?} */
        const elem = document.documentElement;
        if (elem.requestFullscreen) {
            elem.requestFullscreen();
        }
        else if (elem['mozRequestFullScreen']) {
            /* Firefox */
            elem['mozRequestFullScreen']();
        }
        else if (elem['webkitRequestFullscreen']) {
            /* Chrome, Safari and Opera */
            elem['webkitRequestFullscreen']();
        }
        else if (elem['msRequestFullscreen']) {
            /* IE/Edge */
            elem['msRequestFullscreen']();
        }
        this.inFullscreen = true;
    }
    /**
     * @return {?}
     */
    closeFullscreen() {
        this.inFullscreen = false;
        if (this.document.exitFullscreen) {
            this.document.exitFullscreen();
        }
        else if (this.document.mozCancelFullScreen) {
            /* Firefox */
            this.document.mozCancelFullScreen();
        }
        else if (this.document.webkitExitFullscreen) {
            /* Chrome, Safari and Opera */
            this.document.webkitExitFullscreen();
        }
        else if (this.document.msExitFullscreen) {
            /* IE/Edge */
            this.document.msExitFullscreen();
        }
    }
    /**
     * @return {?}
     */
    zoom() {
        if (this.zoomedIn) {
            this.zoomOut();
        }
        else {
            this.zoomIn();
        }
    }
    /**
     * @return {?}
     */
    zoomIn() {
        this.swiper.nativeElement.swiper.zoom.in();
        this.zoomedIn = true;
    }
    /**
     * @return {?}
     */
    zoomOut() {
        this.swiper.nativeElement.swiper.zoom.out();
        this.zoomedIn = false;
    }
    /**
     * @return {?}
     */
    handleSingleTap() {
        this.controlsVisible = !this.controlsVisible;
        this.change.detectChanges();
    }
    /**
     * @return {?}
     */
    hideControls() {
        this.controlsVisible = false;
        this.change.detectChanges();
    }
    /**
     * @return {?}
     */
    showControls() {
        this.controlsVisible = true;
        this.change.detectChanges();
    }
}
FivGallery.decorators = [
    { type: Component, args: [{
                selector: 'fiv-gallery',
                template: "<ng-content></ng-content>\n<fiv-overlay #overlay>\n\n  <div [@slideDown] *ngIf=\"controlsVisible && topToolbar\" class=\"gallery-toolbar header\" color=\"transparent\">\n    <ng-container [ngTemplateOutlet]=\"topToolbar\">\n    </ng-container>\n  </div>\n\n  <ng-container *fivIf=\"['desktop']\">\n    <ion-fab [@scale] *ngIf=\"controlsVisible && images?.length > 0 && pagerVisible\" vertical=\"center\" horizontal=\"start\"\n      slot=\"fixed\">\n      <ion-fab-button color=\"light\" (click)=\"prev()\" [disabled]=\"activeIndex === 0\">\n        <ion-icon name=\"arrow-back\"></ion-icon>\n      </ion-fab-button>\n    </ion-fab>\n  </ng-container>\n\n  <div #viewer class=\"viewer\" fivPull [maxPullHeight]=\"160\" [minPullHeight]=\"120\" (fivPull)=\"transformSlides($event)\"\n    (fivRefresh)=\"closeFromPullDown($event)\" (fivCancel)=\"resetPan($event)\" [enableScroll]=\"true\">\n    <ion-slides #slider *ngIf=\"overlay.open\" [ngClass]=\"[initialImage?.viewerState]\"\n      (ionSlideDidChange)=\"slideDidChange()\" (ionSlideNextStart)=\"ionSlideNextStart()\"\n      (ionSlidePrevStart)=\"ionSlidePrevStart()\" (ionSlidesDidLoad)=\"onSlidesLoad()\" [options]=\"options\">\n      <ion-slide *ngFor=\"let image of images; let i = index\">\n        <div class=\"swiper-zoom-container\">\n          <img [ngClass]=\"{'instant': activeIndex !== i}\" [src]=\"image.src\">\n        </div>\n      </ion-slide>\n    </ion-slides>\n  </div>\n\n  <ng-container *fivIf=\"['desktop']\">\n    <ion-fab [@scale] *ngIf=\"controlsVisible && pagerVisible\" vertical=\"center\" horizontal=\"end\" slot=\"fixed\">\n      <ion-fab-button color=\"light\" (click)=\"next()\" [disabled]=\"activeIndex === images.length - 1\">\n        <ion-icon name=\"arrow-forward\"></ion-icon>\n      </ion-fab-button>\n    </ion-fab>\n  </ng-container>\n\n  <div [@slideUp] *ngIf=\"controlsVisible && bottomToolbar\" class=\"gallery-toolbar footer\" color=\"transparent\">\n    <ng-container [ngTemplateOutlet]=\"bottomToolbar\">\n    </ng-container>\n  </div>\n\n\n</fiv-overlay>",
                animations: [
                    trigger('scale', [
                        transition('void => *', [
                            style({ opacity: 0, transform: 'scale(0)' }),
                            animate('125ms', style({ opacity: 1, transform: 'scale(1)' }))
                        ]),
                        transition('* => void', [
                            style({ opacity: 1, transform: 'scale(1)' }),
                            animate('125ms', style({ opacity: 0, transform: 'scale(0)' }))
                        ])
                    ]),
                    trigger('slideUp', [
                        transition('void => *', [
                            style({ opacity: 0, transform: 'translateY(100%)' }),
                            animate('75ms', style({ opacity: 1, transform: 'translateY(0%)' }))
                        ]),
                        transition('* => void', [
                            style({ opacity: 1, transform: 'translateY(0%)' }),
                            animate('75ms', style({ opacity: 0, transform: 'translateY(100%)' }))
                        ])
                    ]),
                    trigger('slideDown', [
                        transition('* => void', [
                            style({ opacity: 0, transform: 'translateY(0%)' }),
                            animate('75ms', style({ opacity: 1, transform: 'translateY(-100%)' }))
                        ]),
                        transition('void => *', [
                            style({ opacity: 1, transform: 'translateY(-100%)' }),
                            animate('75ms', style({ opacity: 0, transform: 'translateY(0%)' }))
                        ])
                    ])
                ],
                styles: [".viewer{width:100vw;height:100vh}.viewer ion-slides{height:100%}.viewer img{height:auto;max-height:100%;width:auto;max-width:100%}.viewer img.instant{transition-duration:0s!important}.backdrop{background:rgba(0,0,0,.97);width:100vw;height:100vh;position:absolute}.gallery-toolbar{width:100%;--fiv-gallery-toolbar-color:#fff;position:absolute;color:var(--fiv-gallery-toolbar-color)}.gallery-toolbar.header{top:env(safe-area-inset-top)}.gallery-toolbar.footer{bottom:env(safe-area-inset-bottom)}ion-slides.in,ion-slides.out{visibility:hidden}"]
            }] }
];
/** @nocollapse */
FivGallery.ctorParameters = () => [
    { type: DomController },
    { type: Renderer2 },
    { type: AnimationBuilder },
    { type: ChangeDetectorRef },
    { type: Platform },
    { type: undefined, decorators: [{ type: Inject, args: [DOCUMENT,] }] },
    { type: ImageService }
];
FivGallery.propDecorators = {
    overlay: [{ type: ViewChild, args: ['overlay',] }],
    viewer: [{ type: ViewChild, args: ['viewer',] }],
    swiper: [{ type: ViewChild, args: ['slider', { read: ElementRef },] }],
    slides: [{ type: ViewChild, args: ['slider',] }],
    images: [{ type: ContentChildren, args: [forwardRef((/**
                 * @return {?}
                 */
                () => FivGalleryImage)), { descendants: true },] }],
    toolbars: [{ type: ContentChildren, args: [FivGalleryToolbar,] }],
    pagerVisible: [{ type: Input }],
    ambient: [{ type: Input }],
    openTiming: [{ type: Input }],
    closeTiming: [{ type: Input }],
    willOpen: [{ type: Output }],
    willClose: [{ type: Output }],
    didOpen: [{ type: Output }],
    didClose: [{ type: Output }],
    backdropChange: [{ type: Output }],
    keyEvent: [{ type: HostListener, args: ['window:keyup', ['$event'],] }]
};
if (false) {
    /** @type {?} */
    FivGallery.prototype.overlay;
    /** @type {?} */
    FivGallery.prototype.viewer;
    /** @type {?} */
    FivGallery.prototype.swiper;
    /** @type {?} */
    FivGallery.prototype.slides;
    /** @type {?} */
    FivGallery.prototype.images;
    /** @type {?} */
    FivGallery.prototype.toolbars;
    /** @type {?} */
    FivGallery.prototype.topToolbar;
    /** @type {?} */
    FivGallery.prototype.bottomToolbar;
    /** @type {?} */
    FivGallery.prototype.activeIndex;
    /** @type {?} */
    FivGallery.prototype.options;
    /** @type {?} */
    FivGallery.prototype.initialImage;
    /** @type {?} */
    FivGallery.prototype.inFullscreen;
    /** @type {?} */
    FivGallery.prototype.zoomedIn;
    /** @type {?} */
    FivGallery.prototype.controlsVisible;
    /**
     * @type {?}
     * @private
     */
    FivGallery.prototype.slidesLoaded;
    /** @type {?} */
    FivGallery.prototype.pagerVisible;
    /** @type {?} */
    FivGallery.prototype.ambient;
    /** @type {?} */
    FivGallery.prototype.openTiming;
    /** @type {?} */
    FivGallery.prototype.closeTiming;
    /** @type {?} */
    FivGallery.prototype.willOpen;
    /** @type {?} */
    FivGallery.prototype.willClose;
    /** @type {?} */
    FivGallery.prototype.didOpen;
    /** @type {?} */
    FivGallery.prototype.didClose;
    /** @type {?} */
    FivGallery.prototype.backdropChange;
    /** @type {?} */
    FivGallery.prototype.$onDestroy;
    /**
     * @type {?}
     * @private
     */
    FivGallery.prototype.domCtrl;
    /**
     * @type {?}
     * @private
     */
    FivGallery.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    FivGallery.prototype.animation;
    /**
     * @type {?}
     * @private
     */
    FivGallery.prototype.change;
    /**
     * @type {?}
     * @private
     */
    FivGallery.prototype.platform;
    /**
     * @type {?}
     * @private
     */
    FivGallery.prototype.document;
    /**
     * @type {?}
     * @private
     */
    FivGallery.prototype.imageService;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2FsbGVyeS5jb21wb25lbnQuanMiLCJzb3VyY2VSb290Ijoibmc6Ly9AZml2ZXRocmVlL2NvcmUvIiwic291cmNlcyI6WyJsaWIvZ2FsbGVyeS9nYWxsZXJ5LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQUEsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sNkNBQTZDLENBQUM7QUFDaEYsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQy9DLE9BQU8sRUFBRSxTQUFTLEVBQUUsYUFBYSxFQUFFLFFBQVEsRUFBRSxNQUFNLGdCQUFnQixDQUFDO0FBQ3BFLE9BQU8sRUFBRSxVQUFVLEVBQUUsTUFBTSxnQ0FBZ0MsQ0FBQztBQUM1RCxPQUFPLEVBQ0wsU0FBUyxFQUVULFNBQVMsRUFDVCxVQUFVLEVBQ1YsU0FBUyxFQUNULGVBQWUsRUFDZixTQUFTLEVBRVQsVUFBVSxFQUNWLFlBQVksRUFDWixNQUFNLEVBQ04saUJBQWlCLEVBRWpCLEtBQUssRUFDTCxNQUFNLEVBQ04sWUFBWSxFQUViLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFDTCxLQUFLLEVBQ0wsT0FBTyxFQUNQLGdCQUFnQixFQUNoQixPQUFPLEVBQ1AsVUFBVSxFQUNYLE1BQU0scUJBQXFCLENBQUM7QUFDN0IsT0FBTyxFQUFFLEdBQUcsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ3RDLE9BQU8sRUFBRSxRQUFRLEVBQUUsTUFBTSxpQkFBaUIsQ0FBQztBQUUzQyxPQUFPLEVBQ0wsZUFBZSxFQUVoQixNQUFNLHlDQUF5QyxDQUFDO0FBQ2pELE9BQU8sRUFBRSxJQUFJLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQ3JDLE9BQU8sRUFBRSxRQUFRLEVBQUUsU0FBUyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUF1Q3JELE1BQU0sT0FBTyxVQUFVOzs7Ozs7Ozs7O0lBaURyQixZQUNVLE9BQXNCLEVBQ3RCLFFBQW1CLEVBQ25CLFNBQTJCLEVBQzNCLE1BQXlCLEVBQ3pCLFFBQWtCLEVBQ0EsUUFBYSxFQUMvQixZQUEwQjtRQU4xQixZQUFPLEdBQVAsT0FBTyxDQUFlO1FBQ3RCLGFBQVEsR0FBUixRQUFRLENBQVc7UUFDbkIsY0FBUyxHQUFULFNBQVMsQ0FBa0I7UUFDM0IsV0FBTSxHQUFOLE1BQU0sQ0FBbUI7UUFDekIsYUFBUSxHQUFSLFFBQVEsQ0FBVTtRQUNBLGFBQVEsR0FBUixRQUFRLENBQUs7UUFDL0IsaUJBQVksR0FBWixZQUFZLENBQWM7O1FBekNwQyxnQkFBVyxHQUFHLENBQUMsQ0FBQztRQUNoQixZQUFPLEdBQUc7WUFDUixJQUFJLEVBQUUsSUFBSTtZQUNWLFlBQVksRUFBRSxDQUFDO1NBQ2hCLENBQUM7UUFJRixvQkFBZSxHQUFHLElBQUksQ0FBQztRQUVkLGlCQUFZLEdBQUcsSUFBSSxDQUFDO1FBQ3BCLFlBQU8sR0FBRyxJQUFJLENBQUM7UUFDZixlQUFVLEdBQUcsT0FBTyxDQUFDO1FBQ3JCLGdCQUFXLEdBQUcsT0FBTyxDQUFDO1FBQ3JCLGFBQVEsR0FBRyxJQUFJLFlBQVksRUFBbUIsQ0FBQztRQUMvQyxjQUFTLEdBQUcsSUFBSSxZQUFZLEVBQW1CLENBQUM7UUFDaEQsWUFBTyxHQUFHLElBQUksWUFBWSxFQUFtQixDQUFDO1FBQzlDLGFBQVEsR0FBRyxJQUFJLFlBQVksRUFBbUIsQ0FBQztRQUMvQyxtQkFBYyxHQUFHLElBQUksWUFBWSxFQUFtQixDQUFDO1FBRS9ELGVBQVUsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO0lBc0J4QixDQUFDOzs7OztJQW5CSixRQUFRLENBQUMsS0FBb0I7UUFDM0IsSUFDRSxJQUFJLENBQUMsT0FBTztZQUNaLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSTtZQUNqQixJQUFJLENBQUMsWUFBWTtZQUNqQixJQUFJLENBQUMsWUFBWSxDQUFDLFdBQVcsS0FBSyxRQUFRLEVBQzFDO1lBQ0EsSUFBSSxDQUFDLG9CQUFvQixDQUFDLEtBQUssQ0FBQyxDQUFDO1NBQ2xDO0lBQ0gsQ0FBQzs7OztJQVlELFFBQVEsS0FBSSxDQUFDOzs7O0lBRWIsa0JBQWtCO1FBQ2hCLElBQUksQ0FBQyxZQUFZLEVBQUUsQ0FBQztRQUNwQixJQUFJLENBQUMsY0FBYyxFQUFFLENBQUM7UUFDdEIsSUFBSSxDQUFDLHNCQUFzQixFQUFFLENBQUM7SUFDaEMsQ0FBQzs7OztJQUVELFdBQVc7UUFDVCxJQUFJLENBQUMsVUFBVSxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3pCLENBQUM7Ozs7SUFFRCxzQkFBc0I7UUFDcEIsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRzs7OztRQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLE9BQU8sRUFBQyxDQUFDO2FBQzFDLElBQUksQ0FDSCxRQUFROzs7O1FBQUMsQ0FBQyxLQUFvQyxFQUFFLEVBQUUsQ0FBQyxLQUFLLEVBQUMsRUFDekQsU0FBUyxDQUFrQixJQUFJLENBQUMsVUFBVSxDQUFDLENBQzVDO2FBQ0EsU0FBUzs7OztRQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBQyxDQUFDO1FBQ3hDLElBQUksQ0FBQyxJQUFJLENBQUMsTUFBTSxDQUFDLEdBQUc7Ozs7UUFBQyxLQUFLLENBQUMsRUFBRSxDQUFDLEtBQUssQ0FBQyxRQUFRLEVBQUMsQ0FBQzthQUMzQyxJQUFJLENBQ0gsUUFBUTs7OztRQUFDLENBQUMsS0FBb0MsRUFBRSxFQUFFLENBQUMsS0FBSyxFQUFDLEVBQ3pELFNBQVMsQ0FBa0IsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUM1QzthQUNBLFNBQVM7Ozs7UUFBQyxLQUFLLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxFQUFDLENBQUM7UUFFakQsSUFBSSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsR0FBRzs7OztRQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsS0FBSyxDQUFDLFFBQVEsRUFBQyxDQUFDO2FBQzNDLElBQUksQ0FDSCxRQUFROzs7O1FBQUMsQ0FBQyxLQUFvQyxFQUFFLEVBQUUsQ0FBQyxLQUFLLEVBQUMsRUFDekQsU0FBUyxDQUFrQixJQUFJLENBQUMsVUFBVSxDQUFDLENBQzVDO2FBQ0EsU0FBUzs7OztRQUFDLEtBQUssQ0FBQyxFQUFFLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLEVBQUMsQ0FBQztJQUNuRCxDQUFDOzs7O0lBRUQsWUFBWTtRQUNWLElBQUksQ0FBQyxNQUFNLENBQUMsT0FBTzs7Ozs7UUFBQyxDQUFDLEdBQUcsRUFBRSxDQUFDLEVBQUUsRUFBRTtZQUM3QixHQUFHLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztRQUNoQixDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7Ozs7SUFDRCxjQUFjO1FBQ1osSUFBSSxDQUFDLFFBQVEsQ0FBQyxPQUFPOzs7O1FBQUMsT0FBTyxDQUFDLEVBQUU7WUFDOUIsSUFBSSxPQUFPLENBQUMsUUFBUSxLQUFLLEtBQUssRUFBRTtnQkFDOUIsSUFBSSxDQUFDLFVBQVUsR0FBRyxPQUFPLENBQUMsT0FBTyxDQUFDO2FBQ25DO2lCQUFNO2dCQUNMLElBQUksQ0FBQyxhQUFhLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQzthQUN0QztRQUNILENBQUMsRUFBQyxDQUFDO0lBQ0wsQ0FBQzs7Ozs7SUFFRCxvQkFBb0IsQ0FBQyxLQUFvQjtRQUN2QyxJQUFJLEtBQUssQ0FBQyxPQUFPLEtBQUssR0FBRyxDQUFDLFVBQVUsRUFBRTtZQUNwQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDWixPQUFPO1NBQ1I7UUFDRCxJQUFJLEtBQUssQ0FBQyxPQUFPLEtBQUssR0FBRyxDQUFDLFNBQVMsRUFBRTtZQUNuQyxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDWixPQUFPO1NBQ1I7UUFDRCxJQUFJLEtBQUssQ0FBQyxPQUFPLEtBQUssR0FBRyxDQUFDLFNBQVMsSUFBSSxLQUFLLENBQUMsT0FBTyxLQUFLLEdBQUcsQ0FBQyxNQUFNLEVBQUU7WUFDbkUsSUFBSSxDQUFDLEtBQUssRUFBRSxDQUFDO1lBQ2IsT0FBTztTQUNSO0lBQ0gsQ0FBQzs7OztJQUVELElBQUk7UUFDRixJQUNFLElBQUksQ0FBQyxPQUFPO1lBQ1osSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJO1lBQ2pCLElBQUksQ0FBQyxZQUFZO1lBQ2pCLElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxLQUFLLFFBQVEsRUFDMUM7WUFDQSxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDO1NBQ3pCO0lBQ0gsQ0FBQzs7OztJQUNELElBQUk7UUFDRixJQUNFLElBQUksQ0FBQyxPQUFPO1lBQ1osSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJO1lBQ2pCLElBQUksQ0FBQyxZQUFZO1lBQ2pCLElBQUksQ0FBQyxZQUFZLENBQUMsV0FBVyxLQUFLLFFBQVEsRUFDMUM7WUFDQSxJQUFJLENBQUMsTUFBTSxDQUFDLFNBQVMsRUFBRSxDQUFDO1NBQ3pCO0lBQ0gsQ0FBQzs7Ozs7SUFFRCxJQUFJLENBQUMsT0FBd0I7UUFDM0IsSUFBSSxDQUFDLFdBQVcsR0FBRyxPQUFPLENBQUMsS0FBSyxDQUFDO1FBQ2pDLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQyxXQUFXLENBQUM7UUFDN0MsSUFBSSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDekIsSUFBSSxDQUFDLFlBQVksR0FBRyxPQUFPLENBQUM7UUFDNUIsSUFBSSxDQUFDLFlBQVksQ0FBQyxVQUFVLEdBQUcsSUFBSSxDQUFDLFVBQVUsQ0FBQztRQUMvQyxJQUFJLENBQUMsWUFBWSxDQUFDLFdBQVcsR0FBRyxJQUFJLENBQUMsV0FBVyxDQUFDO1FBQ2pELElBQUksQ0FBQyxZQUFZLENBQUMsYUFBYSxHQUFHLElBQUksQ0FBQyxPQUFPO1lBQzVDLENBQUMsQ0FBQyxJQUFJLENBQUMsWUFBWSxDQUFDLGFBQWEsQ0FDN0IsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsS0FBSyxDQUFDLGFBQWEsQ0FDNUQ7WUFDSCxDQUFDLENBQUMsTUFBTSxDQUFDO1FBQ1gsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO0lBQ3RCLENBQUM7Ozs7SUFFRCxLQUFLO1FBQ0gsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxDQUFDO0lBQzVCLENBQUM7Ozs7SUFDRCxPQUFPO1FBQ0wsSUFBSSxDQUFDLGlCQUFpQixDQUFDLENBQUMsRUFBRSxLQUFLLENBQUMsQ0FBQztJQUNuQyxDQUFDOzs7Ozs7SUFFRCxpQkFBaUIsQ0FBQyxRQUFnQixFQUFFLElBQUksR0FBRyxJQUFJO1FBQzdDLElBQUksSUFBSSxFQUFFO1lBQ1IsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksQ0FBQyxDQUFDO1NBQ3hDO1FBQ0QsSUFBSSxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQzs7Y0FFbEIsYUFBYSxHQUNqQixJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxLQUFLLEtBQUssSUFBSSxDQUFDLFlBQVksQ0FBQyxLQUFLOztjQUNyRSxRQUFRLEdBQUcsSUFBSSxDQUFDLGdCQUFnQixDQUNwQyxJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUMsQ0FBQyxLQUFLLEVBQzdDLFFBQVEsQ0FDVDtRQUNELElBQUksYUFBYSxFQUFFO1lBQ2pCLElBQUksQ0FBQyxZQUFZLENBQUMsS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1NBQ25DO2FBQU07O2tCQUNDLEdBQUcsR0FBRyxJQUFJLENBQUMsWUFBWSxDQUFDLEdBQUc7WUFDakMsSUFBSSxDQUFDLFlBQVksQ0FBQyxHQUFHLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLEVBQUUsQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLENBQUMsR0FBRyxDQUFDO1lBQ3BFLElBQUksQ0FBQyxZQUFZLENBQUMsUUFBUSxDQUFDLFFBQVEsRUFBRSxHQUFHLENBQUMsQ0FBQztTQUMzQztRQUNELElBQUksSUFBSSxDQUFDLFlBQVksRUFBRTtZQUNyQixJQUFJLENBQUMsZUFBZSxFQUFFLENBQUM7U0FDeEI7UUFDRCxJQUFJLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQztRQUMxQixJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3RCLENBQUM7Ozs7O0lBRUQsUUFBUSxDQUFDLFFBQWdCO1FBQ3ZCLElBQUksQ0FBQyxXQUFXLENBQUMsUUFBUSxDQUFDLENBQUM7SUFDN0IsQ0FBQzs7Ozs7OztJQUVPLGdCQUFnQixDQUFDLE9BQW1CLEVBQUUsU0FBaUIsQ0FBQzs7Y0FDeEQsTUFBTSxHQUFHLE9BQU8sQ0FBQyxhQUFhLENBQUMscUJBQXFCLEVBQUU7UUFDNUQsT0FBTztZQUNMLEdBQUcsRUFBRSxNQUFNLENBQUMsR0FBRztZQUNmLElBQUksRUFBRSxNQUFNLENBQUMsSUFBSTtZQUNqQixNQUFNLEVBQUUsT0FBTyxDQUFDLGFBQWEsQ0FBQyxZQUFZO1lBQzFDLEtBQUssRUFBRSxPQUFPLENBQUMsYUFBYSxDQUFDLFdBQVc7WUFDeEMsU0FBUyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsTUFBTSxFQUFFLEdBQUcsQ0FBQyxHQUFHLE1BQU0sR0FBRyxHQUFHO1NBQ3JELENBQUM7SUFDSixDQUFDOzs7OztJQUVELGVBQWUsQ0FBQyxRQUFnQjtRQUM5QixJQUFJLElBQUksQ0FBQyxlQUFlLEVBQUU7WUFDeEIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1NBQ3JCO1FBQ0QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxLQUFLOzs7UUFBQyxHQUFHLEVBQUU7WUFDdEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLENBQ3BCLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxFQUN6QixXQUFXLEVBQ1gsY0FBYyxRQUFRLEdBQUcsR0FBRyxLQUFLLENBQ2xDLENBQUM7UUFDSixDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7Ozs7O0lBRUQsV0FBVyxDQUFDLFFBQWdCOztjQUNwQixLQUFLLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxLQUFLLENBQUM7WUFDakMsS0FBSyxDQUFDLEVBQUUsU0FBUyxFQUFFLGNBQWMsUUFBUSxHQUFHLEdBQUcsS0FBSyxFQUFFLENBQUM7WUFDdkQsT0FBTyxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsRUFBRSxTQUFTLEVBQUUsaUJBQWlCLEVBQUUsQ0FBQyxDQUFDO1NBQzFELENBQUM7O2NBRUksU0FBUyxHQUFHLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUM7UUFDekQsU0FBUyxDQUFDLElBQUksRUFBRSxDQUFDO1FBQ2pCLFNBQVMsQ0FBQyxNQUFNOzs7UUFBQyxHQUFHLEVBQUU7WUFDcEIsU0FBUyxDQUFDLE9BQU8sRUFBRSxDQUFDO1lBQ3BCLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDeEIsSUFBSSxDQUFDLFlBQVksRUFBRSxDQUFDO1FBQ3RCLENBQUMsRUFBQyxDQUFDO0lBQ0wsQ0FBQzs7OztJQUVELGNBQWM7UUFDWixJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUM7SUFDbEUsQ0FBQzs7OztJQUVELGlCQUFpQjtRQUNmLElBQUksSUFBSSxDQUFDLFlBQVksRUFBRTtZQUNyQixJQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxXQUFXLEdBQUcsQ0FBQyxDQUFDLENBQUM7U0FDM0M7SUFDSCxDQUFDOzs7O0lBQ0QsaUJBQWlCO1FBQ2YsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ3JCLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLFdBQVcsR0FBRyxDQUFDLENBQUMsQ0FBQztTQUMzQztJQUNILENBQUM7Ozs7O0lBRUQsY0FBYyxDQUFDLEtBQWE7UUFDMUIsSUFBSSxDQUFDLFlBQVksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLE9BQU87WUFDNUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsYUFBYSxDQUM3QixJQUFJLENBQUMsTUFBTSxDQUFDLE9BQU8sRUFBRSxDQUFDLEtBQUssQ0FBQyxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQ2pEO1lBQ0gsQ0FBQyxDQUFDLE1BQU0sQ0FBQztRQUNYLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztJQUM5QyxDQUFDOzs7O0lBRUQsWUFBWTtRQUNWLElBQUksQ0FBQyxZQUFZLEdBQUcsSUFBSSxDQUFDO1FBQ3pCLElBQUksQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztRQUNyQyxJQUFJLENBQUMsV0FBVyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxXQUFXLENBQUM7UUFDaEUsSUFBSSxDQUFDLFlBQVksQ0FBQyxXQUFXLEdBQUcsUUFBUSxDQUFDO1FBQ3pDLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxFQUFFLENBQUMsT0FBTzs7O1FBQUUsR0FBRyxFQUFFO1lBQ2hELElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztRQUN6QixDQUFDLEVBQUMsQ0FBQztJQUNMLENBQUM7Ozs7SUFFRCxVQUFVO1FBQ1IsSUFBSSxJQUFJLENBQUMsWUFBWSxFQUFFO1lBQ3JCLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztTQUN4QjthQUFNO1lBQ0wsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDO1NBQ3ZCO0lBQ0gsQ0FBQzs7OztJQUVELGNBQWM7O2NBQ04sSUFBSSxHQUFHLFFBQVEsQ0FBQyxlQUFlO1FBQ3JDLElBQUksSUFBSSxDQUFDLGlCQUFpQixFQUFFO1lBQzFCLElBQUksQ0FBQyxpQkFBaUIsRUFBRSxDQUFDO1NBQzFCO2FBQU0sSUFBSSxJQUFJLENBQUMsc0JBQXNCLENBQUMsRUFBRTtZQUN2QyxhQUFhO1lBQ2IsSUFBSSxDQUFDLHNCQUFzQixDQUFDLEVBQUUsQ0FBQztTQUNoQzthQUFNLElBQUksSUFBSSxDQUFDLHlCQUF5QixDQUFDLEVBQUU7WUFDMUMsOEJBQThCO1lBQzlCLElBQUksQ0FBQyx5QkFBeUIsQ0FBQyxFQUFFLENBQUM7U0FDbkM7YUFBTSxJQUFJLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxFQUFFO1lBQ3RDLGFBQWE7WUFDYixJQUFJLENBQUMscUJBQXFCLENBQUMsRUFBRSxDQUFDO1NBQy9CO1FBQ0QsSUFBSSxDQUFDLFlBQVksR0FBRyxJQUFJLENBQUM7SUFDM0IsQ0FBQzs7OztJQUVELGVBQWU7UUFDYixJQUFJLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQztRQUUxQixJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsY0FBYyxFQUFFO1lBQ2hDLElBQUksQ0FBQyxRQUFRLENBQUMsY0FBYyxFQUFFLENBQUM7U0FDaEM7YUFBTSxJQUFJLElBQUksQ0FBQyxRQUFRLENBQUMsbUJBQW1CLEVBQUU7WUFDNUMsYUFBYTtZQUNiLElBQUksQ0FBQyxRQUFRLENBQUMsbUJBQW1CLEVBQUUsQ0FBQztTQUNyQzthQUFNLElBQUksSUFBSSxDQUFDLFFBQVEsQ0FBQyxvQkFBb0IsRUFBRTtZQUM3Qyw4QkFBOEI7WUFDOUIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO1NBQ3RDO2FBQU0sSUFBSSxJQUFJLENBQUMsUUFBUSxDQUFDLGdCQUFnQixFQUFFO1lBQ3pDLGFBQWE7WUFDYixJQUFJLENBQUMsUUFBUSxDQUFDLGdCQUFnQixFQUFFLENBQUM7U0FDbEM7SUFDSCxDQUFDOzs7O0lBRUQsSUFBSTtRQUNGLElBQUksSUFBSSxDQUFDLFFBQVEsRUFBRTtZQUNqQixJQUFJLENBQUMsT0FBTyxFQUFFLENBQUM7U0FDaEI7YUFBTTtZQUNMLElBQUksQ0FBQyxNQUFNLEVBQUUsQ0FBQztTQUNmO0lBQ0gsQ0FBQzs7OztJQUVELE1BQU07UUFDSixJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDO1FBQzNDLElBQUksQ0FBQyxRQUFRLEdBQUcsSUFBSSxDQUFDO0lBQ3ZCLENBQUM7Ozs7SUFFRCxPQUFPO1FBQ0wsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUUsQ0FBQztRQUM1QyxJQUFJLENBQUMsUUFBUSxHQUFHLEtBQUssQ0FBQztJQUN4QixDQUFDOzs7O0lBRUQsZUFBZTtRQUNiLElBQUksQ0FBQyxlQUFlLEdBQUcsQ0FBQyxJQUFJLENBQUMsZUFBZSxDQUFDO1FBQzdDLElBQUksQ0FBQyxNQUFNLENBQUMsYUFBYSxFQUFFLENBQUM7SUFDOUIsQ0FBQzs7OztJQUVELFlBQVk7UUFDVixJQUFJLENBQUMsZUFBZSxHQUFHLEtBQUssQ0FBQztRQUM3QixJQUFJLENBQUMsTUFBTSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQzlCLENBQUM7Ozs7SUFFRCxZQUFZO1FBQ1YsSUFBSSxDQUFDLGVBQWUsR0FBRyxJQUFJLENBQUM7UUFDNUIsSUFBSSxDQUFDLE1BQU0sQ0FBQyxhQUFhLEVBQUUsQ0FBQztJQUM5QixDQUFDOzs7WUEzWEYsU0FBUyxTQUFDO2dCQUNULFFBQVEsRUFBRSxhQUFhO2dCQUN2QiwrZ0VBQXVDO2dCQUV2QyxVQUFVLEVBQUU7b0JBQ1YsT0FBTyxDQUFDLE9BQU8sRUFBRTt3QkFDZixVQUFVLENBQUMsV0FBVyxFQUFFOzRCQUN0QixLQUFLLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsQ0FBQzs0QkFDNUMsT0FBTyxDQUFDLE9BQU8sRUFBRSxLQUFLLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRSxVQUFVLEVBQUUsQ0FBQyxDQUFDO3lCQUMvRCxDQUFDO3dCQUNGLFVBQVUsQ0FBQyxXQUFXLEVBQUU7NEJBQ3RCLEtBQUssQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxDQUFDOzRCQUM1QyxPQUFPLENBQUMsT0FBTyxFQUFFLEtBQUssQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBRSxDQUFDLENBQUM7eUJBQy9ELENBQUM7cUJBQ0gsQ0FBQztvQkFDRixPQUFPLENBQUMsU0FBUyxFQUFFO3dCQUNqQixVQUFVLENBQUMsV0FBVyxFQUFFOzRCQUN0QixLQUFLLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRSxrQkFBa0IsRUFBRSxDQUFDOzRCQUNwRCxPQUFPLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFLGdCQUFnQixFQUFFLENBQUMsQ0FBQzt5QkFDcEUsQ0FBQzt3QkFDRixVQUFVLENBQUMsV0FBVyxFQUFFOzRCQUN0QixLQUFLLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRSxDQUFDOzRCQUNsRCxPQUFPLENBQUMsTUFBTSxFQUFFLEtBQUssQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFLGtCQUFrQixFQUFFLENBQUMsQ0FBQzt5QkFDdEUsQ0FBQztxQkFDSCxDQUFDO29CQUNGLE9BQU8sQ0FBQyxXQUFXLEVBQUU7d0JBQ25CLFVBQVUsQ0FBQyxXQUFXLEVBQUU7NEJBQ3RCLEtBQUssQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFLGdCQUFnQixFQUFFLENBQUM7NEJBQ2xELE9BQU8sQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUUsbUJBQW1CLEVBQUUsQ0FBQyxDQUFDO3lCQUN2RSxDQUFDO3dCQUNGLFVBQVUsQ0FBQyxXQUFXLEVBQUU7NEJBQ3RCLEtBQUssQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsU0FBUyxFQUFFLG1CQUFtQixFQUFFLENBQUM7NEJBQ3JELE9BQU8sQ0FBQyxNQUFNLEVBQUUsS0FBSyxDQUFDLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxTQUFTLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDO3lCQUNwRSxDQUFDO3FCQUNILENBQUM7aUJBQ0g7O2FBQ0Y7Ozs7WUExRW1CLGFBQWE7WUFPL0IsU0FBUztZQWlCVCxnQkFBZ0I7WUFWaEIsaUJBQWlCO1lBZGdCLFFBQVE7NENBa0l0QyxNQUFNLFNBQUMsUUFBUTtZQW5JWCxZQUFZOzs7c0JBOEVsQixTQUFTLFNBQUMsU0FBUztxQkFDbkIsU0FBUyxTQUFDLFFBQVE7cUJBQ2xCLFNBQVMsU0FBQyxRQUFRLEVBQUUsRUFBRSxJQUFJLEVBQUUsVUFBVSxFQUFFO3FCQUN4QyxTQUFTLFNBQUMsUUFBUTtxQkFFbEIsZUFBZSxTQUFDLFVBQVU7OztnQkFBQyxHQUFHLEVBQUUsQ0FBQyxlQUFlLEVBQUMsRUFBRSxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUU7dUJBRXhFLGVBQWUsU0FBQyxpQkFBaUI7MkJBZ0JqQyxLQUFLO3NCQUNMLEtBQUs7eUJBQ0wsS0FBSzswQkFDTCxLQUFLO3VCQUNMLE1BQU07d0JBQ04sTUFBTTtzQkFDTixNQUFNO3VCQUNOLE1BQU07NkJBQ04sTUFBTTt1QkFJTixZQUFZLFNBQUMsY0FBYyxFQUFFLENBQUMsUUFBUSxDQUFDOzs7O0lBbkN4Qyw2QkFBMEM7O0lBQzFDLDRCQUF3Qzs7SUFDeEMsNEJBQThEOztJQUM5RCw0QkFBdUM7O0lBRXZDLDRCQUNtQzs7SUFDbkMsOEJBQTJFOztJQUUzRSxnQ0FBNkI7O0lBQzdCLG1DQUFnQzs7SUFHaEMsaUNBQWdCOztJQUNoQiw2QkFHRTs7SUFDRixrQ0FBOEI7O0lBQzlCLGtDQUFzQjs7SUFDdEIsOEJBQWtCOztJQUNsQixxQ0FBdUI7Ozs7O0lBQ3ZCLGtDQUFxQjs7SUFDckIsa0NBQTZCOztJQUM3Qiw2QkFBd0I7O0lBQ3hCLGdDQUE4Qjs7SUFDOUIsaUNBQStCOztJQUMvQiw4QkFBeUQ7O0lBQ3pELCtCQUEwRDs7SUFDMUQsNkJBQXdEOztJQUN4RCw4QkFBeUQ7O0lBQ3pELG9DQUErRDs7SUFFL0QsZ0NBQTJCOzs7OztJQWV6Qiw2QkFBOEI7Ozs7O0lBQzlCLDhCQUEyQjs7Ozs7SUFDM0IsK0JBQW1DOzs7OztJQUNuQyw0QkFBaUM7Ozs7O0lBQ2pDLDhCQUEwQjs7Ozs7SUFDMUIsOEJBQXVDOzs7OztJQUN2QyxrQ0FBa0MiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBGaXZHYWxsZXJ5VG9vbGJhciB9IGZyb20gJy4vZ2FsbGVyeS10b29sYmFyL2dhbGxlcnktdG9vbGJhci5jb21wb25lbnQnO1xuaW1wb3J0IHsgSW1hZ2VTZXJ2aWNlIH0gZnJvbSAnLi9pbWFnZS5zZXJ2aWNlJztcbmltcG9ydCB7IElvblNsaWRlcywgRG9tQ29udHJvbGxlciwgUGxhdGZvcm0gfSBmcm9tICdAaW9uaWMvYW5ndWxhcic7XG5pbXBvcnQgeyBGaXZPdmVybGF5IH0gZnJvbSAnLi8uLi9vdmVybGF5L292ZXJsYXkuY29tcG9uZW50JztcbmltcG9ydCB7XG4gIENvbXBvbmVudCxcbiAgT25Jbml0LFxuICBWaWV3Q2hpbGQsXG4gIEVsZW1lbnRSZWYsXG4gIFJlbmRlcmVyMixcbiAgQ29udGVudENoaWxkcmVuLFxuICBRdWVyeUxpc3QsXG4gIEFmdGVyQ29udGVudEluaXQsXG4gIGZvcndhcmRSZWYsXG4gIEhvc3RMaXN0ZW5lcixcbiAgSW5qZWN0LFxuICBDaGFuZ2VEZXRlY3RvclJlZixcbiAgVGVtcGxhdGVSZWYsXG4gIElucHV0LFxuICBPdXRwdXQsXG4gIEV2ZW50RW1pdHRlcixcbiAgT25EZXN0cm95XG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgc3R5bGUsXG4gIGFuaW1hdGUsXG4gIEFuaW1hdGlvbkJ1aWxkZXIsXG4gIHRyaWdnZXIsXG4gIHRyYW5zaXRpb25cbn0gZnJvbSAnQGFuZ3VsYXIvYW5pbWF0aW9ucyc7XG5pbXBvcnQgeyBLZXkgfSBmcm9tICcuL2tleWNvZGVzLmVudW0nO1xuaW1wb3J0IHsgRE9DVU1FTlQgfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHsgTmF2aWdhdGVhYmxlIH0gZnJvbSAnLi4vaW50ZXJmYWNlcyc7XG5pbXBvcnQge1xuICBGaXZHYWxsZXJ5SW1hZ2UsXG4gIFBvc2l0aW9uXG59IGZyb20gJy4vZ2FsbGVyeS1pbWFnZS9nYWxsZXJ5LWltYWdlLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBmcm9tLCBTdWJqZWN0IH0gZnJvbSAncnhqcyc7XG5pbXBvcnQgeyBtZXJnZU1hcCwgdGFrZVVudGlsIH0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdmaXYtZ2FsbGVyeScsXG4gIHRlbXBsYXRlVXJsOiAnLi9nYWxsZXJ5LmNvbXBvbmVudC5odG1sJyxcbiAgc3R5bGVVcmxzOiBbJy4vZ2FsbGVyeS5jb21wb25lbnQuc2NzcyddLFxuICBhbmltYXRpb25zOiBbXG4gICAgdHJpZ2dlcignc2NhbGUnLCBbXG4gICAgICB0cmFuc2l0aW9uKCd2b2lkID0+IConLCBbXG4gICAgICAgIHN0eWxlKHsgb3BhY2l0eTogMCwgdHJhbnNmb3JtOiAnc2NhbGUoMCknIH0pLFxuICAgICAgICBhbmltYXRlKCcxMjVtcycsIHN0eWxlKHsgb3BhY2l0eTogMSwgdHJhbnNmb3JtOiAnc2NhbGUoMSknIH0pKVxuICAgICAgXSksXG4gICAgICB0cmFuc2l0aW9uKCcqID0+IHZvaWQnLCBbXG4gICAgICAgIHN0eWxlKHsgb3BhY2l0eTogMSwgdHJhbnNmb3JtOiAnc2NhbGUoMSknIH0pLFxuICAgICAgICBhbmltYXRlKCcxMjVtcycsIHN0eWxlKHsgb3BhY2l0eTogMCwgdHJhbnNmb3JtOiAnc2NhbGUoMCknIH0pKVxuICAgICAgXSlcbiAgICBdKSxcbiAgICB0cmlnZ2VyKCdzbGlkZVVwJywgW1xuICAgICAgdHJhbnNpdGlvbigndm9pZCA9PiAqJywgW1xuICAgICAgICBzdHlsZSh7IG9wYWNpdHk6IDAsIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVkoMTAwJSknIH0pLFxuICAgICAgICBhbmltYXRlKCc3NW1zJywgc3R5bGUoeyBvcGFjaXR5OiAxLCB0cmFuc2Zvcm06ICd0cmFuc2xhdGVZKDAlKScgfSkpXG4gICAgICBdKSxcbiAgICAgIHRyYW5zaXRpb24oJyogPT4gdm9pZCcsIFtcbiAgICAgICAgc3R5bGUoeyBvcGFjaXR5OiAxLCB0cmFuc2Zvcm06ICd0cmFuc2xhdGVZKDAlKScgfSksXG4gICAgICAgIGFuaW1hdGUoJzc1bXMnLCBzdHlsZSh7IG9wYWNpdHk6IDAsIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVkoMTAwJSknIH0pKVxuICAgICAgXSlcbiAgICBdKSxcbiAgICB0cmlnZ2VyKCdzbGlkZURvd24nLCBbXG4gICAgICB0cmFuc2l0aW9uKCcqID0+IHZvaWQnLCBbXG4gICAgICAgIHN0eWxlKHsgb3BhY2l0eTogMCwgdHJhbnNmb3JtOiAndHJhbnNsYXRlWSgwJSknIH0pLFxuICAgICAgICBhbmltYXRlKCc3NW1zJywgc3R5bGUoeyBvcGFjaXR5OiAxLCB0cmFuc2Zvcm06ICd0cmFuc2xhdGVZKC0xMDAlKScgfSkpXG4gICAgICBdKSxcbiAgICAgIHRyYW5zaXRpb24oJ3ZvaWQgPT4gKicsIFtcbiAgICAgICAgc3R5bGUoeyBvcGFjaXR5OiAxLCB0cmFuc2Zvcm06ICd0cmFuc2xhdGVZKC0xMDAlKScgfSksXG4gICAgICAgIGFuaW1hdGUoJzc1bXMnLCBzdHlsZSh7IG9wYWNpdHk6IDAsIHRyYW5zZm9ybTogJ3RyYW5zbGF0ZVkoMCUpJyB9KSlcbiAgICAgIF0pXG4gICAgXSlcbiAgXVxufSlcbmV4cG9ydCBjbGFzcyBGaXZHYWxsZXJ5XG4gIGltcGxlbWVudHMgT25Jbml0LCBBZnRlckNvbnRlbnRJbml0LCBPbkRlc3Ryb3ksIE5hdmlnYXRlYWJsZSB7XG4gIEBWaWV3Q2hpbGQoJ292ZXJsYXknKSBvdmVybGF5OiBGaXZPdmVybGF5O1xuICBAVmlld0NoaWxkKCd2aWV3ZXInKSB2aWV3ZXI6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoJ3NsaWRlcicsIHsgcmVhZDogRWxlbWVudFJlZiB9KSBzd2lwZXI6IEVsZW1lbnRSZWY7XG4gIEBWaWV3Q2hpbGQoJ3NsaWRlcicpIHNsaWRlczogSW9uU2xpZGVzO1xuXG4gIEBDb250ZW50Q2hpbGRyZW4oZm9yd2FyZFJlZigoKSA9PiBGaXZHYWxsZXJ5SW1hZ2UpLCB7IGRlc2NlbmRhbnRzOiB0cnVlIH0pXG4gIGltYWdlczogUXVlcnlMaXN0PEZpdkdhbGxlcnlJbWFnZT47XG4gIEBDb250ZW50Q2hpbGRyZW4oRml2R2FsbGVyeVRvb2xiYXIpIHRvb2xiYXJzOiBRdWVyeUxpc3Q8Rml2R2FsbGVyeVRvb2xiYXI+O1xuXG4gIHRvcFRvb2xiYXI6IFRlbXBsYXRlUmVmPGFueT47XG4gIGJvdHRvbVRvb2xiYXI6IFRlbXBsYXRlUmVmPGFueT47XG5cbiAgLy8gcHJvcGVydGllcyBmb3IgdGhlIHNsaWRlc1xuICBhY3RpdmVJbmRleCA9IDA7XG4gIG9wdGlvbnMgPSB7XG4gICAgem9vbTogdHJ1ZSxcbiAgICBpbml0aWFsU2xpZGU6IDBcbiAgfTtcbiAgaW5pdGlhbEltYWdlOiBGaXZHYWxsZXJ5SW1hZ2U7XG4gIGluRnVsbHNjcmVlbjogYm9vbGVhbjtcbiAgem9vbWVkSW46IGJvb2xlYW47XG4gIGNvbnRyb2xzVmlzaWJsZSA9IHRydWU7XG4gIHByaXZhdGUgc2xpZGVzTG9hZGVkO1xuICBASW5wdXQoKSBwYWdlclZpc2libGUgPSB0cnVlO1xuICBASW5wdXQoKSBhbWJpZW50ID0gdHJ1ZTtcbiAgQElucHV0KCkgb3BlblRpbWluZyA9ICczMDBtcyc7XG4gIEBJbnB1dCgpIGNsb3NlVGltaW5nID0gJzM0MG1zJztcbiAgQE91dHB1dCgpIHdpbGxPcGVuID0gbmV3IEV2ZW50RW1pdHRlcjxGaXZHYWxsZXJ5SW1hZ2U+KCk7XG4gIEBPdXRwdXQoKSB3aWxsQ2xvc2UgPSBuZXcgRXZlbnRFbWl0dGVyPEZpdkdhbGxlcnlJbWFnZT4oKTtcbiAgQE91dHB1dCgpIGRpZE9wZW4gPSBuZXcgRXZlbnRFbWl0dGVyPEZpdkdhbGxlcnlJbWFnZT4oKTtcbiAgQE91dHB1dCgpIGRpZENsb3NlID0gbmV3IEV2ZW50RW1pdHRlcjxGaXZHYWxsZXJ5SW1hZ2U+KCk7XG4gIEBPdXRwdXQoKSBiYWNrZHJvcENoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8Rml2R2FsbGVyeUltYWdlPigpO1xuXG4gICRvbkRlc3Ryb3kgPSBuZXcgU3ViamVjdCgpO1xuXG4gIEBIb3N0TGlzdGVuZXIoJ3dpbmRvdzprZXl1cCcsIFsnJGV2ZW50J10pXG4gIGtleUV2ZW50KGV2ZW50OiBLZXlib2FyZEV2ZW50KSB7XG4gICAgaWYgKFxuICAgICAgdGhpcy5vdmVybGF5ICYmXG4gICAgICB0aGlzLm92ZXJsYXkub3BlbiAmJlxuICAgICAgdGhpcy5pbml0aWFsSW1hZ2UgJiZcbiAgICAgIHRoaXMuaW5pdGlhbEltYWdlLnZpZXdlclN0YXRlID09PSAnaGlkZGVuJ1xuICAgICkge1xuICAgICAgdGhpcy5oYW5kbGVLZXlib2FyZEV2ZW50cyhldmVudCk7XG4gICAgfVxuICB9XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBkb21DdHJsOiBEb21Db250cm9sbGVyLFxuICAgIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMixcbiAgICBwcml2YXRlIGFuaW1hdGlvbjogQW5pbWF0aW9uQnVpbGRlcixcbiAgICBwcml2YXRlIGNoYW5nZTogQ2hhbmdlRGV0ZWN0b3JSZWYsXG4gICAgcHJpdmF0ZSBwbGF0Zm9ybTogUGxhdGZvcm0sXG4gICAgQEluamVjdChET0NVTUVOVCkgcHJpdmF0ZSBkb2N1bWVudDogYW55LFxuICAgIHByaXZhdGUgaW1hZ2VTZXJ2aWNlOiBJbWFnZVNlcnZpY2VcbiAgKSB7fVxuXG4gIG5nT25Jbml0KCkge31cblxuICBuZ0FmdGVyQ29udGVudEluaXQoKTogdm9pZCB7XG4gICAgdGhpcy51cGRhdGVJbWFnZXMoKTtcbiAgICB0aGlzLnVwZGF0ZVRvb2xiYXJzKCk7XG4gICAgdGhpcy5zdWJzY3JpYmVUb0ltYWdlRXZlbnRzKCk7XG4gIH1cblxuICBuZ09uRGVzdHJveSgpOiB2b2lkIHtcbiAgICB0aGlzLiRvbkRlc3Ryb3kubmV4dCgpO1xuICB9XG5cbiAgc3Vic2NyaWJlVG9JbWFnZUV2ZW50cygpIHtcbiAgICBmcm9tKHRoaXMuaW1hZ2VzLm1hcChpbWFnZSA9PiBpbWFnZS5kaWRPcGVuKSlcbiAgICAgIC5waXBlKFxuICAgICAgICBtZXJnZU1hcCgodmFsdWU6IEV2ZW50RW1pdHRlcjxGaXZHYWxsZXJ5SW1hZ2U+KSA9PiB2YWx1ZSksXG4gICAgICAgIHRha2VVbnRpbDxGaXZHYWxsZXJ5SW1hZ2U+KHRoaXMuJG9uRGVzdHJveSlcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoaW1hZ2UgPT4gdGhpcy5vcGVuKGltYWdlKSk7XG4gICAgZnJvbSh0aGlzLmltYWdlcy5tYXAoaW1hZ2UgPT4gaW1hZ2Uud2lsbE9wZW4pKVxuICAgICAgLnBpcGUoXG4gICAgICAgIG1lcmdlTWFwKCh2YWx1ZTogRXZlbnRFbWl0dGVyPEZpdkdhbGxlcnlJbWFnZT4pID0+IHZhbHVlKSxcbiAgICAgICAgdGFrZVVudGlsPEZpdkdhbGxlcnlJbWFnZT4odGhpcy4kb25EZXN0cm95KVxuICAgICAgKVxuICAgICAgLnN1YnNjcmliZShpbWFnZSA9PiB0aGlzLndpbGxPcGVuLmVtaXQoaW1hZ2UpKTtcblxuICAgIGZyb20odGhpcy5pbWFnZXMubWFwKGltYWdlID0+IGltYWdlLmRpZENsb3NlKSlcbiAgICAgIC5waXBlKFxuICAgICAgICBtZXJnZU1hcCgodmFsdWU6IEV2ZW50RW1pdHRlcjxGaXZHYWxsZXJ5SW1hZ2U+KSA9PiB2YWx1ZSksXG4gICAgICAgIHRha2VVbnRpbDxGaXZHYWxsZXJ5SW1hZ2U+KHRoaXMuJG9uRGVzdHJveSlcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoaW1hZ2UgPT4gdGhpcy5kaWRDbG9zZS5lbWl0KGltYWdlKSk7XG4gIH1cblxuICB1cGRhdGVJbWFnZXMoKSB7XG4gICAgdGhpcy5pbWFnZXMuZm9yRWFjaCgoaW1nLCBpKSA9PiB7XG4gICAgICBpbWcuaW5kZXggPSBpO1xuICAgIH0pO1xuICB9XG4gIHVwZGF0ZVRvb2xiYXJzKCkge1xuICAgIHRoaXMudG9vbGJhcnMuZm9yRWFjaCh0b29sYmFyID0+IHtcbiAgICAgIGlmICh0b29sYmFyLnBvc2l0aW9uID09PSAndG9wJykge1xuICAgICAgICB0aGlzLnRvcFRvb2xiYXIgPSB0b29sYmFyLmNvbnRlbnQ7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmJvdHRvbVRvb2xiYXIgPSB0b29sYmFyLmNvbnRlbnQ7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBoYW5kbGVLZXlib2FyZEV2ZW50cyhldmVudDogS2V5Ym9hcmRFdmVudCkge1xuICAgIGlmIChldmVudC5rZXlDb2RlID09PSBLZXkuUmlnaHRBcnJvdykge1xuICAgICAgdGhpcy5uZXh0KCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChldmVudC5rZXlDb2RlID09PSBLZXkuTGVmdEFycm93KSB7XG4gICAgICB0aGlzLnByZXYoKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGV2ZW50LmtleUNvZGUgPT09IEtleS5Eb3duQXJyb3cgfHwgZXZlbnQua2V5Q29kZSA9PT0gS2V5LkVzY2FwZSkge1xuICAgICAgdGhpcy5jbG9zZSgpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgfVxuXG4gIG5leHQoKSB7XG4gICAgaWYgKFxuICAgICAgdGhpcy5vdmVybGF5ICYmXG4gICAgICB0aGlzLm92ZXJsYXkub3BlbiAmJlxuICAgICAgdGhpcy5pbml0aWFsSW1hZ2UgJiZcbiAgICAgIHRoaXMuaW5pdGlhbEltYWdlLnZpZXdlclN0YXRlID09PSAnaGlkZGVuJ1xuICAgICkge1xuICAgICAgdGhpcy5zbGlkZXMuc2xpZGVOZXh0KCk7XG4gICAgfVxuICB9XG4gIHByZXYoKSB7XG4gICAgaWYgKFxuICAgICAgdGhpcy5vdmVybGF5ICYmXG4gICAgICB0aGlzLm92ZXJsYXkub3BlbiAmJlxuICAgICAgdGhpcy5pbml0aWFsSW1hZ2UgJiZcbiAgICAgIHRoaXMuaW5pdGlhbEltYWdlLnZpZXdlclN0YXRlID09PSAnaGlkZGVuJ1xuICAgICkge1xuICAgICAgdGhpcy5zbGlkZXMuc2xpZGVQcmV2KCk7XG4gICAgfVxuICB9XG5cbiAgb3Blbihpbml0aWFsOiBGaXZHYWxsZXJ5SW1hZ2UpIHtcbiAgICB0aGlzLmFjdGl2ZUluZGV4ID0gaW5pdGlhbC5pbmRleDtcbiAgICB0aGlzLm9wdGlvbnMuaW5pdGlhbFNsaWRlID0gdGhpcy5hY3RpdmVJbmRleDtcbiAgICB0aGlzLm92ZXJsYXkuc2hvdyg1MDAwMCk7XG4gICAgdGhpcy5pbml0aWFsSW1hZ2UgPSBpbml0aWFsO1xuICAgIHRoaXMuaW5pdGlhbEltYWdlLm9wZW5UaW1pbmcgPSB0aGlzLm9wZW5UaW1pbmc7XG4gICAgdGhpcy5pbml0aWFsSW1hZ2UuY2xvc2VUaW1pbmcgPSB0aGlzLmNsb3NlVGltaW5nO1xuICAgIHRoaXMuaW5pdGlhbEltYWdlLmJhY2tkcm9wQ29sb3IgPSB0aGlzLmFtYmllbnRcbiAgICAgID8gdGhpcy5pbWFnZVNlcnZpY2UuZ2V0QXZlcmFnZVJHQihcbiAgICAgICAgICB0aGlzLmltYWdlcy50b0FycmF5KClbdGhpcy5hY3RpdmVJbmRleF0uaW1hZ2UubmF0aXZlRWxlbWVudFxuICAgICAgICApXG4gICAgICA6ICcjMDAwJztcbiAgICB0aGlzLnNob3dDb250cm9scygpO1xuICB9XG5cbiAgY2xvc2UoKSB7XG4gICAgdGhpcy5jbG9zZUZyb21QdWxsRG93bigwKTtcbiAgfVxuICBkaXNtaXNzKCkge1xuICAgIHRoaXMuY2xvc2VGcm9tUHVsbERvd24oMCwgZmFsc2UpO1xuICB9XG5cbiAgY2xvc2VGcm9tUHVsbERvd24ocHJvZ3Jlc3M6IG51bWJlciwgZW1pdCA9IHRydWUpIHtcbiAgICBpZiAoZW1pdCkge1xuICAgICAgdGhpcy53aWxsQ2xvc2UuZW1pdCh0aGlzLmluaXRpYWxJbWFnZSk7XG4gICAgfVxuICAgIHRoaXMudHJhbnNmb3JtU2xpZGVzKDApO1xuXG4gICAgY29uc3Qgc2FtZUFzSW5pdGlhbCA9XG4gICAgICB0aGlzLmltYWdlcy50b0FycmF5KClbdGhpcy5hY3RpdmVJbmRleF0uaW5kZXggPT09IHRoaXMuaW5pdGlhbEltYWdlLmluZGV4O1xuICAgIGNvbnN0IHBvc2l0aW9uID0gdGhpcy5nZXRJbWFnZVBvc2l0aW9uKFxuICAgICAgdGhpcy5pbWFnZXMudG9BcnJheSgpW3RoaXMuYWN0aXZlSW5kZXhdLmltYWdlLFxuICAgICAgcHJvZ3Jlc3NcbiAgICApO1xuICAgIGlmIChzYW1lQXNJbml0aWFsKSB7XG4gICAgICB0aGlzLmluaXRpYWxJbWFnZS5jbG9zZShwb3NpdGlvbik7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IHNyYyA9IHRoaXMuaW5pdGlhbEltYWdlLnNyYztcbiAgICAgIHRoaXMuaW5pdGlhbEltYWdlLnNyYyA9IHRoaXMuaW1hZ2VzLnRvQXJyYXkoKVt0aGlzLmFjdGl2ZUluZGV4XS5zcmM7XG4gICAgICB0aGlzLmluaXRpYWxJbWFnZS5zbGlkZU91dChwb3NpdGlvbiwgc3JjKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuaW5GdWxsc2NyZWVuKSB7XG4gICAgICB0aGlzLmNsb3NlRnVsbHNjcmVlbigpO1xuICAgIH1cbiAgICB0aGlzLnNsaWRlc0xvYWRlZCA9IGZhbHNlO1xuICAgIHRoaXMub3ZlcmxheS5oaWRlKCk7XG4gIH1cblxuICByZXNldFBhbihwcm9ncmVzczogbnVtYmVyKSB7XG4gICAgdGhpcy5yZXNldFNsaWRlcyhwcm9ncmVzcyk7XG4gIH1cblxuICBwcml2YXRlIGdldEltYWdlUG9zaXRpb24oZWxlbWVudDogRWxlbWVudFJlZiwgb2Zmc2V0OiBudW1iZXIgPSAwKTogUG9zaXRpb24ge1xuICAgIGNvbnN0IGJvdW5kcyA9IGVsZW1lbnQubmF0aXZlRWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtcbiAgICByZXR1cm4ge1xuICAgICAgdG9wOiBib3VuZHMudG9wLFxuICAgICAgbGVmdDogYm91bmRzLmxlZnQsXG4gICAgICBoZWlnaHQ6IGVsZW1lbnQubmF0aXZlRWxlbWVudC5jbGllbnRIZWlnaHQsXG4gICAgICB3aWR0aDogZWxlbWVudC5uYXRpdmVFbGVtZW50LmNsaWVudFdpZHRoLFxuICAgICAgdHJhbnNsYXRlOiB0aGlzLnBsYXRmb3JtLmhlaWdodCgpIC8gMiArIG9mZnNldCAqIDEyMFxuICAgIH07XG4gIH1cblxuICB0cmFuc2Zvcm1TbGlkZXMocHJvZ3Jlc3M6IG51bWJlcikge1xuICAgIGlmICh0aGlzLmNvbnRyb2xzVmlzaWJsZSkge1xuICAgICAgdGhpcy5oaWRlQ29udHJvbHMoKTtcbiAgICB9XG4gICAgdGhpcy5kb21DdHJsLndyaXRlKCgpID0+IHtcbiAgICAgIHRoaXMucmVuZGVyZXIuc2V0U3R5bGUoXG4gICAgICAgIHRoaXMudmlld2VyLm5hdGl2ZUVsZW1lbnQsXG4gICAgICAgICd0cmFuc2Zvcm0nLFxuICAgICAgICBgdHJhbnNsYXRlWSgke3Byb2dyZXNzICogMTIwfXB4KWBcbiAgICAgICk7XG4gICAgfSk7XG4gIH1cblxuICByZXNldFNsaWRlcyhwcm9ncmVzczogbnVtYmVyKSB7XG4gICAgY29uc3QgcmVzZXQgPSB0aGlzLmFuaW1hdGlvbi5idWlsZChbXG4gICAgICBzdHlsZSh7IHRyYW5zZm9ybTogYHRyYW5zbGF0ZVkoJHtwcm9ncmVzcyAqIDEyMH1weClgIH0pLFxuICAgICAgYW5pbWF0ZSgnMTUwbXMnLCBzdHlsZSh7IHRyYW5zZm9ybTogYHRyYW5zbGF0ZVkoMHB4KWAgfSkpXG4gICAgXSk7XG5cbiAgICBjb25zdCBhbmltYXRpb24gPSByZXNldC5jcmVhdGUodGhpcy52aWV3ZXIubmF0aXZlRWxlbWVudCk7XG4gICAgYW5pbWF0aW9uLnBsYXkoKTtcbiAgICBhbmltYXRpb24ub25Eb25lKCgpID0+IHtcbiAgICAgIGFuaW1hdGlvbi5kZXN0cm95KCk7XG4gICAgICB0aGlzLnRyYW5zZm9ybVNsaWRlcygwKTtcbiAgICAgIHRoaXMuc2hvd0NvbnRyb2xzKCk7XG4gICAgfSk7XG4gIH1cblxuICBzbGlkZURpZENoYW5nZSgpIHtcbiAgICB0aGlzLmFjdGl2ZUluZGV4ID0gdGhpcy5zd2lwZXIubmF0aXZlRWxlbWVudC5zd2lwZXIuYWN0aXZlSW5kZXg7XG4gIH1cblxuICBpb25TbGlkZU5leHRTdGFydCgpIHtcbiAgICBpZiAodGhpcy5zbGlkZXNMb2FkZWQpIHtcbiAgICAgIHRoaXMudXBkYXRlQmFja2Ryb3AodGhpcy5hY3RpdmVJbmRleCArIDEpO1xuICAgIH1cbiAgfVxuICBpb25TbGlkZVByZXZTdGFydCgpIHtcbiAgICBpZiAodGhpcy5zbGlkZXNMb2FkZWQpIHtcbiAgICAgIHRoaXMudXBkYXRlQmFja2Ryb3AodGhpcy5hY3RpdmVJbmRleCAtIDEpO1xuICAgIH1cbiAgfVxuXG4gIHVwZGF0ZUJhY2tkcm9wKGluZGV4OiBudW1iZXIpIHtcbiAgICB0aGlzLmluaXRpYWxJbWFnZS5iYWNrZHJvcENvbG9yID0gdGhpcy5hbWJpZW50XG4gICAgICA/IHRoaXMuaW1hZ2VTZXJ2aWNlLmdldEF2ZXJhZ2VSR0IoXG4gICAgICAgICAgdGhpcy5pbWFnZXMudG9BcnJheSgpW2luZGV4XS5pbWFnZS5uYXRpdmVFbGVtZW50XG4gICAgICAgIClcbiAgICAgIDogJyMwMDAnO1xuICAgIHRoaXMuYmFja2Ryb3BDaGFuZ2UuZW1pdCh0aGlzLmluaXRpYWxJbWFnZSk7XG4gIH1cblxuICBvblNsaWRlc0xvYWQoKSB7XG4gICAgdGhpcy5zbGlkZXNMb2FkZWQgPSB0cnVlO1xuICAgIHRoaXMuZGlkT3Blbi5lbWl0KHRoaXMuaW5pdGlhbEltYWdlKTtcbiAgICB0aGlzLmFjdGl2ZUluZGV4ID0gdGhpcy5zd2lwZXIubmF0aXZlRWxlbWVudC5zd2lwZXIuYWN0aXZlSW5kZXg7XG4gICAgdGhpcy5pbml0aWFsSW1hZ2Uudmlld2VyU3RhdGUgPSAnaGlkZGVuJztcbiAgICB0aGlzLnN3aXBlci5uYXRpdmVFbGVtZW50LnN3aXBlci5vbignY2xpY2snLCAoKSA9PiB7XG4gICAgICB0aGlzLmhhbmRsZVNpbmdsZVRhcCgpO1xuICAgIH0pO1xuICB9XG5cbiAgZnVsbHNjcmVlbigpIHtcbiAgICBpZiAodGhpcy5pbkZ1bGxzY3JlZW4pIHtcbiAgICAgIHRoaXMuY2xvc2VGdWxsc2NyZWVuKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMub3BlbkZ1bGxzY3JlZW4oKTtcbiAgICB9XG4gIH1cblxuICBvcGVuRnVsbHNjcmVlbigpIHtcbiAgICBjb25zdCBlbGVtID0gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50O1xuICAgIGlmIChlbGVtLnJlcXVlc3RGdWxsc2NyZWVuKSB7XG4gICAgICBlbGVtLnJlcXVlc3RGdWxsc2NyZWVuKCk7XG4gICAgfSBlbHNlIGlmIChlbGVtWydtb3pSZXF1ZXN0RnVsbFNjcmVlbiddKSB7XG4gICAgICAvKiBGaXJlZm94ICovXG4gICAgICBlbGVtWydtb3pSZXF1ZXN0RnVsbFNjcmVlbiddKCk7XG4gICAgfSBlbHNlIGlmIChlbGVtWyd3ZWJraXRSZXF1ZXN0RnVsbHNjcmVlbiddKSB7XG4gICAgICAvKiBDaHJvbWUsIFNhZmFyaSBhbmQgT3BlcmEgKi9cbiAgICAgIGVsZW1bJ3dlYmtpdFJlcXVlc3RGdWxsc2NyZWVuJ10oKTtcbiAgICB9IGVsc2UgaWYgKGVsZW1bJ21zUmVxdWVzdEZ1bGxzY3JlZW4nXSkge1xuICAgICAgLyogSUUvRWRnZSAqL1xuICAgICAgZWxlbVsnbXNSZXF1ZXN0RnVsbHNjcmVlbiddKCk7XG4gICAgfVxuICAgIHRoaXMuaW5GdWxsc2NyZWVuID0gdHJ1ZTtcbiAgfVxuXG4gIGNsb3NlRnVsbHNjcmVlbigpIHtcbiAgICB0aGlzLmluRnVsbHNjcmVlbiA9IGZhbHNlO1xuXG4gICAgaWYgKHRoaXMuZG9jdW1lbnQuZXhpdEZ1bGxzY3JlZW4pIHtcbiAgICAgIHRoaXMuZG9jdW1lbnQuZXhpdEZ1bGxzY3JlZW4oKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuZG9jdW1lbnQubW96Q2FuY2VsRnVsbFNjcmVlbikge1xuICAgICAgLyogRmlyZWZveCAqL1xuICAgICAgdGhpcy5kb2N1bWVudC5tb3pDYW5jZWxGdWxsU2NyZWVuKCk7XG4gICAgfSBlbHNlIGlmICh0aGlzLmRvY3VtZW50LndlYmtpdEV4aXRGdWxsc2NyZWVuKSB7XG4gICAgICAvKiBDaHJvbWUsIFNhZmFyaSBhbmQgT3BlcmEgKi9cbiAgICAgIHRoaXMuZG9jdW1lbnQud2Via2l0RXhpdEZ1bGxzY3JlZW4oKTtcbiAgICB9IGVsc2UgaWYgKHRoaXMuZG9jdW1lbnQubXNFeGl0RnVsbHNjcmVlbikge1xuICAgICAgLyogSUUvRWRnZSAqL1xuICAgICAgdGhpcy5kb2N1bWVudC5tc0V4aXRGdWxsc2NyZWVuKCk7XG4gICAgfVxuICB9XG5cbiAgem9vbSgpIHtcbiAgICBpZiAodGhpcy56b29tZWRJbikge1xuICAgICAgdGhpcy56b29tT3V0KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuem9vbUluKCk7XG4gICAgfVxuICB9XG5cbiAgem9vbUluKCkge1xuICAgIHRoaXMuc3dpcGVyLm5hdGl2ZUVsZW1lbnQuc3dpcGVyLnpvb20uaW4oKTtcbiAgICB0aGlzLnpvb21lZEluID0gdHJ1ZTtcbiAgfVxuXG4gIHpvb21PdXQoKSB7XG4gICAgdGhpcy5zd2lwZXIubmF0aXZlRWxlbWVudC5zd2lwZXIuem9vbS5vdXQoKTtcbiAgICB0aGlzLnpvb21lZEluID0gZmFsc2U7XG4gIH1cblxuICBoYW5kbGVTaW5nbGVUYXAoKSB7XG4gICAgdGhpcy5jb250cm9sc1Zpc2libGUgPSAhdGhpcy5jb250cm9sc1Zpc2libGU7XG4gICAgdGhpcy5jaGFuZ2UuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG5cbiAgaGlkZUNvbnRyb2xzKCkge1xuICAgIHRoaXMuY29udHJvbHNWaXNpYmxlID0gZmFsc2U7XG4gICAgdGhpcy5jaGFuZ2UuZGV0ZWN0Q2hhbmdlcygpO1xuICB9XG5cbiAgc2hvd0NvbnRyb2xzKCkge1xuICAgIHRoaXMuY29udHJvbHNWaXNpYmxlID0gdHJ1ZTtcbiAgICB0aGlzLmNoYW5nZS5kZXRlY3RDaGFuZ2VzKCk7XG4gIH1cbn1cbiJdfQ==