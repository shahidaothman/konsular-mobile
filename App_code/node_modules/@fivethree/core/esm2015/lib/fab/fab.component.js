/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { FivFeatureDiscovery } from './../feature-discovery/feature-discovery.component';
import { FivLoadingProgressBar } from './../loading-progress-bar/loading-progress-bar.component';
import { FivIcon } from './../icon/icon.component';
import { Component, Input, ViewChild, Output, EventEmitter, Renderer2, ContentChild, TemplateRef, Optional } from '@angular/core';
import { animate, style, transition, trigger } from '@angular/animations';
import { FivLoadingSpinner } from '../loading-spinner/loading-spinner.component';
import { IonContent, IonLabel } from '@ionic/angular';
import { Subject } from 'rxjs';
import { takeUntil, tap, filter, repeat, map, pairwise, distinctUntilChanged } from 'rxjs/operators';
export class FivFab {
    /**
     * @param {?} renderer
     * @param {?} content
     */
    constructor(renderer, content) {
        this.renderer = renderer;
        this.content = content;
        this.vertical = 'none';
        this.horizontal = 'none';
        this.mode = 'normal';
        this.spinColor = 'primary';
        this.disabled = false;
        this.visible = true;
        this.pulse = false;
        this._scroll = true;
        this.fivComplete = new EventEmitter();
        this.fivRefresh = new EventEmitter();
        this.fivHidden = new EventEmitter();
        this.fivShow = new EventEmitter();
        this.fivTransition = new EventEmitter();
        this.loading = false;
        this.extended = false;
        this.iconState = 'normal';
        this.currentDeltaY = 0;
        this.$onDestroy = new Subject();
        this.params = {
            fromTransform: 'translateX(-50%) scale(0)',
            toTransform: 'translateX(-50%) scale(1)'
        };
        this.params = {
            toTransform: this.toTransform,
            fromTransform: this.fromTransform
        };
    }
    /**
     * @param {?} scroll
     * @return {?}
     */
    set scroll(scroll) {
        this._scroll = scroll;
        this.$onDestroy.next();
        this.ngOnInit();
    }
    /**
     * @return {?}
     */
    get scroll() {
        return this._scroll;
    }
    /**
     * @return {?}
     */
    get fromTransform() {
        return this.horizontal === 'center'
            ? 'scale(0) translateX(-50%)'
            : 'scale(0)';
    }
    /**
     * @return {?}
     */
    get toTransform() {
        return this.horizontal === 'center'
            ? 'translateX(-50%) scale(1)'
            : 'scale(1)';
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        if (!this.content) {
            return;
        }
        if (!this.scroll) {
            return;
        }
        this.content.scrollEvents = true;
        /** @type {?} */
        const directionChange = this.content.ionScroll.pipe(map((/**
         * @param {?} ev
         * @return {?}
         */
        ev => ev.detail.deltaY)), pairwise(), map((/**
         * @param {?} __0
         * @return {?}
         */
        ([y1, y2]) => (y2 < y1 ? 'Up' : 'Down'))), distinctUntilChanged(), takeUntil(this.content.ionScrollEnd), repeat());
        /** @type {?} */
        const up = directionChange.pipe(filter((/**
         * @param {?} direction
         * @return {?}
         */
        direction => direction === 'Up')));
        /** @type {?} */
        const down = directionChange.pipe(filter((/**
         * @param {?} direction
         * @return {?}
         */
        direction => direction === 'Down')));
        up.pipe(tap((/**
         * @return {?}
         */
        () => this.labelComp ? (this.extended = true) : (this.visible = true))), takeUntil(this.$onDestroy)).subscribe();
        down
            .pipe(tap((/**
         * @return {?}
         */
        () => this.labelComp ? (this.extended = false) : (this.visible = false))), takeUntil(this.$onDestroy))
            .subscribe();
    }
    /**
     * @return {?}
     */
    ngOnDestroy() {
        this.$onDestroy.next();
    }
    /**
     * @return {?}
     */
    ngAfterContentInit() {
        this.extended = !!this.labelComp;
    }
    /**
     * @return {?}
     */
    load() {
        this.loading = true;
        this.fivRefresh.emit(this);
    }
    /**
     * @return {?}
     */
    unload() {
        if (this.bar) {
            this.bar.unload();
        }
        this.loading = false;
    }
    /**
     * @return {?}
     */
    complete() {
        if (this.loading) {
            if (this.spinner) {
                this.spinner.completeIn(1000);
            }
            else if (this.bar) {
                this.bar.complete();
            }
        }
    }
    /**
     * @return {?}
     */
    fillAnimationDone() {
        this.fivComplete.emit(this);
        this.unload();
    }
    /**
     * @param {?} progress
     * @return {?}
     */
    rotate(progress) {
        this.renderer.setStyle(this.spinner._elementRef.nativeElement, 'transform', `rotateZ(${(progress / 200) * 360}deg)`);
    }
    /**
     * @param {?} event
     * @return {?}
     */
    fabAnimDone(event) {
        if (event.fromState === 'void') {
            this.fivShow.emit(this);
        }
        if (event.toState === 'void') {
            this.fivHidden.emit(this);
        }
    }
}
FivFab.decorators = [
    { type: Component, args: [{
                selector: 'fiv-fab',
                template: "<ion-fab *ngIf=\"visible\" (@fabAnim.done)=\"fabAnimDone($event)\" [@fabAnim]=\"{value: '*',params: params}\"\n  [ngClass]=\"[mode,horizontal,vertical]\" [slot]=\"slot\">\n  <fiv-loading-spinner [color]=\"spinColor\" *ngIf=\"!extended && loading\" (fivProgress)=\"rotate($event)\" #spinner\n    (fivComplete)=\"fillAnimationDone()\" class=\"spinner\" [circleRadius]=\"30\" [diameter]=\"68\" [strokeWidth]=\"4\"\n    [mode]=\"'indeterminate'\">\n  </fiv-loading-spinner>\n\n  <ion-button [ngClass]=\"{'pulse': pulse}\" [color]=\"color\" [disabled]=\"disabled\">\n    <fiv-loading-progress-bar *ngIf=\"extended\" [loading]=\"loading\" (fivComplete)=\"fillAnimationDone()\" #bar>\n    </fiv-loading-progress-bar>\n    <fiv-icon #feature=\"fivFeature\" [fivFeature]=\"feature\" *ngIf=\"iconComp\" [color]=\"iconComp.color\"\n      [name]=\"iconComp.name\" [dotVisible]=\"iconComp.dotVisible\" [indicatorValue]=\"iconComp.indicatorValue\">\n    </fiv-icon>\n    <div [@labelAnim] *ngIf=\"labelComp && extended\">\n      <ng-content select=\"ion-label\"></ng-content>\n    </div>\n  </ion-button>\n</ion-fab>",
                animations: [
                    trigger('fabAnim', [
                        transition('void => *', [
                            style({
                                transform: '{{fromTransform}}'
                            }),
                            animate('250ms ease-out', style({
                                transform: '{{toTransform}}'
                            }))
                        ], {
                            params: {
                                fromTransform: 'scale(0) translateX(-50%)',
                                toTransform: 'translateX(-50%) scale(1)'
                            }
                        }),
                        transition('* => void', [
                            style({
                                transform: '{{toTransform}}'
                            }),
                            animate('250ms ease-in', style({ transform: '{{fromTransform}}' }))
                        ], {
                            params: {
                                fromTransform: 'scale(0) translateX(-50%)',
                                toTransform: 'translateX(-50%) scale(1)'
                            }
                        })
                    ]),
                    trigger('labelAnim', [
                        transition('void => *', [
                            style({ width: '0', opacity: 0 }),
                            animate('140ms', style({ width: '*', opacity: 1 }))
                        ]),
                        transition('* => void', [
                            style({ width: '*', opacity: 1 }),
                            animate('120ms', style({ width: 0, opacity: 0 }))
                        ])
                    ])
                ],
                styles: [":host{--fiv-spinner-size:68px;display:contents}:host(.button-disabled){pointer-events:none}ion-button{--border-radius:28px;height:56px;min-width:56px;-webkit-margin-start:0;margin-inline-start:0;-webkit-margin-end:0;margin-inline-end:0;margin:0}ion-fab.top{top:10px}ion-fab.top.edge{top:-28px}ion-fab.middle{top:calc(50% - 28px)}ion-fab.bottom.edge{bottom:-28px}ion-fab.bottom{bottom:10px}ion-fab.center{left:50%;-webkit-transform:translateX(-50%);transform:translateX(-50%)}ion-fab.start{left:10px}ion-fab.end{right:calc(10px + var(--ion-safe-area-right,0px))}.pulse{-webkit-animation:1.2s infinite shadow-pulse;animation:1.2s infinite shadow-pulse}fiv-loading-spinner{position:absolute;left:calc((var(--fiv-spinner-size) - 56px)/ -2);top:calc((var(--fiv-spinner-size) - 56px)/ -2)}@-webkit-keyframes shadow-pulse{0%{border-radius:28px;box-shadow:0 0 0 0 rgba(0,0,0,.2)}100%{border-radius:28px;box-shadow:0 0 0 28px transparent}}@keyframes shadow-pulse{0%{border-radius:28px;box-shadow:0 0 0 0 rgba(0,0,0,.2)}100%{border-radius:28px;box-shadow:0 0 0 28px transparent}}"]
            }] }
];
/** @nocollapse */
FivFab.ctorParameters = () => [
    { type: Renderer2 },
    { type: IonContent, decorators: [{ type: Optional }] }
];
FivFab.propDecorators = {
    vertical: [{ type: Input }],
    horizontal: [{ type: Input }],
    mode: [{ type: Input }],
    slot: [{ type: Input }],
    icon: [{ type: Input }],
    spinColor: [{ type: Input }],
    color: [{ type: Input }],
    disabled: [{ type: Input }],
    visible: [{ type: Input }],
    pulse: [{ type: Input }],
    scroll: [{ type: Input }],
    feature: [{ type: Input }],
    fivComplete: [{ type: Output }],
    fivRefresh: [{ type: Output }],
    fivHidden: [{ type: Output }],
    fivShow: [{ type: Output }],
    fivTransition: [{ type: Output }],
    spinner: [{ type: ViewChild, args: ['spinner',] }],
    featureDiscovery: [{ type: ViewChild, args: ['feature',] }],
    bar: [{ type: ViewChild, args: ['bar',] }],
    iconComp: [{ type: ContentChild, args: [FivIcon,] }],
    labelComp: [{ type: ContentChild, args: [IonLabel,] }]
};
if (false) {
    /** @type {?} */
    FivFab.prototype.vertical;
    /** @type {?} */
    FivFab.prototype.horizontal;
    /** @type {?} */
    FivFab.prototype.mode;
    /** @type {?} */
    FivFab.prototype.slot;
    /** @type {?} */
    FivFab.prototype.icon;
    /** @type {?} */
    FivFab.prototype.spinColor;
    /** @type {?} */
    FivFab.prototype.color;
    /** @type {?} */
    FivFab.prototype.disabled;
    /** @type {?} */
    FivFab.prototype.visible;
    /** @type {?} */
    FivFab.prototype.pulse;
    /** @type {?} */
    FivFab.prototype._scroll;
    /** @type {?} */
    FivFab.prototype.feature;
    /** @type {?} */
    FivFab.prototype.fivComplete;
    /** @type {?} */
    FivFab.prototype.fivRefresh;
    /** @type {?} */
    FivFab.prototype.fivHidden;
    /** @type {?} */
    FivFab.prototype.fivShow;
    /** @type {?} */
    FivFab.prototype.fivTransition;
    /** @type {?} */
    FivFab.prototype.spinner;
    /** @type {?} */
    FivFab.prototype.featureDiscovery;
    /** @type {?} */
    FivFab.prototype.bar;
    /** @type {?} */
    FivFab.prototype.iconComp;
    /** @type {?} */
    FivFab.prototype.labelComp;
    /** @type {?} */
    FivFab.prototype.loading;
    /** @type {?} */
    FivFab.prototype.extended;
    /** @type {?} */
    FivFab.prototype.iconState;
    /** @type {?} */
    FivFab.prototype.currentDeltaY;
    /** @type {?} */
    FivFab.prototype.$onDestroy;
    /** @type {?} */
    FivFab.prototype.params;
    /**
     * @type {?}
     * @private
     */
    FivFab.prototype.renderer;
    /**
     * @type {?}
     * @private
     */
    FivFab.prototype.content;
}
/**
 * @record
 */
export function FabTransitionEvent() { }
if (false) {
    /** @type {?} */
    FabTransitionEvent.prototype.from;
    /** @type {?} */
    FabTransitionEvent.prototype.to;
}
/** @enum {number} */
const FabState = {
    HIDDEN: 0,
    NORMAL: 1,
    EXTENDED: 2,
};
export { FabState };
FabState[FabState.HIDDEN] = 'HIDDEN';
FabState[FabState.NORMAL] = 'NORMAL';
FabState[FabState.EXTENDED] = 'EXTENDED';
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZmFiLmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL0BmaXZldGhyZWUvY29yZS8iLCJzb3VyY2VzIjpbImxpYi9mYWIvZmFiLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7O0FBQ0EsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sb0RBQW9ELENBQUM7QUFDekYsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sMERBQTBELENBQUM7QUFDakcsT0FBTyxFQUFFLE9BQU8sRUFBRSxNQUFNLDBCQUEwQixDQUFDO0FBQ25ELE9BQU8sRUFDTCxTQUFTLEVBRVQsS0FBSyxFQUNMLFNBQVMsRUFDVCxNQUFNLEVBQ04sWUFBWSxFQUNaLFNBQVMsRUFHVCxZQUFZLEVBRVosV0FBVyxFQUNYLFFBQVEsRUFDVCxNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQ0wsT0FBTyxFQUNQLEtBQUssRUFDTCxVQUFVLEVBQ1YsT0FBTyxFQUVSLE1BQU0scUJBQXFCLENBQUM7QUFDN0IsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0sOENBQThDLENBQUM7QUFDakYsT0FBTyxFQUFFLFVBQVUsRUFBRSxRQUFRLEVBQUUsTUFBTSxnQkFBZ0IsQ0FBQztBQUN0RCxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sTUFBTSxDQUFDO0FBQy9CLE9BQU8sRUFDTCxTQUFTLEVBQ1QsR0FBRyxFQUNILE1BQU0sRUFDTixNQUFNLEVBQ04sR0FBRyxFQUNILFFBQVEsRUFDUixvQkFBb0IsRUFDckIsTUFBTSxnQkFBZ0IsQ0FBQztBQXdEeEIsTUFBTSxPQUFPLE1BQU07Ozs7O0lBeURqQixZQUNVLFFBQW1CLEVBQ1AsT0FBbUI7UUFEL0IsYUFBUSxHQUFSLFFBQVEsQ0FBVztRQUNQLFlBQU8sR0FBUCxPQUFPLENBQVk7UUExRGhDLGFBQVEsR0FBMEMsTUFBTSxDQUFDO1FBQ3pELGVBQVUsR0FBeUMsTUFBTSxDQUFDO1FBQzFELFNBQUksR0FBdUIsUUFBUSxDQUFD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TCxLQUFLO21CQUNMLEtBQUs7bUJBQ0wsS0FBSzt3QkFDTCxLQUFLO29CQUNMLEtBQUs7dUJBQ0wsS0FBSztzQkFDTCxLQUFLO29CQUNMLEtBQUs7cUJBQ0wsS0FBSztzQkFTTCxLQUFLOzBCQUVMLE1BQU07eUJBQ04sTUFBTTt3QkFDTixNQUFNO3NCQUNOLE1BQU07NEJBQ04sTUFBTTtzQkFFTixTQUFTLFNBQUMsU0FBUzsrQkFDbkIsU0FBUyxTQUFDLFNBQVM7a0JBQ25CLFNBQVMsU0FBQyxLQUFLO3VCQUNmLFlBQVksU0FBQyxPQUFPO3dCQUNwQixZQUFZLFNBQUMsUUFBUTs7OztJQS9CdEIsMEJBQWtFOztJQUNsRSw0QkFBbUU7O0lBQ25FLHNCQUE2Qzs7SUFDN0Msc0JBQXNCOztJQUN0QixzQkFBc0I7O0lBQ3RCLDJCQUErQjs7SUFDL0IsdUJBQXVCOztJQUN2QiwwQkFBMEI7O0lBQzFCLHlCQUF3Qjs7SUFDeEIsdUJBQXVCOztJQVN2Qix5QkFBZTs7SUFDZix5QkFBbUM7O0lBRW5DLDZCQUF5RTs7SUFDekUsNEJBQXdFOztJQUN4RSwyQkFBdUU7O0lBQ3ZFLHlCQUFxRTs7SUFDckUsK0JBQTJFOztJQUUzRSx5QkFBaUQ7O0lBQ2pELGtDQUE0RDs7SUFDNUQscUJBQTZDOztJQUM3QywwQkFBeUM7O0lBQ3pDLDJCQUE0Qzs7SUFFNUMseUJBQWdCOztJQUNoQiwwQkFBaUI7O0lBQ2pCLDJCQUFxQjs7SUFDckIsK0JBQWtCOztJQUNsQiw0QkFBMkI7O0lBRTNCLHdCQUdFOzs7OztJQWVBLDBCQUEyQjs7Ozs7SUFDM0IseUJBQXVDOzs7OztBQXdHM0Msd0NBR0M7OztJQUZDLGtDQUFlOztJQUNmLGdDQUFhOzs7O0lBSWIsU0FBTTtJQUNOLFNBQU07SUFDTixXQUFRIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQW5pbWF0aW9uUGFyYW1zIH0gZnJvbSAnLi8uLi9nYWxsZXJ5L2dhbGxlcnktaW1hZ2UvZ2FsbGVyeS1pbWFnZS5jb21wb25lbnQnO1xuaW1wb3J0IHsgRml2RmVhdHVyZURpc2NvdmVyeSB9IGZyb20gJy4vLi4vZmVhdHVyZS1kaXNjb3ZlcnkvZmVhdHVyZS1kaXNjb3ZlcnkuY29tcG9uZW50JztcbmltcG9ydCB7IEZpdkxvYWRpbmdQcm9ncmVzc0JhciB9IGZyb20gJy4vLi4vbG9hZGluZy1wcm9ncmVzcy1iYXIvbG9hZGluZy1wcm9ncmVzcy1iYXIuY29tcG9uZW50JztcbmltcG9ydCB7IEZpdkljb24gfSBmcm9tICcuLy4uL2ljb24vaWNvbi5jb21wb25lbnQnO1xuaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBPbkluaXQsXG4gIElucHV0LFxuICBWaWV3Q2hpbGQsXG4gIE91dHB1dCxcbiAgRXZlbnRFbWl0dGVyLFxuICBSZW5kZXJlcjIsXG4gIEhvc3RCaW5kaW5nLFxuICBPbkRlc3Ryb3ksXG4gIENvbnRlbnRDaGlsZCxcbiAgQWZ0ZXJDb250ZW50SW5pdCxcbiAgVGVtcGxhdGVSZWYsXG4gIE9wdGlvbmFsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHtcbiAgYW5pbWF0ZSxcbiAgc3R5bGUsXG4gIHRyYW5zaXRpb24sXG4gIHRyaWdnZXIsXG4gIHN0YXRlXG59IGZyb20gJ0Bhbmd1bGFyL2FuaW1hdGlvbnMnO1xuaW1wb3J0IHsgRml2TG9hZGluZ1NwaW5uZXIgfSBmcm9tICcuLi9sb2FkaW5nLXNwaW5uZXIvbG9hZGluZy1zcGlubmVyLmNvbXBvbmVudCc7XG5pbXBvcnQgeyBJb25Db250ZW50LCBJb25MYWJlbCB9IGZyb20gJ0Bpb25pYy9hbmd1bGFyJztcbmltcG9ydCB7IFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7XG4gIHRha2VVbnRpbCxcbiAgdGFwLFxuICBmaWx0ZXIsXG4gIHJlcGVhdCxcbiAgbWFwLFxuICBwYWlyd2lzZSxcbiAgZGlzdGluY3RVbnRpbENoYW5nZWRcbn0gZnJvbSAncnhqcy9vcGVyYXRvcnMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdmaXYtZmFiJyxcbiAgdGVtcGxhdGVVcmw6ICcuL2ZhYi5jb21wb25lbnQuaHRtbCcsXG4gIHN0eWxlVXJsczogWycuL2ZhYi5jb21wb25lbnQuc2NzcyddLFxuICBhbmltYXRpb25zOiBbXG4gICAgdHJpZ2dlcignZmFiQW5pbScsIFtcbiAgICAgIHRyYW5zaXRpb24oXG4gICAgICAgICd2b2lkID0+IConLFxuICAgICAgICBbXG4gICAgICAgICAgc3R5bGUoe1xuICAgICAgICAgICAgdHJhbnNmb3JtOiAne3tmcm9tVHJhbnNmb3JtfX0nXG4gICAgICAgICAgfSksXG4gICAgICAgICAgYW5pbWF0ZShcbiAgICAgICAgICAgICcyNTBtcyBlYXNlLW91dCcsXG4gICAgICAgICAgICBzdHlsZSh7XG4gICAgICAgICAgICAgIHRyYW5zZm9ybTogJ3t7dG9UcmFuc2Zvcm19fSdcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgKVxuICAgICAgICBdLFxuICAgICAgICB7XG4gICAgICAgICAgcGFyYW1zOiB7XG4gICAgICAgICAgICBmcm9tVHJhbnNmb3JtOiAnc2NhbGUoMCkgdHJhbnNsYXRlWCgtNTAlKScsXG4gICAgICAgICAgICB0b1RyYW5zZm9ybTogJ3RyYW5zbGF0ZVgoLTUwJSkgc2NhbGUoMSknXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApLFxuICAgICAgdHJhbnNpdGlvbihcbiAgICAgICAgJyogPT4gdm9pZCcsXG4gICAgICAgIFtcbiAgICAgICAgICBzdHlsZSh7XG4gICAgICAgICAgICB0cmFuc2Zvcm06ICd7e3RvVHJhbnNmb3JtfX0nXG4gICAgICAgICAgfSksXG4gICAgICAgICAgYW5pbWF0ZSgnMjUwbXMgZWFzZS1pbicsIHN0eWxlKHsgdHJhbnNmb3JtOiAne3tmcm9tVHJhbnNmb3JtfX0nIH0pKVxuICAgICAgICBdLFxuICAgICAgICB7XG4gICAgICAgICAgcGFyYW1zOiB7XG4gICAgICAgICAgICBmcm9tVHJhbnNmb3JtOiAnc2NhbGUoMCkgdHJhbnNsYXRlWCgtNTAlKScsXG4gICAgICAgICAgICB0b1RyYW5zZm9ybTogJ3RyYW5zbGF0ZVgoLTUwJSkgc2NhbGUoMSknXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApXG4gICAgXSksXG4gICAgdHJpZ2dlcignbGFiZWxBbmltJywgW1xuICAgICAgdHJhbnNpdGlvbigndm9pZCA9PiAqJywgW1xuICAgICAgICBzdHlsZSh7IHdpZHRoOiAnMCcsIG9wYWNpdHk6IDAgfSksXG4gICAgICAgIGFuaW1hdGUoJzE0MG1zJywgc3R5bGUoeyB3aWR0aDogJyonLCBvcGFjaXR5OiAxIH0pKVxuICAgICAgXSksXG4gICAgICB0cmFuc2l0aW9uKCcqID0+IHZvaWQnLCBbXG4gICAgICAgIHN0eWxlKHsgd2lkdGg6ICcqJywgb3BhY2l0eTogMSB9KSxcbiAgICAgICAgYW5pbWF0ZSgnMTIwbXMnLCBzdHlsZSh7IHdpZHRoOiAwLCBvcGFjaXR5OiAwIH0pKVxuICAgICAgXSlcbiAgICBdKVxuICBdXG59KVxuZXhwb3J0IGNsYXNzIEZpdkZhYiBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95LCBBZnRlckNvbnRlbnRJbml0IHtcbiAgQElucHV0KCkgdmVydGljYWw/OiAndG9wJyB8ICdtaWRkbGUnIHwgJ2JvdHRvbScgfCAnbm9uZScgPSAnbm9uZSc7XG4gIEBJbnB1dCgpIGhvcml6b250YWw/OiAnY2VudGVyJyB8ICdzdGFydCcgfCAnZW5kJyB8ICdub25lJyA9ICdub25lJztcbiAgQElucHV0KCkgbW9kZT86ICdub3JtYWwnIHwgJ2VkZ2UnID0gJ25vcm1hbCc7XG4gIEBJbnB1dCgpIHNsb3Q6IHN0cmluZztcbiAgQElucHV0KCkgaWNvbjogc3RyaW5nO1xuICBASW5wdXQoKSBzcGluQ29sb3IgPSAncHJpbWFyeSc7XG4gIEBJbnB1dCgpIGNvbG9yOiBzdHJpbmc7XG4gIEBJbnB1dCgpIGRpc2FibGVkID0gZmFsc2U7XG4gIEBJbnB1dCgpIHZpc2libGUgPSB0cnVlO1xuICBASW5wdXQoKSBwdWxzZSA9IGZhbHNlO1xuICBASW5wdXQoKSBzZXQgc2Nyb2xsKHNjcm9sbDogYm9vbGVhbikge1xuICAgIHRoaXMuX3Njcm9sbCA9IHNjcm9sbDtcbiAgICB0aGlzLiRvbkRlc3Ryb3kubmV4dCgpO1xuICAgIHRoaXMubmdPbkluaXQoKTtcbiAgfVxuICBnZXQgc2Nyb2xsKCkge1xuICAgIHJldHVybiB0aGlzLl9zY3JvbGw7XG4gIH1cbiAgX3Njcm9sbCA9IHRydWU7XG4gIEBJbnB1dCgpIGZlYXR1cmU6IFRlbXBsYXRlUmVmPGFueT47XG5cbiAgQE91dHB1dCgpIGZpdkNvbXBsZXRlOiBFdmVudEVtaXR0ZXI8Rml2RmFiPiA9IG5ldyBFdmVudEVtaXR0ZXI8Rml2RmFiPigpO1xuICBAT3V0cHV0KCkgZml2UmVmcmVzaDogRXZlbnRFbWl0dGVyPEZpdkZhYj4gPSBuZXcgRXZlbnRFbWl0dGVyPEZpdkZhYj4oKTtcbiAgQE91dHB1dCgpIGZpdkhpZGRlbjogRXZlbnRFbWl0dGVyPEZpdkZhYj4gPSBuZXcgRXZlbnRFbWl0dGVyPEZpdkZhYj4oKTtcbiAgQE91dHB1dCgpIGZpdlNob3c6IEV2ZW50RW1pdHRlcjxGaXZGYWI+ID0gbmV3IEV2ZW50RW1pdHRlcjxGaXZGYWI+KCk7XG4gIEBPdXRwdXQoKSBmaXZUcmFuc2l0aW9uOiBFdmVudEVtaXR0ZXI8Rml2RmFiPiA9IG5ldyBFdmVudEVtaXR0ZXI8Rml2RmFiPigpO1xuXG4gIEBWaWV3Q2hpbGQoJ3NwaW5uZXInKSBzcGlubmVyOiBGaXZMb2FkaW5nU3Bpbm5lcjtcbiAgQFZpZXdDaGlsZCgnZmVhdHVyZScpIGZlYXR1cmVEaXNjb3Zlcnk6IEZpdkZlYXR1cmVEaXNjb3Zlcnk7XG4gIEBWaWV3Q2hpbGQoJ2JhcicpIGJhcjogRml2TG9hZGluZ1Byb2dyZXNzQmFyO1xuICBAQ29udGVudENoaWxkKEZpdkljb24pIGljb25Db21wOiBGaXZJY29uO1xuICBAQ29udGVudENoaWxkKElvbkxhYmVsKSBsYWJlbENvbXA6IElvbkxhYmVsO1xuXG4gIGxvYWRpbmcgPSBmYWxzZTtcbiAgZXh0ZW5kZWQgPSBmYWxzZTtcbiAgaWNvblN0YXRlID0gJ25vcm1hbCc7XG4gIGN1cnJlbnREZWx0YVkgPSAwO1xuICAkb25EZXN0cm95ID0gbmV3IFN1YmplY3QoKTtcblxuICBwYXJhbXM6IHsgZnJvbVRyYW5zZm9ybTogc3RyaW5nOyB0b1RyYW5zZm9ybTogc3RyaW5nIH0gPSB7XG4gICAgZnJvbVRyYW5zZm9ybTogJ3RyYW5zbGF0ZVgoLTUwJSkgc2NhbGUoMCknLFxuICAgIHRvVHJhbnNmb3JtOiAndHJhbnNsYXRlWCgtNTAlKSBzY2FsZSgxKSdcbiAgfTtcblxuICBnZXQgZnJvbVRyYW5zZm9ybSgpIHtcbiAgICByZXR1cm4gdGhpcy5ob3Jpem9udGFsID09PSAnY2VudGVyJ1xuICAgICAgPyAnc2NhbGUoMCkgdHJhbnNsYXRlWCgtNTAlKSdcbiAgICAgIDogJ3NjYWxlKDApJztcbiAgfVxuXG4gIGdldCB0b1RyYW5zZm9ybSgpIHtcbiAgICByZXR1cm4gdGhpcy5ob3Jpem9udGFsID09PSAnY2VudGVyJ1xuICAgICAgPyAndHJhbnNsYXRlWCgtNTAlKSBzY2FsZSgxKSdcbiAgICAgIDogJ3NjYWxlKDEpJztcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKFxuICAgIHByaXZhdGUgcmVuZGVyZXI6IFJlbmRlcmVyMixcbiAgICBAT3B0aW9uYWwoKSBwcml2YXRlIGNvbnRlbnQ6IElvbkNvbnRlbnRcbiAgKSB7XG4gICAgdGhpcy5wYXJhbXMgPSB7XG4gICAgICB0b1RyYW5zZm9ybTogdGhpcy50b1RyYW5zZm9ybSxcbiAgICAgIGZyb21UcmFuc2Zvcm06IHRoaXMuZnJvbVRyYW5zZm9ybVxuICAgIH07XG4gIH1cblxuICBuZ09uSW5pdCgpIHtcbiAgICBpZiAoIXRoaXMuY29udGVudCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5zY3JvbGwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5jb250ZW50LnNjcm9sbEV2ZW50cyA9IHRydWU7XG5cbiAgICBjb25zdCBkaXJlY3Rpb25DaGFuZ2UgPSB0aGlzLmNvbnRlbnQuaW9uU2Nyb2xsLnBpcGUoXG4gICAgICBtYXAoZXYgPT4gZXYuZGV0YWlsLmRlbHRhWSksXG4gICAgICBwYWlyd2lzZSgpLFxuICAgICAgbWFwKChbeTEsIHkyXSkgPT4gKHkyIDwgeTEgPyAnVXAnIDogJ0Rvd24nKSksXG4gICAgICBkaXN0aW5jdFVudGlsQ2hhbmdlZCgpLFxuICAgICAgdGFrZVVudGlsKHRoaXMuY29udGVudC5pb25TY3JvbGxFbmQpLFxuICAgICAgcmVwZWF0KClcbiAgICApO1xuXG4gICAgY29uc3QgdXAgPSBkaXJlY3Rpb25DaGFuZ2UucGlwZShmaWx0ZXIoZGlyZWN0aW9uID0+IGRpcmVjdGlvbiA9PT0gJ1VwJykpO1xuXG4gICAgY29uc3QgZG93biA9IGRpcmVjdGlvbkNoYW5nZS5waXBlKFxuICAgICAgZmlsdGVyKGRpcmVjdGlvbiA9PiBkaXJlY3Rpb24gPT09ICdEb3duJylcbiAgICApO1xuXG4gICAgdXAucGlwZShcbiAgICAgIHRhcCgoKSA9PlxuICAgICAgICB0aGlzLmxhYmVsQ29tcCA/ICh0aGlzLmV4dGVuZGVkID0gdHJ1ZSkgOiAodGhpcy52aXNpYmxlID0gdHJ1ZSlcbiAgICAgICksXG4gICAgICB0YWtlVW50aWwodGhpcy4kb25EZXN0cm95KVxuICAgICkuc3Vic2NyaWJlKCk7XG5cbiAgICBkb3duXG4gICAgICAucGlwZShcbiAgICAgICAgdGFwKCgpID0+XG4gICAgICAgICAgdGhpcy5sYWJlbENvbXAgPyAodGhpcy5leHRlbmRlZCA9IGZhbHNlKSA6ICh0aGlzLnZpc2libGUgPSBmYWxzZSlcbiAgICAgICAgKSxcbiAgICAgICAgdGFrZVVudGlsKHRoaXMuJG9uRGVzdHJveSlcbiAgICAgIClcbiAgICAgIC5zdWJzY3JpYmUoKTtcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuJG9uRGVzdHJveS5uZXh0KCk7XG4gIH1cblxuICBuZ0FmdGVyQ29udGVudEluaXQoKTogdm9pZCB7XG4gICAgdGhpcy5leHRlbmRlZCA9ICEhdGhpcy5sYWJlbENvbXA7XG4gIH1cblxuICBsb2FkKCkge1xuICAgIHRoaXMubG9hZGluZyA9IHRydWU7XG4gICAgdGhpcy5maXZSZWZyZXNoLmVtaXQodGhpcyk7XG4gIH1cblxuICB1bmxvYWQoKSB7XG4gICAgaWYgKHRoaXMuYmFyKSB7XG4gICAgICB0aGlzLmJhci51bmxvYWQoKTtcbiAgICB9XG4gICAgdGhpcy5sb2FkaW5nID0gZmFsc2U7XG4gIH1cblxuICBjb21wbGV0ZSgpIHtcbiAgICBpZiAodGhpcy5sb2FkaW5nKSB7XG4gICAgICBpZiAodGhpcy5zcGlubmVyKSB7XG4gICAgICAgIHRoaXMuc3Bpbm5lci5jb21wbGV0ZUluKDEwMDApO1xuICAgICAgfSBlbHNlIGlmICh0aGlzLmJhcikge1xuICAgICAgICB0aGlzLmJhci5jb21wbGV0ZSgpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZpbGxBbmltYXRpb25Eb25lKCkge1xuICAgIHRoaXMuZml2Q29tcGxldGUuZW1pdCh0aGlzKTtcbiAgICB0aGlzLnVubG9hZCgpO1xuICB9XG5cbiAgcm90YXRlKHByb2dyZXNzOiBudW1iZXIpIHtcbiAgICB0aGlzLnJlbmRlcmVyLnNldFN0eWxlKFxuICAgICAgdGhpcy5zcGlubmVyLl9lbGVtZW50UmVmLm5hdGl2ZUVsZW1lbnQsXG4gICAgICAndHJhbnNmb3JtJyxcbiAgICAgIGByb3RhdGVaKCR7KHByb2dyZXNzIC8gMjAwKSAqIDM2MH1kZWcpYFxuICAgICk7XG4gIH1cblxuICBmYWJBbmltRG9uZShldmVudCkge1xuICAgIGlmIChldmVudC5mcm9tU3RhdGUgPT09ICd2b2lkJykge1xuICAgICAgdGhpcy5maXZTaG93LmVtaXQodGhpcyk7XG4gICAgfVxuXG4gICAgaWYgKGV2ZW50LnRvU3RhdGUgPT09ICd2b2lkJykge1xuICAgICAgdGhpcy5maXZIaWRkZW4uZW1pdCh0aGlzKTtcbiAgICB9XG4gIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBGYWJUcmFuc2l0aW9uRXZlbnQge1xuICBmcm9tOiBGYWJTdGF0ZTtcbiAgdG86IEZhYlN0YXRlO1xufVxuXG5leHBvcnQgZW51bSBGYWJTdGF0ZSB7XG4gIEhJRERFTixcbiAgTk9STUFMLFxuICBFWFRFTkRFRFxufVxuIl19